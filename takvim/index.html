
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Film Takvimi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #1e1e2f;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .selector {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .selector select, .selector button {
      padding: 8px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .calendar {
      padding: 10px;
      max-width: 1000px;
      margin: auto;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    .weekday {
      font-weight: bold;
      text-align: center;
      font-size: 12px;
      padding: 4px;
    }
    .day {
      background: white;
      border-radius: 5px;
      min-height: 70px;
      padding: 4px;
      font-size: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .day .dot {
      width: 6px;
      height: 6px;
      background: green;
      border-radius: 50%;
      float: right;
    }
    .day strong {
      display: block;
      margin-bottom: 2px;
    }
    .film-title {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 11px;
    }
    .summary {
      text-align: center;
      font-size: 13px;
      color: #555;
      margin-top: 10px;
    }
    @media (max-width: 600px) {
      .selector {
        flex-direction: column;
        align-items: center;
      }
      .selector select, .selector button {
        width: 90%;
      }
      .calendar-grid {
        gap: 2px;
      }
      .day {
        font-size: 11px;
        padding: 3px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1 id="month-year">Film Takvimi</h1>
  <div class="selector">
    <select id="year-select"></select>
    <select id="month-select"></select>
    <button onclick="changeMonth(-1)">â—€</button>
    <button onclick="changeMonth(1)">â–¶</button>
  </div>
  <div class="summary" id="summary"></div>
</header>

<div class="calendar" id="calendar">
  <div class="calendar-grid" id="calendar-grid"></div>
</div>

<script>
let filmData = {};
let currentDate = new Date();

async function loadJSON() {
  const res = await fetch('/output/movies_birlesik.json');
  const rawData = await res.json();
  rawData.forEach(film => {
    const date = film.date;
    if (!filmData[date]) filmData[date] = [];
    filmData[date].push(film);
  });
  populateSelectors();
  renderCalendar();
}

function populateSelectors() {
  const yearSelect = document.getElementById('year-select');
  const monthSelect = document.getElementById('month-select');
  const allDates = Object.keys(filmData);
  const years = [...new Set(allDates.map(d => d.slice(0,4)))].sort();
  const months = Array.from({length: 12}, (_, i) => i);

  yearSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
  monthSelect.innerHTML = months.map(m => `<option value="${m}">${new Date(0, m).toLocaleString('tr-TR',{month:'long'})}</option>`).join('');

  yearSelect.value = currentDate.getFullYear();
  monthSelect.value = currentDate.getMonth();

  yearSelect.onchange = () => {
    currentDate.setFullYear(parseInt(yearSelect.value));
    renderCalendar();
  };
  monthSelect.onchange = () => {
    currentDate.setMonth(parseInt(monthSelect.value));
    renderCalendar();
  };
}

function renderCalendar() {
  const grid = document.getElementById('calendar-grid');
  const summary = document.getElementById('summary');
  grid.innerHTML = '';

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  document.getElementById('month-year').textContent =
    currentDate.toLocaleDateString('tr-TR', { year: 'numeric', month: 'long' });

  let totalFilms = 0;
  let activeDays = 0;

  const weekdays = ['Pzt', 'Sal', 'Ã‡ar', 'Per', 'Cum', 'Cmt', 'Paz'];
  weekdays.forEach(day => {
    const div = document.createElement('div');
    div.className = 'weekday';
    div.textContent = day;
    grid.appendChild(div);
  });

  let blankDays = (firstDay + 6) % 7;
  for (let i = 0; i < blankDays; i++) {
    const empty = document.createElement('div');
    empty.className = 'day';
    grid.appendChild(empty);
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dateKey = `${year}${(month + 1).toString().padStart(2, '0')}${day.toString().padStart(2, '0')}`;
    const cell = document.createElement('div');
    cell.className = 'day';
    cell.innerHTML = `<strong>${day}</strong>`;
    if (filmData[dateKey]) {
      cell.innerHTML += `<div class="dot"></div>`;
      filmData[dateKey].slice(0, 2).forEach(film => {
        const title = document.createElement('div');
        title.className = 'film-title';
        title.textContent = `ðŸŽ¬ ${film.title}`;
        cell.appendChild(title);
      });
      totalFilms += filmData[dateKey].length;
      activeDays++;
    }
    grid.appendChild(cell);
  }

  summary.innerHTML = `ðŸ“Š Bu ay <b>${activeDays}</b> gÃ¼n gÃ¶sterim var, toplam <b>${totalFilms}</b> film.`;
}

function changeMonth(offset) {
  currentDate.setMonth(currentDate.getMonth() + offset);
  document.getElementById('year-select').value = currentDate.getFullYear();
  document.getElementById('month-select').value = currentDate.getMonth();
  renderCalendar();
}

loadJSON();
</script>

</body>
</html>
