
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Film Takvimi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: #f7f7f7;
      color: #333;
    }
    header {
      background: #1e1e2f;
      color: white;
      padding: 15px 10px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
    }
 .selector {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px 0;
}
    .selector select, .selector button {
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    .nav {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 10px auto;
    }
    .nav button {
      padding: 6px 12px;
      border: none;
      background: #e0e0e0;
      border-radius: 6px;
      cursor: pointer;
    }
    .nav button.active {
      background: #333;
      color: white;
    }
    .calendar, .list-view {
      display: none;
      padding: 10px;
      max-width: 1000px;
      margin: auto;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .weekday {
      text-align: center;
      font-weight: bold;
      font-size: 12px;
    }
    .day {
      background: white;
      border-radius: 8px;
      min-height: 70px;
      padding: 5px;
      font-size: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .day .dot {
      width: 6px;
      height: 6px;
      background: green;
      border-radius: 50%;
      float: right;
    }
   /* Modal'daki etkinlik kartlarƒ±nƒ± daha belirgin ayƒ±rmak i√ßin */
.film {
  background: #f0f0f0;
  padding: 12px;
  margin-bottom: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.film h3 {
  margin-top: 0;
  font-size: 16px;
}
.film p {
  font-size: 13px;
  margin: 5px 0;
}
.button {
  background: #007bff;
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  text-decoration: none;
  font-size: 13px;
  display: inline-block;
  margin: 6px 6px 0 0;
  transition: background 0.2s ease;
}
.button:hover {
  background: #0056b3;
}
/* Takvimde g√ºn kutusunda sƒ±ƒümayan etkinlik sayƒ±sƒ±nƒ± belirt */
.extra-count {
  font-size: 11px;
  color: #777;
  margin-top: 2px;
}

/* Liste sayfasƒ±nda tarih ba≈ülƒ±klarƒ± */
.list-card h3 {
  font-size: 16px;
  margin-top: 0;
  border-bottom: 1px solid #ddd;
  padding-bottom: 4px;
  margin-bottom: 8px;
}

/* Modal kapatma butonu modern stil */
.modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  color: #444;
  background: #eee;
  border: 1px solid #ccc;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  line-height: 28px;
  text-align: center;
  transition: background 0.2s ease;
}
.modal-close:hover {
  background: #ddd;
}
    .film-title {
      font-size: 11px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .summary {
      text-align: center;
      font-size: 13px;
      color: #555;
      margin-top: 5px;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 20;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 15px;
      border-radius: 12px;
      position: relative;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      color: #444;
      cursor: pointer;
    }
    .modal-close:hover {
      color: red;
    }
    .film-card {
      background: #f2f2f2;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .film-card h3 {
      margin: 0 0 4px;
      font-size: 16px;
    }
    .film-card p {
      margin: 4px 0;
      font-size: 13px;
    }
@media (max-width: 600px) {
  .selector {
    flex-wrap: nowrap;
    flex-direction: row;
    justify-content: center;
    overflow-x: auto;
  }
  .selector select,
  .selector button {
    flex: 0 0 auto;
    width: auto;
  }
}
  </style>
</head>
<body>

<header>
  <h1 id="month-year">Film Takvimi</h1>
  <div class="selector">
    <select id="year-select"></select>
    <select id="month-select"></select>
    <button onclick="changeMonth(-1)">‚óÄ</button>
    <button onclick="changeMonth(1)">‚ñ∂</button>
  </div>
  <div class="summary" id="summary"></div>
</header>

<div class="nav">
  <button onclick="switchView('calendar')" id="tab-calendar" class="active">üìÖ Takvim</button>
  <button onclick="switchView('list')" id="tab-list">üìã Liste</button>
</div>

<div class="calendar" id="calendar">
  <div class="calendar-grid" id="calendar-grid"></div>
</div>

<div class="list-view" id="list-view"></div>

<div class="modal" id="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<script>
let filmData = {};
let currentDate = new Date();

async function loadJSON() {
  const res = await fetch('/output/movies_birlesik.json');
  const rawData = await res.json();
  rawData.forEach(film => {
    const date = film.date;
    if (!filmData[date]) filmData[date] = [];
    filmData[date].push(film);
  });
  populateSelectors();
  renderCalendar();
  renderListView();
}

function populateSelectors() {
  const yearSelect = document.getElementById('year-select');
  const monthSelect = document.getElementById('month-select');
  const allDates = Object.keys(filmData);
  const years = [...new Set(allDates.map(d => d.slice(0,4)))].sort();
  const months = Array.from({length: 12}, (_, i) => i);

  yearSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
  monthSelect.innerHTML = months.map(m => `<option value="${m}">${new Date(0, m).toLocaleString('tr-TR',{month:'long'})}</option>`).join('');

  yearSelect.value = currentDate.getFullYear();
  monthSelect.value = currentDate.getMonth();

  yearSelect.onchange = () => {
    currentDate.setFullYear(parseInt(yearSelect.value));
    renderCalendar();
    renderListView();
  };
  monthSelect.onchange = () => {
    currentDate.setMonth(parseInt(monthSelect.value));
    renderCalendar();
    renderListView();
  };
}

function renderCalendar() {
  const grid = document.getElementById('calendar-grid');
  const summary = document.getElementById('summary');
  grid.innerHTML = '';

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  document.getElementById('month-year').textContent =
    currentDate.toLocaleDateString('tr-TR', { year: 'numeric', month: 'long' });

  let totalFilms = 0;
  let activeDays = 0;

  const weekdays = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
  weekdays.forEach(day => {
    const div = document.createElement('div');
    div.className = 'weekday';
    div.textContent = day;
    grid.appendChild(div);
  });

  let blankDays = (firstDay + 6) % 7;
  for (let i = 0; i < blankDays; i++) {
    grid.appendChild(document.createElement('div'));
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dateKey = `${year}${(month + 1).toString().padStart(2, '0')}${day.toString().padStart(2, '0')}`;
    const cell = document.createElement('div');
    cell.className = 'day';
    cell.innerHTML = `<strong>${day}</strong>`;
    if (filmData[dateKey]) {
      cell.innerHTML += `<div class="dot"></div>`;
      filmData[dateKey].slice(0, 2).forEach(film => {
        const title = document.createElement('div');
        title.className = 'film-title';
        title.textContent = `üé¨ ${film.title}`;
        cell.appendChild(title);
      });
      cell.onclick = () => showModal(dateKey);
      totalFilms += filmData[dateKey].length;
      activeDays++;
    }
    grid.appendChild(cell);
  }

  summary.innerHTML = `üìä Bu ay <b>${activeDays}</b> g√ºn g√∂sterim var, toplam <b>${totalFilms}</b> film.`;
}

function renderListView() {
  const list = document.getElementById('list-view');
  list.innerHTML = '';
  const dates = Object.keys(filmData).sort();
  dates.forEach(date => {
    const d = new Date(date.slice(0,4), parseInt(date.slice(4,6)) -1, date.slice(6));
    const label = d.toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' });

    const card = document.createElement('div');
    card.className = 'list-card';
    card.innerHTML = `<h3>üìÖ ${label}</h3>`;
    filmData[date].forEach(film => {
      card.innerHTML += `<p>üé¨ <b>${film.title}</b> ‚Äì <i>${film.genre}</i></p>`;
    });
    list.appendChild(card);
  });
}

function showModal(dateKey) {
  const modal = document.getElementById('modal');
  const body = document.getElementById('modal-body');
  body.innerHTML = '';
  filmData[dateKey].forEach(film => {
    const div = document.createElement('div');
    div.className = 'film';
    div.innerHTML = `
      <h3>${film.title}</h3>
      <p><strong>T√ºr:</strong> ${film.genre}</p>
      <p>${film.summary}</p>
      <p>
        <a href="${film.link}" target="_blank" class="button">üìé Detay</a>
        <a href="${film.bilet_link || '#'}" target="_blank" class="button">üéüÔ∏è Bilet</a>
        <a href="${film.trailer}" target="_blank" class="button">üé¨ Fragman</a>
      </p>
    `;
    body.appendChild(div);
  });
  modal.style.display = 'flex';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

function switchView(view) {
  document.getElementById('calendar').style.display = view === 'calendar' ? 'block' : 'none';
  document.getElementById('list-view').style.display = view === 'list' ? 'block' : 'none';
  document.getElementById('tab-calendar').classList.toggle('active', view === 'calendar');
  document.getElementById('tab-list').classList.toggle('active', view === 'list');
}

function changeMonth(offset) {
  currentDate.setMonth(currentDate.getMonth() + offset);
  document.getElementById('year-select').value = currentDate.getFullYear();
  document.getElementById('month-select').value = currentDate.getMonth();
  renderCalendar();
  renderListView();
}

document.addEventListener('DOMContentLoaded', () => {
  switchView('calendar');
});

loadJSON();
</script>

</body>
</html>
