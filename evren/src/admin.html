<!DOCTYPE html>

<html lang="tr" x-data="adminApp()" x-init="init()">
<head>
<script>
(function(){
  let data = {};
  window.__defineSetter__('__evrenStats', function(val) {
    if (typeof val !== 'object' || val === null) val = {};
    val.avgImdb = val.avgImdb || function(){ return null; };
    data = val;
  });
  window.__defineGetter__('__evrenStats', function() {
    return data;
  });
})();
</script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>üéõÔ∏è Admin Panel ¬∑ Film Evreni Aƒüƒ± ‚Äî v2</title>
<!-- Alpine & Tailwind -->
<script defer="" src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<!-- JSZip (future: zip import/export) -->
<script defer="" src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
    :root { color-scheme: dark; }
    body { background: #0b1220; color: #e5e7eb; }
    .glass { background: rgba(31,41,55,0.5); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(12px); }
    textarea, input, select { background: rgba(55,65,81,0.5); border: 1px solid rgba(255,255,255,0.12); color: #e5e7eb; }
    textarea::placeholder, input::placeholder { color:#9ca3af }
    .kbd { padding:2px 6px; border:1px solid rgba(255,255,255,0.2); border-bottom-width:2px; border-radius:6px; font-size:12px; }
    /* Tabs */
    .tab-active::after {
      content:''; position:absolute; left:10px; right:10px; bottom:-1px; height:2px; background:#38bdf8; border-radius:2px;
    }
    /* Sticky table header + zebra */
    thead.sticky-head th { position: sticky; top: 0; background: rgba(2,6,23,0.9); backdrop-filter: blur(6px); z-index: 10; }
    tbody tr:nth-child(odd){ background: rgba(255,255,255,0.02); }
    tbody tr:hover{ background: rgba(59,130,246,0.08); }
    /* Nodes table tweaks */
    .nodes-table input,
    .nodes-table select,
    .nodes-table textarea {
      width: 100%;
      border-radius: 0.5rem;
      padding: 0.5rem 0.625rem;
      height: 2.75rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.8rem;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .nodes-table th, .nodes-table td { font-size: 0.8rem; vertical-align: middle; }
    .nodes-table tbody tr { border-top: 1px solid rgba(255,255,255,0.08); }
    .nodes-table tbody tr:hover { background: rgba(255,255,255,0.05); }
    /* Column widths */
    .nodes-table th:nth-child(1), .nodes-table td:nth-child(1){ min-width: 10px; }   /* checkbox */
    .nodes-table th:nth-child(2), .nodes-table td:nth-child(2){ min-width: 120px; }  /* ID */
    .nodes-table th:nth-child(3), .nodes-table td:nth-child(3){ min-width: 240px; }  /* Ba≈ülƒ±k */
    .nodes-table th:nth-child(4), .nodes-table td:nth-child(4){ min-width: 140px; }  /* Tarih */
    .nodes-table th:nth-child(5), .nodes-table td:nth-child(5){ min-width: 150px; }  /* T√ºr */
    .nodes-table th:nth-child(6), .nodes-table td:nth-child(6){ min-width: 100px; }  /* IMDb */
    .nodes-table th:nth-child(7), .nodes-table td:nth-child(7){ min-width: 100px; }  /* Tip */
    .nodes-table th:nth-child(8), .nodes-table td:nth-child(8){ min-width: 220px; }  /* G√∂rsel */
    .nodes-table th:nth-child(9), .nodes-table td:nth-child(9){ min-width: 400px; }  /* Kaynaklar */
    .nodes-table th:nth-child(10), .nodes-table td:nth-child(10){ min-width: 120px; } /* ƒ∞≈ülem */
    /* Small screens: soften table overflow */
    @media (max-width: 640px){
      .nodes-table th:nth-child(5), .nodes-table td:nth-child(5){ display:none; } /* hide T√ºr */
      .nodes-table th:nth-child(8), .nodes-table td:nth-child(8){ display:none; } /* hide G√∂rsel */
    }
  
  /* Dashboard charts: keep cards compact and equal height */
  .chart-box{ height:260px; }
  @media (min-width:1280px){ .chart-box{ height:240px; } }
  .chart-box > canvas{ width:100% !important; height:100% !important; }
</style>
<script defer="" src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>/*
// --- Cookie-based Auth Guard + Idle Logout + Fetch 401 handling ---
(function(){
  const CFG = {
    LOGIN_URL: './login.html',
    COOKIE_NAME: 'admin_token',
    IDLE_MS: 30 * 60 * 1000 // 30 minutes
  };
  function getCookie(name){
    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([.$?*|{}()\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)'));
    return m ? decodeURIComponent(m[1]) : '';
  }
  function delCookie(name){
    document.cookie = name + '=; Max-Age=0; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;';
  }
  function redirect(reason){
    if (location.pathname.includes('login')) return; // avoid loop
    const next = encodeURIComponent(location.href);
    location.href = CFG.LOGIN_URL + (CFG.LOGIN_URL.includes('?') ? '&' : '?') + 'reason=' + encodeURIComponent(reason||'unauthorized') + '&next=' + next;
  }

  // Guard on load
  document.addEventListener('DOMContentLoaded', () => {
    const has = !!getCookie(CFG.COOKIE_NAME);
    if (!has) redirect('no-cookie');
  }, { once:true });

  // Intercept fetch to ensure cookies & catch 401/403
  (function(){
    const _fetch = window.fetch;
    window.fetch = async function(input, init){
      init = init || {};
      if (!('credentials' in (init||{}))) init.credentials = 'include';
      const res = await _fetch(input, init);
      if (res && (res.status === 401 || res.status === 403)){
        try { delCookie(CFG.COOKIE_NAME); } catch {}
        redirect('expired');
      }
      return res;
    };
  })();

  // Idle logout
  (function(){
    let t = null;
    const reset = () => {
      if (t) clearTimeout(t);
      t = setTimeout(() => { try { delCookie(CFG.COOKIE_NAME); } catch{} redirect('idle-timeout'); }, CFG.IDLE_MS);
    };
    ['mousemove','mousedown','keydown','touchstart','scroll','visibilitychange'].forEach(ev => window.addEventListener(ev, reset, { passive:true }));
    reset();
  })();

  // Expose a safe logout for the button
  window.__adminLogout = function(){
    try { delCookie(CFG.COOKIE_NAME); } catch {}
    redirect('manual-logout');
  };
})(); */
</script>
<script>
document.addEventListener('alpine:init', () => {
  Alpine.store('ui', { sidebar: false, theme: 'dark', userMenu:false });
});
</script><style>
/* --- Modern Admin Enhancements --- */
:root { color-scheme: dark; }
body { background: #0b1220; color:#e5e7eb; }
.glass { background: rgba(31,41,55,0.5); border:1px solid rgba(255,255,255,0.12); backdrop-filter: blur(14px); }
.topbar { position: sticky; top:0; z-index:70; }
.topbar .brand { font-weight:700; }
.sidebar-drawer { transition: transform .2s ease; }
.sidebar-overlay { background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
.header-actions .btn { border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); border-radius:.6rem; padding:.45rem .7rem; }
.header-actions .btn:hover { background: rgba(255,255,255,.12); }
.dropdown-panel { background: rgba(31,41,55,0.95); border: 1px solid rgba(255,255,255,0.14); box-shadow: 0 16px 40px rgba(0,0,0,0.45); }
</style>
<script>
document.addEventListener('alpine:init', () => {
  // UI store (extend if exists)
  try {
    const ui = Alpine.store('ui') || {};
    Alpine.store('ui', Object.assign({ sidebar:false, theme:'dark', userMenu:false, cardMode:false }, ui));
  } catch(e) {
    Alpine.store('ui', { sidebar:false, theme:'dark', userMenu:false, cardMode:false });
  }

  // JSON edit modal store
  Alpine.store('edit', {
    open:false,
    text:'',
    apply:null,
    title:'Kaynaklar (JSON)'
  });

  // Toast store
  Alpine.store('toast', {
    items: [],
    push(msg, ttl=2500){
      const id = Date.now() + Math.random();
      this.items.push({ id, msg });
      setTimeout(() => {
        this.items = this.items.filter(t => t.id !== id);
      }, ttl);
    }
  });
});
</script>
<style>
/* Modal */
.modal-mask{ position:fixed; inset:0; background:rgba(0,0,0,.6); backdrop-filter: blur(2px); z-index:1000; display:flex; align-items:center; justify-content:center; }
.modal-card{ width:92vw; max-width:720px; background:#0f172a; color:#e5e7eb; border:1px solid rgba(255,255,255,.12); border-radius:16px; overflow:hidden; }
.modal-head{ padding:12px 16px; border-bottom:1px solid rgba(255,255,255,.08); display:flex; align-items:center; justify-content:space-between; }
.modal-body{ padding:12px 16px; }
.modal-actions{ padding:12px 16px; border-top:1px solid rgba(255,255,255,.08); display:flex; gap:8px; justify-content:flex-end; }

/* Toasts */
.toast-wrap{ position: fixed; right: 12px; bottom: 12px; z-index: 1100; display: grid; gap: 8px; width: min(92vw, 360px); }
.toast{ background: rgba(31,41,55,0.9); border:1px solid rgba(255,255,255,.15); padding:10px 12px; border-radius: 12px; }

/* Bulk bar */
.bulkbar{ position: fixed; left: 50%; transform: translateX(-50%); bottom: 10px; z-index: 100; background: rgba(17,24,39,.95); border:1px solid rgba(255,255,255,.14); border-radius: 12px; padding: 8px; display:flex; gap:8px; align-items:center; }
</style><style>
/* --- Sidebar fixes --- */
@media (min-width: 1024px){
  .sidebar-drawer{
    position: sticky !important;
    top: 72px; /* below header */
    height: calc(100vh - 84px);
    transform: none !important;
    translate: none !important;
    width: auto !important;
  }
}
.sidebar-drawer{
  width: 92vw;
  max-width: 360px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  box-sizing: border-box;
}
.sidebar-overlay-fixed{
  position: fixed; inset: 0; background: rgba(0,0,0,0.5);
  backdrop-filter: blur(2px); z-index: 75;
}
</style><style>
/* --- Clean & Mobile-first pass --- */
:root { --pad: 0.6rem; }
.compact *:is(input,select,textarea,button){ font-size: .92rem; }
.compact .btn-sm{ padding: .35rem .6rem; border-radius: .55rem; }
.nodes-table th:nth-child(5), .nodes-table td:nth-child(5){ display: table-cell; }
@media (max-width: 1024px){
  /* Hide less-crucial columns at md- */
  .nodes-table th:nth-child(5), .nodes-table td:nth-child(5){ display: none; } /* T√ºr */
  .nodes-table th:nth-child(8), .nodes-table td:nth-child(8){ display: none; } /* G√∂rsel */
  .nodes-table th:nth-child(9), .nodes-table td:nth-child(9){ display: none; } /* Kaynaklar */
  .nodes-table th:nth-child(10), .nodes-table td:nth-child(10){ position: sticky; right: 0; background: rgba(2,6,23,0.85); }
}
.card-grid .card{ background: rgba(31,41,55,0.45); border:1px solid rgba(255,255,255,.12); border-radius: 14px; padding: .75rem; }
.card .meta{ font-size: .78rem; opacity: .85; }
.sidebar-section{ border: 1px solid rgba(255,255,255,.12); border-radius: 12px; background: rgba(31,41,55,0.45); }
.sidebar-title{ display:flex; align-items:center; justify-content:space-between; padding:.6rem .8rem; }
.sidebar-body{ padding: .6rem .8rem; }
</style><script>
document.addEventListener('alpine:init', () => {
  try {
    const mq = window.matchMedia('(max-width: 1024px)');
    const set = () => { if (mq.matches) Alpine.store('ui').cardMode = true; };
    set();
    mq.addEventListener ? mq.addEventListener('change', set) : mq.addListener(set);
  } catch(e) {}
});
</script><script>
document.addEventListener('alpine:init', () => {
  try { (Alpine.store('ui') || Alpine.store('ui', {})); Alpine.store('ui').cardMode = true; } catch(e){}
});
</script><script>
document.addEventListener('alpine:init', () => {
  Alpine.store('form', {
    open: false,
    node: null,
    title: 'Yapƒ±mƒ± D√ºzenle',
    tmp: {},
    addTmp: { platform: '', url: '' },

    edit(n) {
      this.node = n;
      this.tmp = {
        id: n?.id ?? '',
        label: n?.label ?? '',
        release_date: n?.release_date ?? '',
        t√ºr: n?.t√ºr ?? '',
        imdb_rating: n?.imdb_rating ?? '',
        type: n?.type ?? 'movie',
        image: n?.image ?? '',
        sourcesText: n?.sourcesText ?? '',
        sources: Array.isArray(n?.sources) ? [...n.sources] : (Array.isArray(n?.sourcesParsed) ? [...n.sourcesParsed] : (Array.isArray(n?.sources_list) ? [...n.sources_list] : (Array.isArray(n?.sources) ? [...n.sources] : (Array.isArray(n?.Kaynaklar) ? [...n.Kaynaklar] : []))))
      };
      this.open = true;
    },

    save() {
      if (!this.node) return;
      const t = this.tmp || {};
      this.node.id = t.id;
      this.node.label = t.label;
      this.node.release_date = t.release_date;
      this.node.t√ºr = t.t√ºr;
      this.node.imdb_rating = t.imdb_rating ? +t.imdb_rating : null;
      this.node.type = t.type;
      this.node.image = t.image;
      this.node.sourcesText = t.sourcesText;
      // Optionally reflect sources array back if needed by your app:
      if (Array.isArray(t.sources)) this.node.sources = t.sources;
      this.open = false;
      try { Alpine.store('toast')?.push('Yapƒ±m g√ºncellendi'); } catch(e) {}
    },

    addSourceSave() {
      const t = this.addTmp || { platform: '', url: '' };
      if (!t.platform || !t.url) return;
      if (!Array.isArray(this.tmp.sources)) this.tmp.sources = [];
      this.tmp.sources.push({ platform: t.platform, url: t.url });
      this.addTmp = { platform: '', url: '' };
      try { Alpine.store('toast')?.push('Baƒülantƒ± eklendi'); } catch(e) {}
    },

    addSourceCancel() {
      this.addTmp = { platform: '', url: '' };
    },

    editSource(idx) {
      if (!Array.isArray(this.tmp.sources)) return;
      const item = this.tmp.sources[idx];
      if (!item) return;
      const np = prompt('Platform adƒ±:', item.platform ?? '');
      const nu = prompt('URL:', item.url ?? '');
      if (np && nu) {
        this.tmp.sources[idx] = { platform: np, url: nu };
      }
    },

    deleteSource(idx) {
      if (!Array.isArray(this.tmp.sources)) return;
      this.tmp.sources.splice(idx, 1);
    }
  });
});
</script><script>
document.addEventListener('alpine:init', () => {
  Alpine.store('edgeNew', {
    open:false,
    tmp:{ universe:'', side:'to', other:'', type:'', notes:'' },
    reset(){ this.tmp = { universe:'', side:'to', other:'', type:'', notes:'' }; },
    save(){
      try{
        const id = Alpine.store('form')?.node?.id;
        if(!id) return;
        const t = this.tmp || {};
        if(!t.other) return;
        const edge = { from: t.side==='to' ? id : t.other, to: t.side==='to' ? t.other : id, type: t.type || '', notes: t.notes || '' };
        current.edges.push(edge);
        this.open=false; this.reset();
        try { Alpine.store('toast')?.push('Baƒülantƒ± eklendi'); } catch(e){}
      }catch(e){}
    }
  });
});
</script></head>
<noscript><div style="padding:8px;margin:8px;border:1px solid #fca5a5;color:#fecaca;background:#7f1d1d">Bu panel JavaScript olmadan √ßalƒ±≈ümaz.</div></noscript>
<body :class="{ 'overflow-hidden': ($store?.edgeNew?.open || $store?.form?.open || (typeof sourceEdit!=='undefined' &amp;&amp; sourceEdit?.open)) }" class="min-h-screen selection:bg-sky-600/30"><div @click="$store.ui.sidebar=false" class="sidebar-overlay-fixed lg:hidden" x-show="$store.ui.sidebar" x-transition.opacity=""></div>
<!-- Header -->
<header class="topbar glass">
<div class="max-w-7xl mx-auto px-3 py-2">
<div class="flex items-center gap-2">
<button @click="$store.ui.sidebar = true" aria-label="Men√ºy√º a√ß" class="w-9 h-9 rounded-md border border-white/20 grid place-items-center hover:bg-white/10" title="Men√ºy√º a√ß">‚ò∞</button>
<div class="brand text-base sm:text-lg">üéõÔ∏è Admin Panel</div>
<div class="ml-auto header-actions flex items-center gap-2">
<!-- actions will be placed here -->
<div @keydown.escape.window="open=false" class="relative" x-data="{open:false}">
<button @click="open=!open" class="btn px-3 py-1.5 b t n - s m">Aksiyonlar ‚åÑ</button>
<div class="dropdown-panel absolute right-0 mt-2 w-64 rounded-xl overflow-hidden" x-show="open" x-transition="">
<div class="p-2 space-y-1 actions-slot"><div></div><div><button @click="importAll()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white w-full text-left px-2 py-1 rounded hover:bg-white/10">ƒ∞√ße Aktar</button></div><div><button @click="exportAll()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-emerald-600 hover:bg-emerald-700 border-emerald-500/40 text-white w-full text-left px-2 py-1 rounded hover:bg-white/10">Dƒ±≈üa Aktar</button></div><div><button @click="validateAll()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white w-full text-left px-2 py-1 rounded hover:bg-white/10">Doƒürula</button></div><div><button @click="zipAll()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white w-full text-left px-2 py-1 rounded hover:bg-white/10">T√ºm√ºn√º Zip</button></div><div><button @click="openLinkTester()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-amber-600 hover:bg-amber-700 border-amber-500/40 text-white w-full text-left px-2 py-1 rounded hover:bg-white/10">Linkleri Test Et</button></div><div><button class="px-3 py-1.5 rounded-lg font-medium transition border bg-rose-600 hover:bg-rose-700 border-rose-500/40 text-white w-full text-left px-2 py-1 rounded hover:bg-white/10" id="logoutBtn" onclick="window.__adminLogout?.()">√áƒ±kƒ±≈ü</button></div></div>
</div>
</div>
<div @click.outside="open=false" class="relative" x-data="{open:false}">
<button @click="open=!open" class="w-9 h-9 rounded-full border border-white/20 grid place-items-center">üë§</button>
<div class="dropdown-panel absolute right-0 mt-2 w-44 rounded-xl overflow-hidden" x-show="open">
<a class="block px-3 py-2 hover:bg-white/10" href="#">Profil</a>
<a class="block px-3 py-2 hover:bg-white/10" href="#">Ayarlar</a>
<button class="w-full text-left px-3 py-2 hover:bg-white/10 text-rose-300" id="logoutBtn" onclick="window.__adminLogout?.()">√áƒ±kƒ±≈ü</button>
</div>
</div>
</div>
</div>
</div>
</header>
<!-- Main -->
<main class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-12 gap-4"><div @click="$store.ui.sidebar=false" class="sidebar-overlay fixed inset-0 z-[75] hidden lg:hidden" x-show="$store.ui.sidebar" x-transition.opacity=""></div>
<!-- Sidebar -->
<aside class="left-0 transition-transform -translate-x-full z-[80] top-0 bottom-0 lg:col-span-3 lg:translate-x-0 fixed sidebar-drawer col-span-12 glass w-[92vw] space-y-4 sm:w-[360px] lg:relative p-4 transform" x-bind:class="{ '-translate-x-full': !$store.ui.sidebar, 'translate-x-0': $store.ui.sidebar }">
<div class="flex justify-end lg:hidden">
<button @click="$store.ui.sidebar=false" class="mb-2 w-9 h-9 rounded-md border border-white/20 grid place-items-center hover:bg-white/10" title="Kapat">‚úï</button>
</div>
<div class="sidebar-section" x-data="{open:true}"><div class="sidebar-title"><div>Evrenler</div>
<button :aria-expanded="open" @click="open=!open" class="w-8 h-8 rounded-md border border-white/20 hover:bg-white/10">‚åÑ</button>
</div><div class="sidebar-body" x-show="open">
<div class="flex gap-2 mb-3">
<button @click="addUniverse()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">+ Ekle</button>
<button @click="removeUniverse()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">‚Äì Sil</button>
</div>
<select class="w-full rounded px-2 py-2" x-model="currentUniverse">
<template :key="u" x-for="u in universes">
<option :value="u" x-text="formatUniverse(u)"></option>
</template>
</select>
</div></div>
<div class="sidebar-section" x-data="{open:true}"><div class="sidebar-title"><div>Arama / Filtre</div>
<button :aria-expanded="open" @click="open=!open" class="w-8 h-8 rounded-md border border-white/20 hover:bg-white/10">‚åÑ</button>
</div><div class="sidebar-body" x-show="open">
<input class="w-full rounded px-3 py-2" placeholder="Yapƒ±m ara..." x-model.trim.debounce.250ms="q"/>
<div class="grid grid-cols-2 gap-2 text-sm">
<div>
<label class="block mb-1 opacity-80">Yƒ±l (min)</label>
<input class="w-full rounded px-2 py-1.5" type="number" x-model.number="filters.yearMin"/>
</div>
<div>
<label class="block mb-1 opacity-80">Yƒ±l (max)</label>
<input class="w-full rounded px-2 py-1.5" type="number" x-model.number="filters.yearMax"/>
</div>
</div>
<div>
<label class="block mb-1 opacity-80">IMDb (min)</label>
<input class="w-full rounded px-2 py-1.5" step="0.1" type="number" x-model.number="filters.imdbMin"/>
</div>
<div class="flex gap-2 items-center">
<button @click="resetFilters()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">Sƒ±fƒ±rla</button>
<div class="text-xs opacity-70">Aktif: <span x-text="activeFilterCount"></span></div>
</div>
</div></div>
<div class="sidebar-section" x-data="{open:true}"><div class="sidebar-title"><div>Yardƒ±m</div>
<button :aria-expanded="open" @click="open=!open" class="w-8 h-8 rounded-md border border-white/20 hover:bg-white/10">‚åÑ</button>
</div><div class="sidebar-body" x-show="open">
<ul class="text-sm list-disc list-inside space-y-1 opacity-80">
<li><span class="kbd">Ctrl</span> + <span class="kbd">S</span> taslaƒüƒ± kaydeder.</li>
<li>JSON d√ºzenleyicilerinde <em>ge√ßerli</em> JSON zorunludur.</li>
<li>ƒ∞√ße Aktar ‚Üí zip veya tek JSON kabul eder.</li>
</ul>
</div></div>
</aside>
<!-- Content -->
<section class="col-span-12 space-y-4 lg:col-span-9">
<!-- Universe Stats -->

<!-- Tabs -->
<div class="flex gap-2 border-b border-white/10">
<button :class="tab==='nodes' 
      ? 'px-3 py-2 -mb-px rounded-t-lg border bg-white/10 border-white/20 relative after:content-[\'\'] after:absolute after:left-[10px] after:right-[10px] after:bottom-[-1px] after:h-[2px] after:bg-sky-400 after:rounded' 
      : 'px-3 py-2 -mb-px rounded-t-lg border border-transparent hover:bg-white/5'" @click="tab='nodes'">
    Yapƒ±mlar
  </button>

<button :class="tab==='preview' 
      ? 'px-3 py-2 -mb-px rounded-t-lg border bg-white/10 border-white/20 relative after:content-[\'\'] after:absolute after:left-[10px] after:right-[10px] after:bottom-[-1px] after:h-[2px] after:bg-sky-400 after:rounded' 
      : 'px-3 py-2 -mb-px rounded-t-lg border border-transparent hover:bg-white/5'" @click="tab='preview'">
    √ñn ƒ∞zleme
  </button>
<button :class="tab==='stats' 
      ? 'px-3 py-2 -mb-px rounded-t-lg border bg-white/10 border-white/20 relative after:content-[\'\'] after:absolute after:left-[10px] after:right-[10px] after:bottom-[-1px] after:h-[2px] after:bg-sky-400 after:rounded' 
      : 'px-3 py-2 -mb-px rounded-t-lg border border-transparent hover:bg-white/5'" @click="tab='stats'">
    ƒ∞statistikler
  </button>
</div>
<!-- Nodes Table -->
<div class="glass rounded-xl p-4" x-data="{ page: 1, pageSize: 20 }" x-show="tab==='nodes'">
<div class="flex items-center justify-between mb-3"><div class="text-lg font-semibold">üé¨ Yapƒ±mlar</div><div class="flex items-center gap-2">
<button class="px-3 py-1.5 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10" title="Kart g√∂r√ºn√ºm√ºne ge√ß">
<span>üóÇÔ∏è Kart G√∂r√ºn√ºm√º</span>

</button>
</div></div><div class="flex gap-2 mb-3 flex-wrap c o m p a c t">
<button @click="addNode()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-sky-600 hover:bg-sky-700 border-sky-500/40 text-white shadow">+ Yapƒ±m</button>
<button :disabled="!selectedNodeIds.size" @click="deleteSelectedNodes()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-rose-600 hover:bg-rose-700 border-rose-500/40 text-white">Sil (<span x-text="selectedNodeIds.size"></span>)</button>
<div class="ml-auto flex gap-2">
<button @click="bulkFillSources()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">Se√ßilene Kaynak ≈ûablonu</button>
<button @click="saveDraft()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-emerald-600 hover:bg-emerald-700 border-emerald-500/40 text-white">Taslaƒüƒ± Kaydet</button>
</div>
<div class="flex items-center gap-2 ml-auto">
<select class="px-2 py-1 rounded border border-white/20 bg-white/5" x-model.number="pageSize">
<option :value="10">10</option>
<option :value="20">20</option>
<option :value="50">50</option>
</select>
<div class="text-sm opacity-80">
<span x-text="Math.min((page-1)*pageSize+1, filteredNodes.length)"></span>‚Äì
        <span x-text="Math.min(page*pageSize, filteredNodes.length)"></span> /
        <span x-text="filteredNodes.length"></span>
</div>
<button @click="page = Math.max(1, page-1)" class="btn-sm border border-white/20 bg-white/5 hover:bg-white/10 rounded px-2">‚óÄ</button>
<button @click="page = Math.min(Math.ceil((filteredNodes?.length||0)/pageSize)||1, page+1)" class="btn-sm border border-white/20 bg-white/5 hover:bg-white/10 rounded px-2">‚ñ∂</button>
</div>
</div>
<div class="max-h-[70vh] overflow-y-auto overflow-x-auto">

</div>
<div class="card-grid grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3">
<template :key="n.id" x-for="(n, idx) in filteredNodes.slice((page-1)*pageSize, page*pageSize)">
<div class="card">
<div class="flex items-center justify-between mb-2">
<input :checked="selected.includes(n.id)" @change="toggleSelect(n.id)" class="accent-emerald-500 w-4 h-4 rounded" type="checkbox"/>
<button @click="removeNode(n)" class="text-red-500 text-sm hover:text-red-700">üóë Sil</button>
</div>
<div class="flex gap-3">
<img :src="n.image" alt="" class="w-16 h-20 rounded-lg object-cover border border-white/10"/>
<div class="min-w-0">
<div class="font-semibold truncate" x-text="n.label"></div>
<div class="meta mt-1 flex items-center gap-2">
<span x-text="toTRDate(n.release_date)"></span> ‚Ä¢
            <span x-text="n.type"></span> ‚Ä¢
            <span>IMDb <b x-text="n.imdb_rating"></b></span>
</div>
<div class="text-xs opacity-70 truncate" x-text="n.t√ºr"></div>
</div>
</div>
<div class="flex gap-2 mt-3">
<button @click="previewNode(n)" class="px-2 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-xs">√ñn ƒ∞zleme</button>
<button class="px-2 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-xs">
          JSON D√ºzenle
        </button>
<button @click="$store.form.edit(n)" class="px-2 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-xs">
          D√ºzenle
        </button>
</div>
</div>
</template>
</div>
</div>
<!-- Edges Table -->
<div class="glass rounded-xl p-4">
<div class="flex gap-2 mb-3">
<button @click="addEdge()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-sky-600 hover:bg-sky-700 border-sky-500/40 text-white shadow">+ Baƒülantƒ±</button>
<button :disabled="!selectedEdgeIdx.size" @click="deleteSelectedEdges()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-rose-600 hover:bg-rose-700 border-rose-500/40 text-white">Sil (<span x-text="selectedEdgeIdx.size"></span>)</button>
</div>
<div class="overflow-x-auto">

</div>
<datalist id="edgeTypes">
<option value="Devam"></option>
<option value="Doƒürudan Devam"></option>
<option value="Crossover"></option>
<option value="Ana Hikaye Baƒülantƒ±sƒ±"></option>
<option value="Ana Tehdit"></option>
<option value="Sonsuzluk Ta≈üƒ±"></option>
<option value="√áoklu Evren"></option>
</datalist>
</div>
<!-- Preview -->
<div class="glass rounded-xl p-4" x-show="tab==='preview'">
<h3 class="font-semibold mb-3">Se√ßili Yapƒ±m √ñnizleme</h3>
<template x-if="preview">
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
<div class="sm:col-span-1 space-y-2">
<img :src="preview.image" class="w-full rounded-xl border border-white/10 object-cover aspect-[2/3]"/>
<div class="text-xs opacity-80">Poster URL: <span class="break-all" x-text="preview.image"></span></div>
<div class="flex items-center gap-2 text-xs">
<button @click="checkPoster()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white text-xs">Posteri Kontrol Et</button>
<span>Durum:</span>
<span :class="previewPoster.ok===true ? 'text-emerald-400' : (previewPoster.ok===false ? 'text-rose-400' : 'text-amber-300')" x-text="previewPoster.running ? 'Kontrol ediliyor‚Ä¶' : (previewPoster.text || '-')"></span>
</div>
</div>
<div class="sm:col-span-2 space-y-2 text-sm">
<div class="text-2xl font-bold" x-text="preview.label"></div>
<div>
<b>Vizyon:</b> <span x-text="preview.release_date"></span>
<span class="px-2">‚Ä¢</span>
<b>IMDb:</b> <span x-text="preview.imdb_rating"></span>
</div>
<div><b>T√ºr:</b> <span x-text="preview.t√ºr"></span></div>
<div><b>Tip:</b> <span x-text="preview.type"></span></div>
<div>
<b>Kaynaklar:</b>
<div class="mt-2 grid sm:grid-cols-2 gap-3">
<template :key="k" x-for="(arr, k) in normalizeSources(preview.sources)">
<div class="border border-white/10 rounded-lg p-2">
<div class="text-xs font-semibold mb-1 flex items-center gap-1">
<span x-text="k"></span>
<span class="opacity-60">(<span x-text="arr.length"></span>)</span>
</div>
<ul class="space-y-1">
<template :key="src.url || src.name" x-for="src in arr">
<li class="flex items-center gap-2 text-xs">
<img :src="favicon(src.url)" alt="" class="w-4 h-4 rounded"/>
<a @click.prevent="window.open(src.url, '_blank','noopener')" class="hover:underline" href="#" x-text="src.name || src.url"></a>
</li>
</template>
</ul>
</div>
</template>
</div>
</div>
</div>
</div>
</template>
<template x-if="!preview">
<div class="text-sm opacity-70">Tablodan bir yapƒ±mƒ± "√ñn ƒ∞zleme" ile a√ß.</div>
</template>
</div>
<!-- Stats / Analytics -->

<!-- Tracking Code Modal -->
<dialog class="rounded-xl w-[92vw] max-w-2xl p-0" id="trackingModal">
<form class="glass border border-white/20 rounded-xl p-4" method="dialog">
<div class="flex items-center justify-between mb-2">
<div class="font-semibold">Takip Kodu</div>
<button class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white text-xs">Kapat</button>
</div>
<div class="text-sm opacity-80 mb-2">Bunu kamuya a√ßƒ±k sayfalara ekleyin ( body kapanƒ±≈üƒ±ndan √∂nce):</div>
<pre class="text-xs bg-black/40 p-3 rounded border border-white/10 overflow-x-auto"><code>&lt;script&gt;
!function(){
  const payload = {
    ts: Date.now(),
    path: location.pathname + location.search,
    ref: document.referrer || 'direct',
    ua: navigator.userAgent || '',
    lang: navigator.language || '',
    w: screen.width, h: screen.height
  };
  fetch('/api/analytics/collect', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload),
    keepalive: true
  }).catch(()=&gt;{});
}();
&lt;/script&gt;</code></pre>
<div class="text-xs opacity-70">Sunucu tarafƒ±nda <code>POST /api/analytics/collect</code> isteƒüini veritabanƒ±na yazmanƒ±z gerekir. 
            Admin paneli <code>/api/analytics/report</code> ile √∂zet √ßeker.</div>
</form>
</dialog>
</section>
</main>
<!-- Source Helper Modal -->
<!-- Source Editor Modal -->
<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/60" style="z-index:10050;" x-show="sourceEdit.open">
<div class="glass rounded-xl p-4 w-[96vw] max-w-3xl border border-white/20">
<div class="flex items-center justify-between mb-3">
<h3 class="font-semibold">Kaynak D√ºzenleyici</h3>
<div class="flex gap-2">
<button @click="saveSourceEditor()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-emerald-600 hover:bg-emerald-700 border-emerald-500/40 text-white text-xs">Kaydet</button>
<button @click="closeSourceEditor()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white text-xs">Kapat</button>
</div>
</div>
<template x-if="sourceEdit.node">
<div class="space-y-4 text-sm">
<template :key="cat" x-for="cat in ['Kaynaklar','G√∂rsel','Platform']">
<div class="border border-white/10 rounded-lg p-3">
<div class="flex items-center justify-between mb-2">
<div class="font-semibold" x-text="cat"></div>
<button @click="addSourceRow(cat)" class="px-2 py-1 rounded border border-white/20 hover:bg-white/10 text-xs">+ Satƒ±r</button>
</div>
<div class="grid grid-cols-1 sm:grid-cols-12 gap-2">
<div class="sm:col-span-5 text-xs opacity-70">Ad</div>
<div class="sm:col-span-6 text-xs opacity-70">URL</div>
<div class="sm:col-span-1"></div>
<template :key="cat + i" x-for="(row, i) in sourceEdit.data[cat]">
<div class="contents">
<div class="sm:col-span-5">
<input class="w-full rounded px-2 py-1.5" placeholder="IMDb / Disney+" x-model="row.name"/>
</div>
<div class="sm:col-span-6">
<input class="w-full rounded px-2 py-1.5" placeholder="https://..." x-model="row.url"/>
</div>
<div class="sm:col-span-1 flex justify-end">
<button @click="removeSourceRow(cat, i)" class="px-2 py-1 rounded border border-rose-400/40 text-rose-300 hover:bg-rose-500/10 text-xs">Sil</button>
</div>
</div>
</template>
<template x-if="!sourceEdit.data[cat]?.length">
<div class="sm:col-span-12 text-xs opacity-60">Bu kategoride kayƒ±t yok.</div>
</template>
</div>
</div>
</template>
</div>
</template>
</div>
</div>
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60" x-show="showSourceHelper">
<div class="glass rounded-xl p-4 w-[92vw] max-w-xl">
<div class="flex items-center justify-between mb-3">
<h3 class="font-semibold">Kaynak Yardƒ±mcƒ±sƒ±</h3>
<button @click="showSourceHelper=false" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">Kapat</button>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
<div>
<label class="block mb-1">Kategori</label>
<select class="w-full rounded px-2 py-1.5" x-model="sourceHelper.category">
<option>Kaynaklar</option>
<option>G√∂rsel</option>
<option>Platform</option>
</select>
</div>
<div class="sm:col-span-2">
<label class="block mb-1">Ad</label>
<input class="w-full rounded px-2 py-1.5" placeholder="IMDb / Disney+ / Box Office T√ºrkiye" x-model="sourceHelper.name"/>
</div>
<div class="sm:col-span-2">
<label class="block mb-1">URL</label>
<input class="w-full rounded px-2 py-1.5" placeholder="https://..." x-model="sourceHelper.url"/>
<div class="text-xs opacity-70 mt-1 flex items-center gap-2" x-show="sourceHelper.url">
<img :src="favicon(sourceHelper.url)" alt="" class="w-4 h-4 rounded"/>
<span x-text="hostName(sourceHelper.url)"></span>
</div>
</div>
</div>
<div class="flex justify-end gap-2 mt-4">
<button @click="addSourceEntry()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-sky-600 hover:bg-sky-700 border-sky-500/40 text-white shadow">Ekle</button>
</div>
</div>
</div>
<!-- Link Test Modal -->
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60" x-show="linkTest.open">
<div class="glass rounded-xl p-4 w-[96vw] max-w-3xl">
<div class="flex items-center justify-between mb-3">
<h3 class="font-semibold">Link Testi</h3>
<button @click="closeLinkTester()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">Kapat</button>
</div>
<div class="text-sm mb-2">
<div class="flex flex-wrap gap-2 items-center">
<div>Toplam URL: <b x-text="linkTest.total"></b></div>
<div>Tamamlanan: <b x-text="linkTest.checked"></b></div>
<div class="text-amber-300" x-show="linkTest.running">√áalƒ±≈üƒ±yor‚Ä¶</div>
</div>
</div>
<div class="max-h-[60vh] overflow-y-auto">

</div>
<div class="flex justify-end gap-2 mt-3 text-sm">
<button :disabled="linkTest.running" @click="runLinkTests()" class="px-3 py-1.5 rounded-lg font-medium transition border bg-white/5 hover:bg-white/10 border-white/20 text-white">Se√ßilene Ait Linkleri Test Et</button>
</div>
</div>
</div>
<!-- Hidden file input -->
<input class="hidden" id="fileInput" multiple="" type="file"/>
<!-- Toasts -->
<div class="fixed bottom-4 left-1/2 -translate-x-1/2 z-[100] space-y-2 w-[92vw] max-w-md">
<template :key="t.id" x-for="t in toasts">
<div :class="t.type==='success' ? 'border-emerald-400/40 text-emerald-300' : (t.type==='error' ? 'border-rose-400/40 text-rose-300' : 'border-white/20 text-white')" class="glass rounded-lg px-3 py-2 text-sm border">
<span x-text="t.message"></span>
</div>
</template>
</div>
<!-- Scripts -->
<script>
    function adminApp(){
      return {
        // Toasts
        toasts: [],
        toast(msg, type='info', timeout=2200){
          const id = crypto.randomUUID();
          this.toasts.push({ id, message: msg, type });
          setTimeout(()=>{ this.toasts = this.toasts.filter(t => t.id !== id); }, timeout);
        },

        // Poster status for preview
        previewPoster: { running:false, ok:null, text:'' },

        // Link tester state
        linkTest: { open:false, running:false, results:[], total:0, checked:0 },

        // JSON Editor modal state
        jsonEditor: { open:false, node:null, editor:null, valid:true },

        _dirty: false,
        showSourceHelper: false,
        sourceHelper: { node: null, category: 'Kaynaklar', name: '', url: '' },
        sourceEdit: { open:false, node:null, data:{ Kaynaklar:[], G√∂rsel:[], Platform:[] } },

        // state
        universes: ['avatar','dc','harrypotter','marvel','matrix','middleearth','pixar','starwars'],
        currentUniverse: 'marvel',
        dataMap: {}, // evren -> { nodes:[], edges:[] }
        tab: 'nodes',
        q: '',
        filters: { yearMin: null, yearMax: null, imdbMin: null },
        selectedNodeIds: new Set(),
        selectedEdgeIdx: new Set(),
        preview: null,

        get current(){ return this.dataMap[this.currentUniverse] || { nodes: [], edges: [] } },
        get universesLoaded(){ return this.universes.filter(u => !!this.dataMap[u]) },
        get stats(){
          const { nodes = [], edges = [] } = this.current;
          const withSources = nodes.filter(n => !!n.sources || !!n.sourcesText).length;
          return { nodes: nodes.length, edges: edges.length, withSources };
        },
        formatUniverse(u){ const m={avatar:'Avatar',dc:'DC',harrypotter:'Harry Potter',marvel:'Marvel',matrix:'Matrix',middleearth:'Orta D√ºnya',pixar:'Pixar',starwars:'Star Wars'}; return m[u]||u; },

        // lifecycle
        async init(){
          // klavye kaydet
          window.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') { e.preventDefault(); this.saveDraft(); }
          });
          // Kƒ±sayollar
          window.addEventListener('keydown', (e) => {
            if (e.altKey && e.code === 'KeyT'){ e.preventDefault(); this.openLinkTester(); }
          });
          // LocalStorage taslaklarƒ±nƒ± y√ºkle
          const stash = localStorage.getItem('adminDraft');
          if (stash) {
            try { this.dataMap = JSON.parse(stash); } catch {}
          }
          // Eƒüer bo≈üsa fetch ile mevcut dosyalarƒ± √ßekmeyi dene
          if (!Object.keys(this.dataMap).length) {
            await this.loadAllFromDataFolder();
          }
        },

        async loadAllFromDataFolder(){
          for (const u of this.universes) {
            try {
              const r = await fetch(`/evren/assets/data/${u}.json`, { cache: 'no-store' });
              if (r.ok){
                const j = await r.json();
                (j.nodes||[]).forEach(n => { n.sourcesText = n.sources ? JSON.stringify(n.sources, null, 2) : (n.sourcesText || ''); });
                this.$nextTick(() => { this.dataMap[u] = j; });
              }
            } catch (e) { console.warn('Y√ºklenemedi:', u, e); }
          }
          // ƒ∞lk a√ßƒ±lƒ±≈üta istatistikleri √ßiz
          try {
            const fire = () => window.__evrenStats?.renderAll(this.$root);
            // Range deƒüi≈üince yeniden √ßiz
            this.$nextTick(() => {
              const sel = document.getElementById('analyticsRange');
              if (sel && !sel.__evrenBound) {
                sel.addEventListener('change', fire);
                sel.__evrenBound = true;
              }
            });
            // Veriler y√ºklendikten hemen sonra bir kez √ßalƒ±≈ütƒ±r
            this.$nextTick(() => setTimeout(fire, 0));
          } catch(e){ console.warn('renderAll init error', e); }

        },

        // filters
        get activeFilterCount(){ let c=0; const f=this.filters; if (this.q) c++; if (f.yearMin!=null||f.yearMax!=null) c++; if (f.imdbMin!=null) c++; return c; },
        resetFilters(){ this.q=''; this.filters = { yearMin:null, yearMax:null, imdbMin:null }; },
        get filteredNodes(){
          const q = (this.q||'').toLocaleLowerCase('tr');
          const f = this.current.nodes || [];
          const yMin = this.filters.yearMin != null ? Number(this.filters.yearMin) : null;
          const yMax = this.filters.yearMax != null ? Number(this.filters.yearMax) : null;
          const imdbMin = this.filters.imdbMin != null ? Number(this.filters.imdbMin) : null;
          return f.filter(n => {
            if (q){ const lbl=(n.label||'').toLocaleLowerCase('tr'); if (!lbl.includes(q)) return false; }
            if (yMin!=null||yMax!=null){ const y = n.release_date ? new Date(n.release_date).getFullYear() : null; if (yMin!=null && (y==null||y<yMin)) return false; if (yMax!=null && (y==null||y>yMax)) return false; }
            if (imdbMin!=null){ const r = n.imdb_rating!=null?Number(n.imdb_rating):null; if (r==null||r<imdbMin) return false; }
            return true;
          });
        },

        // nodes ops
        addNode(){
          const id = crypto.randomUUID().slice(0,8);
          const n = { id, label: 'Yeni Yapƒ±m', release_date: '', t√ºr: '', imdb_rating: null, type: 'movie', image: '', sourcesText: '' };
          this.current.nodes.unshift(n); this.touch();
        },
        removeNode(idx){ this.current.nodes.splice(idx,1); this.touch(); },
        duplicateNode(n){
          const copy = JSON.parse(JSON.stringify(n));
          copy.id = crypto.randomUUID().slice(0,8);
          this.current.nodes.unshift(copy);
          this.touch(); this.toast('Yapƒ±m kopyalandƒ±','success');
        },
        clearSources(n){ n.sourcesText=''; delete n.sources; this.touch(); },
        toggleSelect(id){ this.selectedNodeIds.has(id) ? this.selectedNodeIds.delete(id) : this.selectedNodeIds.add(id); },
        toggleSelectAll(ev, what){
          if (what==='nodes'){
            this.selectedNodeIds.clear();
            if (ev.target.checked){ for (const n of this.filteredNodes) this.selectedNodeIds.add(n.id); }
          } else if (what==='edges'){
            this.selectedEdgeIdx.clear();
            if (ev.target.checked){ for (let i=0;i<(this.current.edges||[]).length;i++) this.selectedEdgeIdx.add(i); }
          }
        },
        deleteSelectedNodes(){ if (!this.selectedNodeIds.size) return; this.current.nodes = this.current.nodes.filter(n => !this.selectedNodeIds.has(n.id)); this.selectedNodeIds.clear(); this.touch(); },
        bulkFillSources(){
          const template = {
            "Kaynaklar": [ { "name": "IMDb", "url": "https://www.imdb.com/" } ],
            "G√∂rsel": [],
            "Platform": []
          };
          this.current.nodes.forEach(n => { if (this.selectedNodeIds.has(n.id) && !n.sourcesText){ n.sourcesText = JSON.stringify(template, null, 2); } });
          this.touch();
        },
        previewNode(n){
          if (this.isValidJSON(n.sourcesText)) n.sources = JSON.parse(n.sourcesText);
          this.preview = JSON.parse(JSON.stringify(n));
          this.tab = 'preview';
          this.previewPoster = { running:false, ok:null, text:'' };
        },

        // edges ops
        addEdge(){ const firstId = this.current.nodes[0]?.id || ''; const e={ from: firstId, to: firstId, type: 'Devam', notes: '' }; (this.current.edges ||= []).unshift(e); this.touch(); },
        removeEdge(i){ this.current.edges.splice(i,1); this.touch(); },
        toggleSelectEdge(i){ this.selectedEdgeIdx.has(i) ? this.selectedEdgeIdx.delete(i) : this.selectedEdgeIdx.add(i); },
        deleteSelectedEdges(){ if (!this.selectedEdgeIdx.size) return; this.current.edges = this.current.edges.filter((_,i)=>!this.selectedEdgeIdx.has(i)); this.selectedEdgeIdx.clear(); this.touch(); },

        // universes ops
        addUniverse(){ const u = prompt('Yeni evren anahtarƒ± (k√º√ß√ºk harf, bo≈üluksuz):'); if (!u) return; if (this.universes.includes(u)) return alert('Zaten var'); this.universes.push(u); this.dataMap[u] = { nodes: [], edges: [] }; this.currentUniverse = u; this.touch(); },
        removeUniverse(){ if (!confirm('Se√ßili evreni silmek istiyor musun?')) return; const u=this.currentUniverse; this.universes = this.universes.filter(x=>x!==u); delete this.dataMap[u]; this.currentUniverse = this.universes[0] || ''; this.touch(); },

        // import/export
        async importAll(){
          const input = document.getElementById('fileInput');
          input.accept = '.json,.zip,application/json,application/zip';
          input.onchange = async (e) => {
            const files = Array.from(e.target.files||[]);
            for (const f of files){
              if (f.name.endsWith('.json')){
                const txt = await f.text();
                try {
                  const j = JSON.parse(txt);
                  if (j.nodes && j.edges){
                    const name = f.name.replace(/\.json$/,'');
                    (j.nodes||[]).forEach(n => { n.sourcesText = n.sources ? JSON.stringify(n.sources, null, 2) : (n.sourcesText || ''); });
                    this.$nextTick(()=>{ this.dataMap[name] = j; if (!this.universes.includes(name)) this.universes.push(name); this.currentUniverse = name; });
                    this.toast('JSON i√ße aktarƒ±ldƒ±','success');
                  } else {
                    this.toast(f.name + ' beklenen formatta deƒüil (nodes/edges).', 'error');
                  }
                } catch(err){ this.toast('JSON okunamadƒ±: '+ f.name, 'error'); }
              } else {
                this.toast('≈ûimdilik yalnƒ±zca .json destekleniyor.', 'error');
              }
            }
            input.value = '';
          };
          input.click();
        },
        exportAll(){
          const map = {};
          for (const u of this.universes){
            const j = JSON.parse(JSON.stringify(this.dataMap[u] || { nodes:[], edges:[] }));
            (j.nodes||[]).forEach(n => { if (n.sourcesText && this.isValidJSON(n.sourcesText)) n.sources = JSON.parse(n.sourcesText); delete n.sourcesText; });
            map[u] = j;
          }
          const one = JSON.stringify(map[this.currentUniverse], null, 2);
          downloadText(`${this.currentUniverse}.json`, one);
          this.toast('JSON dƒ±≈üa aktarƒ±ldƒ±','success');
        },

        // validate
        validateAll(){
          const problems = [];
          for (const [u, j] of Object.entries(this.dataMap)){
            const nodeIds = new Set((j.nodes||[]).map(n => String(n.id)));
            for (const n of j.nodes||[]){
              if (!n.id || !n.label) problems.push(`[${u}] Node eksik alan: id/label -> ${JSON.stringify(n)}`);
              if (n.sourcesText && !this.isValidJSON(n.sourcesText)) problems.push(`[${u}] ${n.label} kaynak JSON ge√ßersiz.`);
              if (n.sourcesText && this.isValidJSON(n.sourcesText)){
                const parsed = JSON.parse(n.sourcesText);
                const allowed = ['Kaynaklar','G√∂rsel','Platform'];
                for (const k of Object.keys(parsed||{})){
                  if (!allowed.includes(this.mapCategory(k))) problems.push(`[${u}] ${n.label} kaynak kategorisi tanƒ±nmadƒ±: ${k}`);
                }
              }
            }
            for (const [i,e] of (j.edges||[]).entries()){
              if (!nodeIds.has(String(e.from)) || !nodeIds.has(String(e.to))) problems.push(`[${u}] Edge ${i}: from/to id bulunamadƒ±.`);
            }
          }
          if (!problems.length) { this.toast('Her ≈üey yolunda ‚úî','success'); }
          else { alert('Bulunan sorunlar:\n- ' + problems.join('\n- ')); }
        },

        // JSON helpers
        openJSONEditor(node){
          this.jsonEditor.open = true;
          this.jsonEditor.node = node;
          this.$nextTick(async () => {
            const monaco = await loadMonaco();
            const container = document.getElementById('jsonEditorContainer');
            const value = node.sourcesText || '{\\n  "Kaynaklar": []\\n}';
            if (monaco){
              this.jsonEditor.editor = monaco.editor.create(container, {
                value,
                language: 'json',
                automaticLayout: true,
                minimap: { enabled: false },
                lineNumbers: 'on',
                fontSize: 14,
                theme: 'vs-dark'
              });
              this.jsonEditor.editor.onDidChangeModelContent(() => {
                const v = this.jsonEditor.editor.getValue();
                this.jsonEditor.valid = this.isValidJSON(v);
              });
              this.jsonEditor.valid = this.isValidJSON(value);
            } else {
              // Fallback: simple textarea
              container.innerHTML = '<textarea id="jsonFallback" style="width:100%;height:100%;background:rgba(55,65,81,.5);border:1px solid rgba(255,255,255,.12);color:#e5e7eb;padding:.75rem;border-radius:.5rem;"></textarea>';
              const ta = document.getElementById('jsonFallback');
              ta.value = value;
              ta.addEventListener('input', () => { this.jsonEditor.valid = this.isValidJSON(ta.value); });
              this.jsonEditor.editor = { getValue: ()=>ta.value, setValue: (v)=>{ta.value=v;} };
              this.jsonEditor.valid = this.isValidJSON(value);
            }
          });
        },
        closeJSONEditor(){
    // Monaco varsa kapat
    if (this.jsonEditor.editor && typeof this.jsonEditor.editor.dispose === 'function') {
        this.jsonEditor.editor.dispose();
    }
    // Container'ƒ± temizle
    const container = document.getElementById('jsonEditorContainer');
    if (container) {
        container.innerHTML = '';
    }
    // State reset
    this.jsonEditor.editor = null;
    this.jsonEditor.node = null;
    this.jsonEditor.open = false;
},
        applyJSON(){
          if (!this.jsonEditor.editor) return;
          const v = this.jsonEditor.editor.getValue();
          if (!this.isValidJSON(v)) { this.toast('JSON ge√ßersiz','error'); return; }
          this.jsonEditor.node.sourcesText = v;
          this.touch();
          this.toast('JSON uygulandƒ±','success');
          this.closeJSONEditor();
        },
        formatJSON(node){
          if (!node.sourcesText) return;
          try { node.sourcesText = JSON.stringify(JSON.parse(node.sourcesText), null, 2); this.touch(); }
          catch { /* ignore */ }
        },

        // save
        touch(){ this._dirty = true; },
        saveDraft(){
          localStorage.setItem('adminDraft', JSON.stringify(this.dataMap));
          this._dirty = false;
          this.toast('Taslak kaydedildi','success');
        },
        newDraft(){ if (confirm('T√ºm taslaklarƒ± temizle?')) { localStorage.removeItem('adminDraft'); this.dataMap = {}; this.loadAllFromDataFolder(); this.toast('Yeni taslak olu≈üturuldu','success'); } },

        // helpers
        isValidJSON(s){ if (!s || typeof s !== 'string') return false; try { JSON.parse(s); return true; } catch { return false; } },
        mapCategory(key){ const k=(key||'').toLowerCase(); if (k.includes('g√∂rsel')||k.includes('gorsel')||k.includes('image')||k.includes('poster')) return 'G√∂rsel'; if (k.includes('platform')||k.includes('watch')||k.includes('stream')) return 'Platform'; return 'Kaynaklar'; },
        normalizeItem(it){ if (!it) return null; if (typeof it==='string'){ try{ const url=new URL(it).href; return { name: url, url }; } catch{ return { name: it, url: it }; } } if (typeof it==='object'){ const url=it.url||''; const name=it.name||url||''; return (name||url)?{ name, url }:null; } return null; },
        normalizeSources(src){ const out={ Kaynaklar:[], G√∂rsel:[], Platform:[] }; const push=(cat,it)=>{ const n=this.normalizeItem(it); if(n) out[cat].push(n); }; if (!src) return out; if (typeof src==='object' && !Array.isArray(src)){ for (const [k,v] of Object.entries(src)){ const cat=this.mapCategory(k); const arr=Array.isArray(v)?v:[v]; arr.forEach(it=>push(cat,it)); } return out; } if (Array.isArray(src)){ if (!src.length || typeof src[0] !== 'object' || ('url' in src[0]) || ('name' in src[0])){ src.forEach(it=>push('Kaynaklar', it)); } else { src.forEach(g=>{ const cat=this.mapCategory(g?.category); const items=Array.isArray(g?.items)?g.items:(g?.items?[g.items]:[]); items.forEach(it=>push(cat,it)); }); } return out; } push('Kaynaklar', src); return out; },

        // Poster checker
        async checkPoster(){
          if (!this.preview?.image) { this.previewPoster = { running:false, ok:false, text:'URL yok' }; return; }
          this.previewPoster = { running:true, ok:null, text:'Kontrol ediliyor‚Ä¶' };
          try {
            const img = new Image();
            img.onload = () => { this.previewPoster = { running:false, ok:true, text: img.width + '√ó' + img.height }; this.toast('Poster y√ºklendi','success'); };
            img.onerror = () => { this.previewPoster = { running:false, ok:false, text:'Y√ºklenemedi' }; this.toast('Poster bulunamadƒ±','error'); };
            img.src = this.preview.image + (this.preview.image.includes('?') ? '&' : '?') + 't=' + Date.now();
          } catch (e){
            this.previewPoster = { running:false, ok:false, text:'Hata' };
          }
        },

        // Source helper modal
        addSourceEntry(){
    const n = this.sourceHelper.node;
    if (!n) return;

    let obj = {};
    if (n.sourcesText && this.isValidJSON(n.sourcesText)) {
        obj = JSON.parse(n.sourcesText);
    }

    const cat = this.mapCategory(this.sourceHelper.category);
    obj[cat] = Array.isArray(obj[cat]) ? obj[cat] : [];

    if (typeof this.sourceHelper.editIndex === 'number') {
        obj[cat][this.sourceHelper.editIndex] = { 
            name: this.sourceHelper.name, 
            url: this.sourceHelper.url 
        };
    } else {
        obj[cat].push({ 
            name: this.sourceHelper.name, 
            url: this.sourceHelper.url 
        });
    }

    n.sourcesText = JSON.stringify(obj, null, 2);

    this.$nextTick(() => {
        this.touch();
        this.toast(
            typeof this.sourceHelper.editIndex === 'number' 
                ? 'Kaynak g√ºncellendi' 
                : 'Kaynak eklendi', 
            'success'
        );
    });

    this.showSourceHelper = false;
    this.sourceHelper = { node: null, category: 'Kaynaklar', name: '', url: '', editIndex: null };
},

        openSourceEditor(n){
          if (!n) return;
          this.sourceEdit.node = n;
          // Try sourcesText first; fallback to n.sources if needed
          let obj = {};
          if (n.sourcesText && this.isValidJSON(n.sourcesText)) {
            obj = JSON.parse(n.sourcesText);
          } else if (n.sources) {
            obj = n.sources;
          }
          // Normalize into arrays per category
          const cats = ['Kaynaklar','G√∂rsel','Platform'];
          const data = { Kaynaklar:[], G√∂rsel:[], Platform:[] };
          for (const c of cats){
            const key = this.mapCategory(c);
            const raw = obj[key] ?? obj[c] ?? [];
            const arr = Array.isArray(raw) ? raw : (raw ? [raw] : []);
            data[c] = arr.map(it => (typeof it === 'string'
              ? ({ name: it, url: it })
              : ({ name: (it?.name || it?.url || ''), url: (it?.url || '') })
            ));
          }
          this.sourceEdit.data = data;
          this.sourceEdit.open = true;
        },
        closeSourceEditor(){
          this.sourceEdit.open = false;
          this.sourceEdit.node = null;
          this.sourceEdit.data = { Kaynaklar:[], G√∂rsel:[], Platform:[] };
        },
        saveSourceEditor(){
          const n = this.sourceEdit.node;
          if (!n) return;
          const out = {};
          for (const c of ['Kaynaklar','G√∂rsel','Platform']){
            const cleaned = (this.sourceEdit.data[c]||[]).filter(r => (r.name||'').trim() || (r.url||'').trim())
              .map(r => ({ name: r.name?.trim() || (r.url||'').trim(), url: (r.url||'').trim() }));
            if (cleaned.length) out[c] = cleaned;
          }
          n.sourcesText = JSON.stringify(out, null, 2);
          this.touch();
          this.toast('Kaynaklar g√ºncellendi','success');
          this.closeSourceEditor();
        },
        addSourceRow(cat){
          if (!this.sourceEdit.data[cat]) this.sourceEdit.data[cat] = [];
          this.sourceEdit.data[cat].push({ name:'', url:'' });
        },
        removeSourceRow(cat, i){
          if (!this.sourceEdit.data[cat]) return;
          this.sourceEdit.data[cat].splice(i,1);
        },

        openSourceHelper(node){
    // node: satƒ±r referansƒ±, category: kategori adƒ±, index: d√ºzenlenecek kaynak indexi
    if (arguments.length >= 3) {
        const node = arguments[0], category = arguments[1], index = arguments[2];
        this.sourceHelper.node = node;
        this.sourceHelper.category = category || 'Kaynaklar';
        this.sourceHelper.editIndex = index;
        if (node.sourcesText && this.isValidJSON(node.sourcesText)) {
            const obj = JSON.parse(node.sourcesText);
            const arr = Array.isArray(obj[this.mapCategory(category)]) ? obj[this.mapCategory(category)] : [];
            if (arr[index]) {
                this.sourceHelper.name = arr[index].name || '';
                this.sourceHelper.url = arr[index].url || '';
            }
        }
    } else {
        this.sourceHelper.node = arguments[0];
        this.sourceHelper.category = 'Kaynaklar';
        this.sourceHelper.editIndex = null;
    }
    this.showSourceHelper = true;
},

        // Link tester (basic URL HEAD check via fetch)
        openLinkTester(){
          this.linkTest = { open:true, running:false, results:[], total:0, checked:0 };
        },
        closeLinkTester(){ this.linkTest.open=false; },
        async runLinkTests(){
          const selected = new Set(this.selectedNodeIds);
          const nodes = (this.current.nodes||[]).filter(n => selected.size ? selected.has(n.id) : true);
          const results = [];
          const push = (nodeId,label,category,name,url,ok,text) => results.push({ nodeId, label, category, name, url, ok, statusText:text });
          const all = [];
          for (const n of nodes){
            let srcObj = null;
            if (n.sourcesText && this.isValidJSON(n.sourcesText)) srcObj = JSON.parse(n.sourcesText);
            const normalized = this.normalizeSources(srcObj);
            for (const [cat, arr] of Object.entries(normalized)){
              for (const it of arr){
                all.push({ nodeId:n.id, label:n.label, category:cat, name:it.name, url:it.url });
              }
            }
          }
          this.linkTest.total = all.length;
          this.linkTest.running = true;
          for (const item of all){
            try{
              const r = await fetch(item.url, { method:'GET', mode:'no-cors' });
              // no-cors may not expose status; assume ok if no exception
              push(item.nodeId, item.label, item.category, item.name, item.url, true, 'OK');
            } catch(e){
              push(item.nodeId, item.label, item.category, item.name, item.url, false, 'Hata');
            }
            this.linkTest.checked = results.length;
            this.linkTest.results = [...results];
            await new Promise(r => setTimeout(r, 60));
          }
          this.linkTest.running = false;
          this.toast('Link testi tamamlandƒ±','success');
        },
      }
    }

    function downloadText(filename, text){
      const blob = new Blob([text], { type: 'application/json;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); setTimeout(()=>URL.revokeObjectURL(url), 500);
    }

    // Favicon helpers
    (function(){
      function safeHostname(u){ try { return (new URL(u)).hostname; } catch(e){ return ''; } }
      window.favicon = function(url){ const h = safeHostname(url); return h ? ("https://www.google.com/s2/favicons?domain=" + h) : ""; };
      window.hostName = function(url){ return safeHostname(url); };
    })();
  </script>
<script>
    // Optional: set this when API is on another origin (e.g. workers.dev)
    window.__ANALYTICS_BASE = 'https://evren-analytics.no-reply-bf4.workers.dev';
  </script>
<script>
window.__evrenStats = (function(){
  const charts = {};
  const C = (id) => {
    const el = document.getElementById(id);
    if (!el) return null;
    if (charts[id]) { charts[id].destroy(); delete charts[id]; }
    return el.getContext('2d');
  };

  // ---------- helpers ----------
  function getNodes(app){ try { return (app.current?.nodes) || []; } catch{ return []; } }
  function avgImdb(app){
    const nodes = getNodes(app);
    const ratings = nodes.map(n => Number(n.imdb_rating)).filter(x => !isNaN(x));
    if (!ratings.length) return null;
    const avg = ratings.reduce((a,b)=>a+b,0)/ratings.length;
    return avg.toFixed(2);
  }
  function computeData(app){
    const nodes = getNodes(app);
    const typeCounts = { movie:0, series:0 };
    const yearMap = new Map();
    const imdbBuckets = { '<5':0, '5-5.9':0, '6-6.9':0, '7-7.9':0, '8-8.9':0, '9-10':0 };
    for (const n of nodes){
      if (n.type==='series') typeCounts.series++; else typeCounts.movie++;
      const y = n.release_date ? new Date(n.release_date).getFullYear() : null;
      if (y) yearMap.set(y, (yearMap.get(y)||0)+1);
      const r = Number(n.imdb_rating);
      if (!isNaN(r)){
        if (r<5) imdbBuckets['<5']++; else if (r<6) imdbBuckets['5-5.9']++;
        else if (r<7) imdbBuckets['6-6.9']++; else if (r<8) imdbBuckets['7-7.9']++;
        else if (r<9) imdbBuckets['8-8.9']++; else imdbBuckets['9-10']++;
      }
    }
    const years = Array.from(yearMap.keys()).sort((a,b)=>a-b);
    const yearCounts = years.map(y => yearMap.get(y));
    return { typeCounts, years, yearCounts,
      imdbLabels: Object.keys(imdbBuckets), imdbCounts: Object.values(imdbBuckets) };
  }

  function baseOpts({legend=true, yTitle='', xTitle='', stacked=false, indexAxis='x'}={}){
    return {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: !!legend, position: 'top' },
        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        x: { grid: { display: false }, stacked, title: xTitle?{display:true,text:xTitle}:undefined },
        y: { grid: { color: 'rgba(255,255,255,0.06)' }, beginAtZero: true, stacked, title: yTitle?{display:true,text:yTitle}:undefined }
      },
      indexAxis
    };
  }

  function colors(n){
    const palette = [
      'rgba(59,130,246,0.7)',
      'rgba(16,185,129,0.7)',
      'rgba(236,72,153,0.7)',
      'rgba(234,179,8,0.7)',
      'rgba(168,85,247,0.7)',
      'rgba(244,114,182,0.7)',
      'rgba(34,197,94,0.7)',
      'rgba(14,165,233,0.7)',
    ];
    return Array.from({length:n}, (_,i)=>palette[i % palette.length]);
  }

  function rangeDays(range){ return ({'7d':7,'30d':30,'90d':90})[range]||30; }
  function today(){ const d=new Date(); d.setHours(0,0,0,0); return d; }
  function formatDate(d){ return d.toISOString().slice(0,10); }

  function genDemo(range){
    const days = rangeDays(range||'30d');
    const base = new Date(); base.setHours(0,0,0,0);
    const out = [];
    let visits = 0, pageviews = 0;
    for (let i=days-1;i>=0;i--){
      const day = new Date(base); day.setDate(base.getDate()-i);
      const v = Math.floor(50 + Math.random()*150);
      const pv = Math.floor(v * (1.4 + Math.random()*0.8));
      out.push({ date: day.toISOString().slice(0,10), visits: v, pageviews: pv });
      visits += v; pageviews += pv;
    }
    const devices = [
      { device:'desktop', count: Math.floor(pageviews*0.55) },
      { device:'mobile',  count: Math.floor(pageviews*0.38) },
      { device:'tablet',  count: Math.max(1, Math.floor(pageviews*0.07)) },
    ];
    const pages = [
      { path:'/evren',         views: Math.floor(pageviews*0.22) },
      { path:'/evren/marvel',  views: Math.floor(pageviews*0.18) },
      { path:'/starwars',      views: Math.floor(pageviews*0.12) },
      { path:'/blog',          views: Math.floor(pageviews*0.10) },
      { path:'/hakkimizda',    views: Math.floor(pageviews*0.06) },
    ];
    return { totals: { visits, visitors: Math.floor(visits*0.82), pageviews, bounce_rate: 0.48, avg_session_duration: 73 },
             timeseries: out, devices, pages };
  }

  function normalizeAPI(j, range){
    // Try to coerce various shapes into our expected {timeseries, devices, pages}
    const timeseries = j.timeseries || j.daily || j.data || [];
    const ts = timeseries.map(d => ({
      date: d.date || d.day || d[0] || formatDate(new Date()),
      visits: d.visits ?? d.sessions ?? d.count ?? d[1] ?? 0,
      pageviews: d.pageviews ?? d.pv ?? d[2] ?? d.visits ?? 0
    }));
    const devices = j.devices || j.by_device || [];
    const dev = devices.map(x => ({
      device: x.device || x.name || x[0] || 'other',
      count: x.count ?? x.value ?? x[1] ?? 0
    }));
    const pages = j.pages || j.popular_pages || [];
    const pg = pages.map(p => ({
      path: p.path || p.url || p[0] || '/',
      views: p.views ?? p.unique_visits ?? p.count ?? p[1] ?? 0
    }));
    if (!ts.length) return genDemo(range);
    return { totals: j.totals || {}, timeseries: ts, devices: dev, pages: pg };
  }

  async function fetchAnalytics(range){
    const base = window.__ANALYTICS_BASE || '';
    const url = (base||'') + '/api/analytics/report?range=' + encodeURIComponent(range || '30d');
    try {
      const res = await fetch(url, { cache:'no-store' });
      if (!res.ok) throw new Error('bad status');
      const j = await res.json();
      return normalizeAPI(j, range);
    } catch(e){
      return genDemo(range);
    }
  }

  let lastAnalytics = null;

  function drawDataCharts(app){
    const { typeCounts, years, yearCounts, imdbLabels, imdbCounts } = computeData(app);

    const ctx0 = C('chartTypeDonut');
    if (ctx0){
      charts['chartTypeDonut'] = new Chart(ctx0, {
        type: 'doughnut',
        data: { labels: ['Film', 'Dizi'], datasets: [{ data: [typeCounts.movie, typeCounts.series], backgroundColor: colors(2) }] },
        options: baseOpts({legend:true})
      });
    }

    const ctx1 = C('chartByYearArea');
    if (ctx1){
      charts['chartByYearArea'] = new Chart(ctx1, {
        type: 'line',
        data: { labels: years, datasets: [{ label: 'Yapƒ±m', data: yearCounts, fill:true, backgroundColor: 'rgba(59,130,246,0.25)', borderColor:'rgba(59,130,246,0.7)' }] },
        options: baseOpts({legend:false, yTitle:'Adet', xTitle:'Yƒ±l'})
      });
    }

    const ctx2 = C('chartImdbBars');
    if (ctx2){
      charts['chartImdbBars'] = new Chart(ctx2, {
        type: 'bar',
        data: { labels: imdbLabels, datasets: [{ data: imdbCounts, backgroundColor: colors(imdbLabels.length) }] },
        options: baseOpts({legend:false, yTitle:'Adet'})
      });
    }
  }

  function drawAnalyticsCharts(a){
    const visits = a.timeseries || [];
    const ctx3 = C('chartVisitsLine');
    if (ctx3){
      charts['chartVisitsLine'] = new Chart(ctx3, {
        type: 'line',
        data: {
          labels: visits.map(d=>d.date),
          datasets: [
            { label:'Ziyaret', data: visits.map(d=>d.visits), tension:0.3, fill:false, borderColor:'rgba(16,185,129,0.8)' },
            { label:'Sayfa G√∂r.', data: visits.map(d=>d.pageviews), tension:0.3, fill:false, borderColor:'rgba(59,130,246,0.8)' }
          ]
        },
        options: baseOpts({legend:true, yTitle:'Adet', xTitle:'Tarih'})
      });
    }

    const dev = a.devices || [];
    const ctx4 = C('chartDevicesDonut');
    if (ctx4){
      charts['chartDevicesDonut'] = new Chart(ctx4, {
        type: 'doughnut',
        data: { labels: dev.map(d=>d.device), datasets: [{ data: dev.map(d=>d.count), backgroundColor: colors(Math.max(3,dev.length||3)) }] },
        options: baseOpts({legend:true})
      });
    }

    const pages = (a.pages || []).slice(0,7);
    const ctx5 = C('chartTopPagesBarH');
    if (ctx5){
      charts['chartTopPagesBarH'] = new Chart(ctx5, {
        type: 'bar',
        data: { labels: pages.map(p=>p.path), datasets: [{ data: pages.map(p=>p.views), backgroundColor: colors(pages.length||5) }] },
        options: baseOpts({legend:false, yTitle:'G√∂r√ºn√ºm', indexAxis:'y'})
      });
    }
  }

  function attachExports(){
    const btnCsv = document.getElementById('exportCsvBtn');
    const btnJson = document.getElementById('exportJsonBtn');
    if (btnCsv){
      btnCsv.onclick = () => {
        const a = lastAnalytics || genDemo('30d');
        
        // Build CSV string
        const lines = ['date,visits,pageviews', ...(a.timeseries||[]).map(d => `${d.date},${d.visits},${d.pageviews}`)];
        const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url; link.download = 'analytics_timeseries.csv'; link.click();
        setTimeout(()=>URL.revokeObjectURL(url), 500);
      };
    }
    if (btnJson){
      btnJson.onclick = () => {
        const a = lastAnalytics || genDemo('30d');
        const blob = new Blob([JSON.stringify(a, null, 2)], {type:'application/json;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url; link.download = 'analytics_export.json'; link.click();
        setTimeout(()=>URL.revokeObjectURL(url), 500);
      };
    }
  }

  async function renderAll(appRoot){
    // Data (nodes) charts
    drawDataCharts(appRoot);
    // Analytics (server) charts
    const range = document.getElementById('analyticsRange')?.value || '30d';
    lastAnalytics = await fetchAnalytics(range);
    drawAnalyticsCharts(lastAnalytics);
    // KPI text
    try {
      const kpiImdb = document.querySelector('[x-text="window.__evrenStats?.avgImdb($root) ?? \'-\'"]');
      if (kpiImdb && typeof Alpine !== 'undefined'){ Alpine.mutateDom(()=>{}); } // no-op, keep Alpine happy
    } catch {}
    // export buttons
    attachExports();
  }

  return {
    avgImdb,
    renderAll
  };
})();
</script>
<div @keydown.escape.window="$store.edit.open=false" class="modal-mask" style="display:none; z-index:10030;" x-show="$store.edit.open" x-transition.opacity="">
<div class="modal-card">
<div class="modal-head">
<div class="font-semibold" x-text="$store.edit.title">JSON</div>
<button @click="$store.edit.open=false" class="w-8 h-8 rounded-full border border-white/20">‚úï</button>
</div>
<div class="modal-body">
<textarea class="w-full h-64 rounded-lg border border-white/20 bg-white/5 p-2 font-mono text-sm" placeholder='{"Kaynaklar":[...],"G√∂rsel":[...],"Platform":[...]}' x-model="$store.edit.text"></textarea>
</div>
<div class="modal-actions">
<button @click="$store.edit.open=false" class="px-3 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10">Vazge√ß</button>
<button @click="$store.edit.apply &amp;&amp; $store.edit.apply()" class="px-3 py-1.5 rounded border border-emerald-500/40 bg-emerald-600 hover:bg-emerald-700 text-white">Kaydet</button>
</div>
</div>
</div>
<div aria-live="polite" class="toast-wrap">
<template :key="t.id" x-for="t in $store.toast.items">
<div class="toast">
<div x-text="t.msg"></div>
</div>
</template>
</div>
<div class="bulkbar" style="display:none" x-show="selectedNodeIds &amp;&amp; selectedNodeIds.size" x-transition="">
<div class="text-sm">Se√ßili: <b x-text="selectedNodeIds.size"></b></div>
<button @click="bulkFillSources()" class="px-2 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-sm">Kaynak ≈ûablonu</button>
<button @click="saveDraft(); $store.toast.push('Taslak kaydedildi')" class="px-2 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-sm">Kaydet</button>
<button @click="deleteSelectedNodes(); $store.toast.push('Se√ßili yapƒ±mlar silindi')" class="px-2 py-1.5 rounded border border-rose-500/40 bg-rose-600 hover:bg-rose-700 text-white text-sm">Sil</button>
</div>
<div @keydown.escape.window="$store.form.open=false" class="modal-mask" style="display:none;z-index:10030;" x-show="$store.form.open" x-transition.opacity="">
<div @click.stop="" class="modal-card">
<div class="modal-head">
<div class="font-semibold" x-text="$store.form.title">Yapƒ±mƒ± D√ºzenle</div>
<button @click="$store.form.open=false" class="w-8 h-8 rounded-full border border-white/20">‚úï</button>
</div>
<div class="modal-body">
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
<div>
<div class="text-xs mb-1 opacity-80">ID</div>
<textarea class="w-full h-10 rounded border border-white/20 bg-white/5 p-2 font-mono text-sm" x-model="$store.form.tmp.id"></textarea>
</div>
<div>
<div class="text-xs mb-1 opacity-80">Ba≈ülƒ±k</div>
<input class="w-full rounded border border-white/20 bg-white/5 p-2" x-model="$store.form.tmp.label"/>
</div>
<div>
<div class="text-xs mb-1 opacity-80">Tarih</div>
<input class="w-full rounded border border-white/20 bg-white/5 p-2" type="date" x-model="$store.form.tmp.release_date"/>
</div>
<div>
<div class="text-xs mb-1 opacity-80">IMDb</div>
<input class="w-full rounded border border-white/20 bg-white/5 p-2" step="0.1" type="number" x-model="$store.form.tmp.imdb_rating"/>
</div>
<div class="sm:col-span-2">
<div class="text-xs mb-1 opacity-80">T√ºr</div>
<textarea class="w-full h-16 rounded border border-white/20 bg-white/5 p-2" x-model="$store.form.tmp.t√ºr"></textarea>
</div>
<div>
<div class="text-xs mb-1 opacity-80">Tip</div>
<select class="w-full rounded border border-white/20 bg-white/5 p-2" x-model="$store.form.tmp.type">
<option value="movie">Film</option>
<option value="series">Dizi</option>
</select>
</div>
<div>
<div class="text-xs mb-1 opacity-80">G√∂rsel (URL)</div>
<textarea class="w-full h-16 rounded border border-white/20 bg-white/5 p-2" x-model="$store.form.tmp.image"></textarea>
</div>
<div class="text-xs mb-1 opacity-80 flex items-center justify-between gap-2">
<span>Kaynaklar (JSON)</span>
<button @click="openSourceEditor($store.form.node)" class="px-2 py-1 rounded border border-white/20 bg-white/5 hover:bg-white/10 text-[11px]" title="Geli≈ümi≈ü JSON d√ºzenleyiciyi a√ß">
            Kaynak D√ºzenleyici
          </button>
</div>
</div>
<hr class="my-4 border-white/10"/>
<hr class="my-4 border-white/10"/>
<hr class="my-4 border-white/10"/>
<div class="space-y-2" x-data="{
       // styling map for edge types
       typeClasses: {
         'Devam': 'bg-blue-900/40 border-blue-500/30',
         'Takƒ±m Kurulumu': 'bg-emerald-900/30 border-emerald-500/20',
         'Karakter Ge√ßi≈üi': 'bg-slate-900/30 border-slate-500/20',
         'Gizli Baƒülantƒ±': 'bg-purple-900/30 border-purple-500/20',
         'Psikolojik Etki': 'bg-red-900/30 border-red-500/20',
         'Karakter Baƒülantƒ±sƒ±': 'bg-violet-900/30 border-violet-500/20',
         'Yeni Tehdit': 'bg-rose-900/30 border-rose-500/20',
         'Sonsuzluk Ta≈üƒ±': 'bg-amber-900/30 border-amber-400/20',
         'Siyasi √á√∂z√ºlme': 'bg-orange-900/30 border-orange-500/20',
         'Kozmik Katƒ±lƒ±m': 'bg-teal-900/30 border-teal-500/20',
         'Anahtar Karakter': 'bg-pink-900/30 border-pink-500/20',
         '√ñnemli Olay': 'bg-orange-800/30 border-orange-400/20',
         'Mekan Baƒülantƒ±sƒ±': 'bg-yellow-900/30 border-yellow-500/20',
         'Paralel Olay': 'bg-gray-800/30 border-gray-500/20',
         'Anahtar Olay': 'bg-amber-800/30 border-amber-500/20',
         'Sonrasƒ± Etki': 'bg-violet-800/30 border-violet-400/20',
         'Kozmik Geni≈üleme': 'bg-teal-800/30 border-teal-400/20',
         '√áoklu Evren': 'bg-cyan-900/30 border-cyan-500/20',
         'Evrensel Geli≈üme': 'bg-red-800/30 border-red-400/20',
         'Ana Hikaye Baƒülantƒ±sƒ±': 'bg-indigo-900/30 border-indigo-500/20',
         'Ana Tehdit': 'bg-red-950/30 border-red-600/20',
         'Doƒürudan Devam': 'bg-sky-900/30 border-sky-500/20',
         'Evrensel Baƒülantƒ±': 'bg-emerald-950/30 border-emerald-600/20',
         'Ge√ßmi≈ü Hikayesi': 'bg-stone-900/30 border-stone-500/20',
         'Hikaye Devamƒ±': 'bg-green-900/30 border-green-500/20',
         'Hikaye √ñncesi': 'bg-cyan-800/30 border-cyan-400/20',
         'Karakter Devamƒ±': 'bg-slate-800/30 border-slate-400/20',
         'Siyasi Etki': 'bg-orange-700/30 border-orange-300/20',
         'Crossover': 'bg-fuchsia-900/30 border-fuchsia-500/20',
         'Tarihsel Baƒülantƒ±': 'bg-gray-700/30 border-gray-400/20',
         'T√ºrsel Baƒülantƒ±': 'bg-purple-800/30 border-purple-300/20'
       },
       get allEdges(){ try { return (current?.edges||[]); } catch(e){ return []; } },
       get edges(){
         try {
           const id = $store.form?.node?.id;
           return (this.allEdges||[]).filter(e =&gt; e &amp;&amp; (e.from===id || e.to===id));
         } catch(e){ return []; }
       },
       // Search helpers
       uSearch:'', nSearch:'', tSearch:'',
       // New edge model
       newEdge: { universe:'', side:'to', other:'', type:'', notes:'' },
       add(){
         try{
           const id = $store.form?.node?.id;
           if(!id) return;
           const side = this.newEdge.side || 'to';
           const other = this.newEdge.other;
           const type = this.newEdge.type || '';
           if(!other) return;
           const e = { from: side==='to' ? id : other, to: side==='to' ? other : id, type: type, notes: this.newEdge.notes || '' };
           current.edges.push(e);
           this.newEdge = { universe:this.newEdge.universe, side:'to', other:'', type:'', notes:'' };
           try { Alpine.store('toast')?.push('Baƒülantƒ± eklendi'); } catch(err){}
         }catch(e){}
       },
       // utils
       typeLabel(t){ return t || 'T√ºr se√ß'; },
       typeClass(t){ return this.typeClasses[t] || 'bg-white/10 border-white/20'; },
       universeName(u){
         try {
           const lst = (universes||[]);
           const hit = lst.find(x =&gt; x===u || (x?.id===u));
           if(typeof hit==='string') return hit;
           return hit?.name || u || 'Evren se√ß';
         }catch(e){ return u || 'Evren se√ß'; }
       },
       nodeLabel(id){
         try {
           const n = (current?.nodes||[]).find(x =&gt; x.id===id);
           return n ? (n.label + ' (' + n.id + ')') : (id || 'Diƒüer yapƒ±m se√ß');
         }catch(e){ return id || 'Diƒüer yapƒ±m se√ß'; }
       }
     }">
<div class="text-sm font-semibold">Baƒülantƒ±lar</div>
<div class="flex justify-end mb-2">
<button @click="$store.edgeNew.open=true" class="px-3 py-1.5 rounded border border-white/20 bg-white/10 hover:bg-white/20 text-sm">
    + Yeni Baƒülantƒ±
  </button>
</div>
<!-- Edge list -->
<div class="space-y-2">
<template :key="i" x-for="(e, i) in edges">
<div :class="typeClass(e.type)" class="rounded p-2 text-sm flex items-start justify-between gap-2 border">
<div class="min-w-0">
<div class="font-medium">
<span x-text="e.from"></span>
<span>‚Üí</span>
<span x-text="e.to"></span>
</div>
<div class="text-xs opacity-90 mt-0.5 flex flex-wrap items-center gap-2">
<span class="px-1 py-0.5 rounded bg-white/10 border border-white/20" x-text="e.type || '-'"></span>
<span x-text="e.notes ? ' ‚Ä¢ ' + e.notes : ''"></span>
</div>
</div>
<div class="shrink-0 flex gap-2">
<button @click="
            (() =&gt; {
              const t = prompt('T√ºr', e.type || '');
              const n = prompt('Not', e.notes || '');
              if (t!==null) e.type=t;
              if (n!==null) e.notes=n;
              try { Alpine.store('toast')?.push('Baƒülantƒ± g√ºncellendi'); } catch(err){}
            })()
          " class="text-xs px-2 py-1 rounded border border-white/20 bg-white/10 hover:bg-white/20">‚úèÔ∏è</button>
<button @click="remove(i)" class="text-xs px-2 py-1 rounded border border-rose-500/40 bg-rose-600 hover:bg-rose-700 text-white">üóë</button>
</div>
</div>
</template>
<div class="text-xs opacity-70" x-show="!edges.length">Bu yapƒ±mla ili≈ükili baƒülantƒ± yok.</div>
</div>
<!-- Add new edge with searchable dropdowns -->
</div>
</div>
<div class="modal-actions">
<button @click="$store.form.open=false" class="px-3 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10">Vazge√ß</button>
<button @click="$store.form.save()" class="px-3 py-1.5 rounded border border-emerald-500/40 bg-emerald-600 hover:bg-emerald-700 text-white">Kaydet</button>
</div>
</div>
</div>
<div class="fixed inset-0 flex items-center justify-center bg-black/60 z-[10100]" style="display:none;z-index:10100;" x-show="$store.edgeNew.open" x-transition.opacity="">
<div @click.stop="" class="modal-card w-[92vw] max-w-[640px]">
<div class="modal-head">
<div class="font-semibold">Yeni Baƒülantƒ±</div>
<button @click="$store.edgeNew.open=false" class="w-8 h-8 rounded-full border border-white/20">‚úï</button>
</div>
<div class="modal-body">
<div class="space-y-3" x-data="{
             typeClasses: {
               'Devam': 'bg-blue-900/40 border-blue-500/30',
               'Takƒ±m Kurulumu': 'bg-emerald-900/30 border-emerald-500/20',
               'Karakter Ge√ßi≈üi': 'bg-slate-900/30 border-slate-500/20',
               'Gizli Baƒülantƒ±': 'bg-purple-900/30 border-purple-500/20',
               'Psikolojik Etki': 'bg-red-900/30 border-red-500/20',
               'Karakter Baƒülantƒ±sƒ±': 'bg-violet-900/30 border-violet-500/20',
               'Yeni Tehdit': 'bg-rose-900/30 border-rose-500/20',
               'Sonsuzluk Ta≈üƒ±': 'bg-amber-900/30 border-amber-400/20',
               'Siyasi √á√∂z√ºlme': 'bg-orange-900/30 border-orange-500/20',
               'Kozmik Katƒ±lƒ±m': 'bg-teal-900/30 border-teal-500/20',
               'Anahtar Karakter': 'bg-pink-900/30 border-pink-500/20',
               '√ñnemli Olay': 'bg-orange-800/30 border-orange-400/20',
               'Mekan Baƒülantƒ±sƒ±': 'bg-yellow-900/30 border-yellow-500/20',
               'Paralel Olay': 'bg-gray-800/30 border-gray-500/20',
               'Anahtar Olay': 'bg-amber-800/30 border-amber-500/20',
               'Sonrasƒ± Etki': 'bg-violet-800/30 border-violet-400/20',
               'Kozmik Geni≈üleme': 'bg-teal-800/30 border-teal-400/20',
               '√áoklu Evren': 'bg-cyan-900/30 border-cyan-500/20',
               'Evrensel Geli≈üme': 'bg-red-800/30 border-red-400/20',
               'Ana Hikaye Baƒülantƒ±sƒ±': 'bg-indigo-900/30 border-indigo-500/20',
               'Ana Tehdit': 'bg-red-950/30 border-red-600/20',
               'Doƒürudan Devam': 'bg-sky-900/30 border-sky-500/20',
               'Evrensel Baƒülantƒ±': 'bg-emerald-950/30 border-emerald-600/20',
               'Ge√ßmi≈ü Hikayesi': 'bg-stone-900/30 border-stone-500/20',
               'Hikaye Devamƒ±': 'bg-green-900/30 border-green-500/20',
               'Hikaye √ñncesi': 'bg-cyan-800/30 border-cyan-400/20',
               'Karakter Devamƒ±': 'bg-slate-800/30 border-slate-400/20',
               'Siyasi Etki': 'bg-orange-700/30 border-orange-300/20',
               'Crossover': 'bg-fuchsia-900/30 border-fuchsia-500/20',
               'Tarihsel Baƒülantƒ±': 'bg-gray-700/30 border-gray-400/20',
               'T√ºrsel Baƒülantƒ±': 'bg-purple-800/30 border-purple-300/20'
             },
             uSearch:'', nSearch:'', tSearch:'',
             typeLabel(t){ return t || 'T√ºr se√ß'; },
             typeClass(t){ return this.typeClasses[t] || 'bg-white/10 border-white/20'; },
             universeName(u){
               try {
                 const lst = (universes||[]);
                 const hit = lst.find(x =&gt; x===u || (x?.id===u));
                 if(typeof hit==='string') return hit;
                 return hit?.name || u || 'Evren se√ß';
               }catch(e){ return u || 'Evren se√ß'; }
             },
             nodeLabel(id){
               try {
                 const n = (current?.nodes||[]).find(x =&gt; x.id===id);
                 return n ? (n.label + ' (' + n.id + ')') : (id || 'Diƒüer yapƒ±m se√ß');
               }catch(e){ return id || 'Diƒüer yapƒ±m se√ß'; }
             }
           }">
<!-- Universe -->
<div class="relative" x-data="{ open:false }">
<div class="text-xs mb-1 opacity-80">Evren</div>
<button @click="open=!open" class="w-full text-left rounded border border-white/20 bg-white/5 p-2 text-sm flex items-center justify-between">
<span x-text="$store.edgeNew.tmp.universe ? universeName($store.edgeNew.tmp.universe) : 'Evren se√ß'"></span>
<span>‚ñæ</span>
</button>
<div @click.outside="open=false" class="absolute left-0 right-0 mt-1 rounded-lg border border-white/20 bg-slate-900/95 p-2 z-50 z-[10110]" style="overflow:auto; max-height:60vh; z-index:10110;" x-show="open" x-transition="">
<input class="w-full mb-2 rounded border border-white/20 bg-white/5 p-2 text-sm" placeholder="Evren ara..." x-model="uSearch"/>
<div class="max-h-48 overflow-y-auto">
<template :key="u" x-for="u in (universes||[]).filter(x =&gt; universeName(x).toLowerCase().includes((uSearch||'').toLowerCase()))">
<div @click="$store.edgeNew.tmp.universe = (typeof u==='string'?u:(u?.id||u?.name)); open=false" class="px-2 py-1 rounded hover:bg-white/10 cursor-pointer" x-text="universeName(u)"></div>
</template>
</div>
</div>
</div>
<!-- Direction + other node -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
<div>
<div class="text-xs mb-1 opacity-80">Y√∂n</div>
<select class="w-full rounded border border-white/20 bg-white/5 p-2 text-sm" x-model="$store.edgeNew.tmp.side">
<option value="to">Bu yapƒ±mdan ‚Üí Diƒüerine</option>
<option value="from">Diƒüerinden ‚Üí Bu yapƒ±m</option>
</select>
</div>
<div class="sm:col-span-2 relative" x-data="{open:false}">
<div class="text-xs mb-1 opacity-80">Diƒüer Yapƒ±m</div>
<button @click="open=!open" class="w-full text-left rounded border border-white/20 bg-white/5 p-2 text-sm flex items-center justify-between">
<span x-text="nodeLabel($store.edgeNew.tmp.other)"></span>
<span>‚ñæ</span>
</button>
<div @click.outside="open=false" class="absolute left-0 right-0 mt-1 rounded-lg border border-white/20 bg-slate-900/95 p-2 z-50 z-[10110]" style="overflow:auto; max-height:60vh; z-index:10110;" x-show="open" x-transition="">
<input class="w-full mb-2 rounded border border-white/20 bg-white/5 p-2 text-sm" placeholder="Yapƒ±m ara..." x-model="nSearch"/>
<div class="max-h-60 overflow-y-auto">
<template :key="n.id" x-for="n in (current?.nodes||[]).filter(nn =&gt; !nSearch || ( (nn.label||'').toLowerCase().includes(nSearch.toLowerCase()) || (nn.id||'').toLowerCase().includes(nSearch.toLowerCase()) ))">
<div @click="$store.edgeNew.tmp.other = n.id; open=false" class="px-2 py-1 rounded hover:bg-white/10 cursor-pointer" x-text="n.label + ' (' + n.id + ')'"></div>
</template>
</div>
</div>
</div>
</div>
<!-- Type + notes -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
<div class="sm:col-span-1 relative" x-data="{open:false}">
<div class="text-xs mb-1 opacity-80">T√ºr</div>
<button @click="open=!open" class="w-full text-left rounded border border-white/20 bg-white/5 p-2 text-sm flex items-center justify-between">
<span x-text="$store.edgeNew.tmp.type || 'T√ºr se√ß'"></span>
<span>‚ñæ</span>
</button>
<div @click.outside="open=false" class="absolute left-0 right-0 mt-1 rounded-lg border border-white/20 bg-slate-900/95 p-2 z-50 z-[10110]" style="overflow:auto; max-height:60vh; z-index:10110;" x-show="open" x-transition="">
<input class="w-full mb-2 rounded border border-white/20 bg-white/5 p-2 text-sm" placeholder="T√ºr ara..." x-model="tSearch"/>
<div class="max-h-60 overflow-y-auto">
<template :key="key" x-for="(cls, key) in Object.fromEntries(Object.entries(typeClasses).filter(([k]) =&gt; (k||'').toLowerCase().includes((tSearch||'').toLowerCase())))">
<div :class="cls + ' hover:bg-white/10'" @click="$store.edgeNew.tmp.type = key; open=false" class="px-2 py-1 rounded cursor-pointer border">
<span x-text="key"></span>
</div>
</template>
</div>
</div>
</div>
<div class="sm:col-span-2">
<div class="text-xs mb-1 opacity-80">Not</div>
<input class="w-full rounded border border-white/20 bg-white/5 p-2 text-sm" placeholder="Not (opsiyonel)" x-model="$store.edgeNew.tmp.notes"/>
</div>
</div>
</div>
</div>
<div class="modal-actions">
<button @click="$store.edgeNew.open=false" class="px-3 py-1.5 rounded border border-white/20 bg-white/5 hover:bg-white/10">Vazge√ß</button>
<button @click="$store.edgeNew.save()" class="px-3 py-1.5 rounded border border-emerald-500/40 bg-emerald-600 hover:bg-emerald-700 text-white">Ekle</button>
</div>
</div>
</div>
</body>
</html>