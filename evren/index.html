<!DOCTYPE html>

<html lang="tr" x-data="app()" x-init="init()">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>ğŸ¬ Film Evreni AÄŸÄ±</title>
<script src="app.obf.js"></script>

<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js" defer></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/shepherd.js@8.4.1/dist/js/shepherd.min.js"></script>
<script src="assets/js/shepherd.min.js"></script>


<style>
    :root { color-scheme: dark; }
    html, body { height: 100%; margin: 0; color: #d1d5db; font-family: 'Segoe UI', system-ui, -apple-system, Roboto, 'Helvetica Neue', Arial, sans-serif; background: transparent; }
    #bgImg{ position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; filter: blur(12px) brightness(0.65); transform: scale(1.06); z-index: -2; backface-visibility: hidden; will-change: transform; }
    #bgOverlay{ position: fixed; inset: 0; z-index:-1; background: rgba(0,0,0,0.35); }
    #network { position: fixed; inset: 0; background: transparent; border: none; }
    .glass { background: rgba(31,41,55,0.45); border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 12px 30px rgba(0,0,0,0.35); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); }
    input { color: #e5e7eb; background-color: rgba(55,65,81,0.55); border: 1px solid rgba(255,255,255,0.12); outline: none; }
    input::placeholder { color: #9ca3af; }
    .ac-panel { background: rgba(31,41,55,0.9); border: 1px solid rgba(255,255,255,0.14); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); box-shadow: 0 14px 28px rgba(0,0,0,0.5); }
    .ac-item { cursor: pointer; }
    .ac-item:hover { background: rgba(255,255,255,0.08); }
    .dropdown-btn { cursor: pointer; }
    .dropdown-panel { background: rgba(31,41,55,0.65); border: 1px solid rgba(255,255,255,0.14); box-shadow: 0 16px 40px rgba(0,0,0,0.45); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
    .dropdown-item { cursor: pointer; }
    .dropdown-item:hover { background: rgba(255,255,255,0.06); }
    .modal-bg { background: rgba(0,0,0,0.75); backdrop-filter: blur(4px); }
    .modal-content { width: 92vw; max-width: 780px; max-height: 85vh; overflow-y: auto; background: #0f172a; color: #e5e7eb; border-radius: 18px; padding: 0; box-shadow: 0 12px 24px rgba(0,0,0,0.45); position: absolute; top: 10px; border: 1px solid rgba(255,255,255,0.08); }
    .modal-header { display: grid; grid-template-columns: 120px 1fr; gap: 16px; padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.06); background: radial-gradient(1200px 400px at -20% -40%, rgba(239,68,68,0.08), transparent); }
    .poster { width: 120px; height: 160px; border-radius: 10px; object-fit: cover; background: #111827; border: 1px solid rgba(255,255,255,0.08); }
    .modal-body { padding: 16px; }
    .chip { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); padding: 4px 10px; border-radius: 999px; font-size: 12px; }
    .meta-grid { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 10px; }
    .meta-item { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); padding: 10px 12px; border-radius: 12px; }
    .section-title { font-size: 0.9rem; opacity: 0.85; margin-bottom: 6px; }
    .close-btn { position: absolute; top: 12px; right: 12px; width: 36px; height: 36px; border-radius: 999px; display: grid; place-items: center; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); cursor: pointer; }
    .close-btn:hover { background: rgba(239,68,68,0.15); border-color: rgba(239,68,68,0.5); }
    #legendWrap { position: fixed; left: 16px; bottom: 4.5rem; z-index: 40; }
    #legendToggle { margin-bottom: 8px; background: rgba(31,41,55,0.55); border: 1px solid rgba(255,255,255,0.14); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); }
    #legend { background: rgba(31,41,55,0.45); border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 8px 18px rgba(0,0,0,0.35); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); border-radius: 12px; padding: 12px 16px; max-width: 320px; max-height: 260px; overflow-y: auto; font-size: 0.85rem; }
    @media (max-width: 640px) { #legend { font-size: 0.72rem; max-width: 220px; padding: 8px 10px; } }
    .share-bar { position: absolute; top: 8px; left: 12px; right: 56px; display:flex; align-items:center; gap:8px; opacity:.95; }
    .share-btn { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:10px; background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.14); font-size:12px; }
    .share-btn:hover { background: rgba(255,255,255,0.1); }
    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }
  </style>

<style>
  #network {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    border: none;
    z-index: 0;
  }
</style>


<!-- Shepherd.js CSS ve JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js/dist/css/shepherd.css"/>
<script src="https://cdn.jsdelivr.net/npm/shepherd.js@8.4.1/dist/js/shepherd.min.js"></script>


<style>
  
  .shepherd-cancel-icon {
    color: #fff !important;
  }
</style>
<style>
  
  .shepherd-cancel-icon {
    color: #fff !important;
  }
</style>


<style>
.shepherd-element {
  max-width: 85vw;
  min-width: auto;
  max-height: 20vh;
  height: auto;
  overflow-y: auto;
  padding: 0.5rem;
  font-size: 0.2rem;
  backdrop-filter: blur(12px);
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 1rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  color: white;
}

@media (min-width: 640px) {
  .shepherd-element {
    max-width: 260px;
  }
}

  .shepherd-text,
  .shepherd-title,
  .shepherd-button {
    color: white !important;
  }

  .shepherd-header {
    background: transparent !important;
    border-bottom: none !important;
  }

  .shepherd-button {
    background-color: #2564eb73;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.7rem;
    border: none;
    margin-left: 0.2rem;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
  }

  .shepherd-button:hover {
    background-color: #1d4ed8;
  }

  .shepherd-cancel-icon {
    color: white !important;
  }
</style>


<style>
  .tl-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.65); backdrop-filter: blur(4px); z-index: 70; }
  .tl-panel { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(17,24,39,0.98); border-top: 1px solid rgba(255,255,255,0.1); z-index: 80; max-height: 70vh; }
  .tl-year { font-weight: 700; opacity: .9; }
  .tl-col { min-width: 260px; max-width: 280px; }
  .tl-card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; padding: 10px; cursor: pointer; transition: transform .15s ease, background .15s ease; }
  .tl-card:hover { transform: translateY(-2px); background: rgba(255,255,255,0.06); }
  .tl-poster { width: 52px; height: 72px; border-radius: 8px; object-fit: cover; background: #0b1220; border: 1px solid rgba(255,255,255,0.08); }
  .tl-badge { font-size: 10px; padding: 2px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); }
</style>


<style>
  .tl-scroll { -webkit-overflow-scrolling: touch; overscroll-behavior-inline: contain; }
</style>
</head>



<body :class="{ 'overflow-hidden': modalOpen }" class="dark flex-col min-h-[100dvh] flex">

<!-- GH Pages SPA redirect consumer -->
<script>
(function(){
  try {
    var r = sessionStorage.getItem('redirect');
    if (r) {
      sessionStorage.removeItem('redirect');
      // Put the original path back into the address bar (no reload)
      if (history && history.replaceState) history.replaceState({}, '', r);
    }
  } catch(e) { /* ignore */ }
})();
</script>

<img :src="bgUrl" alt="" id="bgImg"/>
<div id="bgOverlay"></div>
<style>
@media (max-width: 639px) {
  .mobile-centered {
    max-height: 60vh;          /* Daha kÄ±sa */
    overflow-y: auto;
    position: relative;
    top: 10%;
    transform: translateY(-10%);
    padding: 0.75rem;          /* p-3 boyutunda */
    font-size: 0.8rem;         /* text-xs ile text-sm arasÄ± */
    border-radius: 0.75rem;    /* KÃ¶ÅŸeleri biraz daha yuvarlak */
  }

  .mobile-centered h2 {
    font-size: 1.1rem;         /* BaÅŸlÄ±k kÃ¼Ã§Ã¼lsÃ¼n */
  }

  .mobile-centered p {
    font-size: 0.78rem;        /* Paragraflar daha kÃ¼Ã§Ã¼k */
    line-height: 1.3;
  }

  .mobile-centered .grid > div {
    padding: 0.5rem;           /* Ä°Ã§ kartlar daha dar */
  }
}


</style>

<!-- HoÅŸ Geldin Bilgilendirmesi -->
<div x-show="!selectedUniverse && !panel"
     class="fixed inset-0 flex items-center justify-center z-50">
  <div style="max-height: 70vh; overflow-y: auto; " class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-2xl backdrop-blur-md space-y-4">
    <h2 class="text-xl sm:text-2xl font-bold text-center">ğŸ¬ Film Evreni AÄŸÄ±'na HoÅŸ Geldin!</h2>
    <p class="text-base text-center text-white/80">Bu platform, farklÄ± sinematik evrenler arasÄ±nda baÄŸ kurmanÄ± ve yapÄ±mlarÄ± daha derinlemesine keÅŸfetmeni saÄŸlar.</p>
    <div class="grid grid-cols-1 gap-2 text-xs mt-1 sm:grid-cols-2 sm:gap-4 sm:text-sm">
      <div class="bg-white/10 rounded-lg p-4 border border-white/10">
        <h3 class="font-semibold mb-2">ğŸ—ºï¸ EtkileÅŸimli Harita</h3>
        <p>SeÃ§tiÄŸin evrene ait yapÄ±mlar arasÄ±ndaki baÄŸlantÄ±larÄ± grafik olarak gÃ¶rebilirsin.</p>
      </div>
      <div class="bg-white/10 rounded-lg p-4 border border-white/10">
        <h3 class="font-semibold mb-2">ğŸï¸ YapÄ±m DetaylarÄ±</h3>
        <p>Her film veya diziye tÄ±klayarak Ã¶zet, oyuncular, gÃ¶ndermeler ve notlarÄ± gÃ¶rÃ¼ntÃ¼leyebilirsin.</p>
      </div>
      <div class="bg-white/10 rounded-lg p-4 border border-white/10">
        <h3 class="font-semibold mb-2">ğŸ“ Kendi NotlarÄ±nÄ± Ekle</h3>
        <p>YapÄ±mlara kiÅŸisel notlar ekleyebilir, dÃ¼zenleyebilir veya silebilirsin.</p>
      </div>
      <div class="bg-white/10 rounded-lg p-4 border border-white/10">
        <h3 class="font-semibold mb-2">â­ Favorilerine Ekle</h3>
        <p>Ä°zlemek istediÄŸin veya beÄŸendiÄŸin yapÄ±mlarÄ± favori listene ekleyebilirsin.</p>
      </div>
    </div>
    <p class="text-center text-white/60 text-sm pt-2">BaÅŸlamak iÃ§in yukarÄ±dan bir <strong>film evreni</strong> seÃ§ ğŸŒŒ</p>
<div class="text-center">
  <button @click="startTour()" class="mt-4 px-5 py-2 bg-white/10 border border-white/20 text-white text-sm rounded-lg hover:bg-white/20 transition">
    ğŸš€ Rehbere BaÅŸla
  </button>
</div>

  </div>
</div>

<header class="fixed top-4 left-0 right-0 z-50">
<div class="w-full sm:max-w-md lg:max-w-lg mx-auto px-3">
<div class="glass rounded-xl px-3 py-2">
  <div class="flex flex-col gap-2">
    <div class="flex items-center justify-center">
<h1 id="secretAdminTap" class="text-base sm:text-lg font-bold text-center">ğŸ¬ Film Evreni AÄŸÄ±</h1>

    </div>

    <!-- Mobilde arama ve anasayfa yanyana, dropdown altta olacak sekilde yeniden yapÄ±landÄ±rÄ±ldÄ± -->
<div class="flex flex-col sm:flex-row gap-2">

  <!-- Mobil/masaÃ¼stÃ¼: Anasayfa + Arama + Mobil Filtre aynÄ± satÄ±r -->
  <div class="flex flex-row items-center gap-2 w-full sm:flex-1 sm:basis-0 sm:min-w-0">

    <!-- Anasayfa -->
    <a href="./" title="Anasayfa"
       class="text-white border border-white/30 hover:bg-white/10 rounded-md p-2 transition w-9 h-9 flex items-center justify-center"">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
           stroke-width="2" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 10v10h6v-6h4v6h6V10L12 3z"/>
      </svg>
    </a>

    <!-- Arama -->
    <div class="relative flex-1 min-w-0">
      <input
        @blur="setTimeout(() => acOpen = false, 120)"
        @focus="acOpen = true"
        class="border rounded-lg px-3 py-1.5 w-full pr-10"
        placeholder="Ara..."
        type="search"
        x-model="search"
      />
      <button
        @click="search=''; suggestions=[]; applyFilters()"
        @mousedown.prevent
        aria-label="Temizle"
        class="absolute inset-y-0 right-2 my-auto h-6 w-6 rounded-full grid place-items-center opacity-80 hover:opacity-100 hover:bg-white/10"
        x-show="search"
        style="display:none;">
        <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12l-4.9 4.89a1 1 0 1 0 1.41 1.41L12 13.41l4.89 4.9a1 1 0 0 0 1.41-1.41L13.41 12l4.9-4.89a1 1 0 0 0-.01-1.4Z"/>
        </svg>
      </button>
      <!-- AC panel -->
      <div class="ac-panel absolute z-50 w-full mt-1 rounded-lg overflow-hidden max-h-56 overflow-y-auto"
           x-show="acOpen && search && suggestions.length" style="display:none;">
        <template x-for="(s, idx) in suggestions" :key="s">
          <div @click="search = s; acOpen=false; applyFilters();" @mousedown.prevent class="ac-item px-3 py-1.5">
            <span x-text="s"></span>
          </div>
        </template>
      </div>
    </div>

                <!-- Filtre butonu: mobil -->
                <button
                  @click="openFilterPanel = !openFilterPanel"
                  class="relative flex h-9 w-9 items-center justify-center rounded-md border border-white/30 transition hover:bg-white/10 sm:hidden"
                  title="Filtreler"
                >
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
           stroke-width="2" stroke="currentColor" class="w-5 h-5 text-white">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h18v2l-6 6v4.6l-4 2V12L3 6z"/>
      </svg>
      <span x-show="activeFilterCount" class="absolute -top-1 -right-1 text-[10px] px-1.5 py-[1px] rounded-full bg-emerald-500 text-black font-semibold">
        <span x-text="activeFilterCount"></span>
      </span>
    </button>
  </div>

  <!-- Evren SeÃ§imi -->
  <div class="relative flex-1 basis-0 min-w-0" x-data="{ open:false, filterText:'' }">
    <div :aria-expanded="open" @click="open=!open"
         class="dropdown-btn border rounded-lg px-3 py-1.5 w-full flex items-center justify-between select-none">
      <span class="truncate" x-text="selectedUniverse ? formatUniverseName(selectedUniverse) : 'TÃ¼m Evrenler'">TÃ¼m Evrenler</span>
      <svg class="h-4 w-4 opacity-80 ml-2" fill="currentColor" viewBox="0 0 20 20">
        <path clip-rule="evenodd" fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"/>
      </svg>
    </div>
    <div class="dropdown-panel absolute mt-2 left-0 right-0 rounded-xl overflow-hidden"
         style="z-index:60; display:none;" x-show="open" x-transition>
      <div class="p-2 border-b border-white/10">
        <input class="w-full px-3 py-2 rounded-lg border" placeholder="Evren ara..." x-model="filterText">
      </div>
      <ul class="max-h-64 overflow-y-auto">
        <template x-for="u in universeList.filter(u => !filterText || formatUniverseName(u).toLowerCase().includes(filterText.toLowerCase()))" :key="u">
          <li @click="selectedUniverse=u; open=false; filterText=''; applyFilters()"
              class="dropdown-item px-3 py-2" x-text="formatUniverseName(u)"></li>
        </template>
      </ul>
    </div>
  </div>

              <button
                @click="openFilterPanel = !openFilterPanel"
                id="filter_btn"
                class="relative hidden h-9 w-9 items-center justify-center rounded-md border border-white/30 transition hover:bg-white/10 sm:flex"
                title="Filtreler"
              >
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
         stroke-width="2" stroke="currentColor" class="w-5 h-5 text-white">
      <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h18v2l-6 6v4.6l-4 2V12L3 6z"/>
    </svg>
    <span x-show="activeFilterCount" class="absolute -top-1 -right-1 text-[10px] px-1.5 py-[1px] rounded-full bg-emerald-500 text-black font-semibold">
      <span x-text="activeFilterCount"></span>
    </span>
  </button>

</div>



  </div>
</div>
</div>
</header>
<!-- Overlay -->
<div
  x-show="openFilterPanel"
  @click="openFilterPanel = false"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[70]"
  x-transition.opacity
></div>

<!-- Drawer (Filtre Paneli) -->
<aside
  x-show="openFilterPanel"
  @keydown.escape.window="openFilterPanel=false"
  class="fixed right-0 top-0 bottom-0 w-[92vw] sm:w-[360px] z-[80] glass border-l border-white/20 p-4 overflow-y-auto"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="translate-x-full"
  x-transition:enter-end="translate-x-0"
  x-transition:leave="transition ease-in duration-150"
  x-transition:leave-start="translate-x-0"
  x-transition:leave-end="translate-x-full"
>
  <div class="flex items-center justify-between mb-3">
    <h3 class="text-lg font-semibold">Filtreler</h3>
    <button @click="openFilterPanel=false" class="w-8 h-8 rounded-full bg-white/10 border border-white/20">âœ•</button>
  </div>

  <!-- YapÄ±m Tipi -->
  <div class="mb-4">
    <div class="text-sm font-medium mb-2">YapÄ±m Tipi</div>
    <div class="inline-flex rounded-lg overflow-hidden border border-white/20">
      <button @click="filters.type='all'"  :class="filters.type==='all'  ? 'bg-white/20' : 'bg-white/5'" class="px-3 py-1.5 text-sm">Hepsi</button>
      <button @click="filters.type='film'" :class="filters.type==='film' ? 'bg-white/20' : 'bg-white/5'" class="px-3 py-1.5 text-sm">Film</button>
      <button @click="filters.type='dizi'" :class="filters.type==='dizi' ? 'bg-white/20' : 'bg-white/5'" class="px-3 py-1.5 text-sm">Dizi</button>
    </div>
  </div>

<!-- TÃ¼r (Genre) -->
<div class="mb-4">
  <div class="text-sm font-medium mb-2">TÃ¼r</div>
  <div class="flex flex-wrap gap-2">
    <template x-for="g in availableGenres" :key="g">
      <label
        class="px-2 py-1 rounded-full border cursor-pointer select-none text-xs transition"
        :class="filters.genres.includes(g)
          ? 'bg-emerald-500 border-emerald-500 text-black'
          : 'bg-white/5 border-white/20 text-white hover:bg-white/10'">
        
        <input type="checkbox" class="hidden" :value="g" x-model="filters.genres">
        <span x-text="g"></span>
      </label>
    </template>
  </div>
</div>


  <!-- YÄ±l aralÄ±ÄŸÄ± -->
  <div class="mb-4 grid grid-cols-2 gap-2">
    <div>
      <div class="text-sm font-medium mb-1">YÄ±l (min)</div>
      <input type="number" class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" placeholder="2008" x-model.number="filters.yearMin">
    </div>
    <div>
      <div class="text-sm font-medium mb-1">YÄ±l (max)</div>
      <input type="number" class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" placeholder="2025" x-model.number="filters.yearMax">
    </div>
  </div>

  
  <!-- HazÄ±r YÄ±l AralÄ±klarÄ± -->
  <div class="mb-4">
    <div class="text-sm font-medium mb-2">HazÄ±r YÄ±l Filtreleri</div>
    <div class="flex flex-wrap gap-2">
      <button @click="filters.yearMin = new Date().getFullYear() - 1; filters.yearMax = new Date().getFullYear(); applyFilters()" class="px-2 py-1 rounded bg-white/10 hover:bg-white/20 text-xs">Son 1 YÄ±l</button>
      <button @click="filters.yearMin = new Date().getFullYear() - 5; filters.yearMax = new Date().getFullYear(); applyFilters()" class="px-2 py-1 rounded bg-white/10 hover:bg-white/20 text-xs">Son 5 YÄ±l</button>
      <button @click="filters.yearMin = 2010; filters.yearMax = 2019; applyFilters()" class="px-2 py-1 rounded bg-white/10 hover:bg-white/20 text-xs">2010â€“2019</button>
      <button @click="filters.yearMin = 2000; filters.yearMax = 2009; applyFilters()" class="px-2 py-1 rounded bg-white/10 hover:bg-white/20 text-xs">2000â€“2009</button>
      <button @click="filters.yearMin = null; filters.yearMax = 1999; applyFilters()" class="px-2 py-1 rounded bg-white/10 hover:bg-white/20 text-xs">2000 Ã–ncesi</button>
    </div>
  </div>

  <!-- IMDb -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-1">
      <div class="text-sm font-medium">IMDb (en az)</div>
      <div class="text-xs opacity-80" x-text="filters.imdbMin ?? '-'"></div>
    </div>
    <input type="range" min="0" max="10" step="0.1" x-model.number="filters.imdbMin" class="w-full">
    <div class="text-xs opacity-70 mt-1">0 â€“ 10</div>
  </div>

  <!-- Aksiyonlar -->
  <div class="flex gap-2">
    <button @click="applyFilters(); openFilterPanel=false" class="px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-700 text-white text-sm">Uygula</button>
    <button @click="resetFilters()" class="px-3 py-2 rounded bg-white/10 border border-white/20 text-sm">SÄ±fÄ±rla</button>
  </div>
</aside>
<div id="network" x-show="selectedUniverse" x-transition x-show="showGraph" x-transition></div>

<div @click.outside="if (!window.Shepherd?.activeTour) modalOpen=false; resetPrettyUrl && resetPrettyUrl()" @keydown.escape.window="modalOpen=false; resetPrettyUrl && resetPrettyUrl()" aria-labelledby="modalTitle" aria-modal="true" class="fixed inset-0 modal-bg flex items-center justify-center z-50 p-4" role="dialog" id="modal_container" x-show="modalOpen" x-transition="">
<div @click.stop="" class="modal-content" style="overflow-y: visible;">
<div class="relative rounded-xl overflow-hidden backdrop-blur-md bg-black/50 text-white max-h-[90vh] overflow-y-visible">
<!-- Ãœst blur gÃ¶rsel alanÄ± -->
<div class="relative h-64">
<img :src="modalNode.image" alt="" class="absolute inset-0 w-full h-full object-cover blur-xl brightness-50 scale-105"/>
<div class="absolute inset-0 flex flex-col justify-between p-4 z-10"><div class="absolute top-3 left-3 flex gap-2 items-center"><div class="flex gap-2 items-center">
<button @click="shareToX(modalNode)" class="text-white hover:opacity-80" title="X paylaÅŸ">
<img alt="X" src="https://img.icons8.com/ios-filled/20/ffffff/twitterx.png"/>
</button>
<button @click="shareToWhatsApp(modalNode)" class="text-white hover:opacity-80" title="WhatsApp">
<img alt="WA" src="https://img.icons8.com/ios-filled/20/ffffff/whatsapp.png"/>
</button>
<button @click="shareToLinkedIn(modalNode)" class="text-white hover:opacity-80" title="LinkedIn">
<img alt="IN" src="https://img.icons8.com/ios-filled/20/ffffff/linkedin.png"/>
</button>
<button @click="copyShare(modalNode)" class="text-white hover:opacity-80" title="Kopyala">ğŸ“‹</button>
</div></div><div class="absolute top-3 right-3 flex gap-2 items-center z-20"><div @click="modalOpen=false; resetPrettyUrl && resetPrettyUrl()" class="close-btn" id="modal-close">âœ•</div></div>
<!-- Ãœst Ã§ubuk -->
<div class="flex justify-between items-start"><div class="absolute top-3 right-3 flex gap-2 items-center z-20"></div></div>
<!-- Alt bilgi -->
<div class="flex justify-between mt-4">
<div class="text-xs bg-black/40 px-3 py-1 rounded-full">
<div class="font-semibold text-white/70 text-[10px]">Vizyon Tarihi</div>
<span x-text="toTRDate(modalNode.release_date)">-</span>
</div>
<div class="text-xs flex gap-2 items-center bg-black/40 px-3 py-1 rounded-full">
<span x-text="modalNode.type || '-'"></span>
<span class="text-white/80">|</span>
<span x-text="'IMDB: ' + (modalNode.imdb_rating || '-')">IMDB</span>
</div>
</div>
</div>
<template x-if="showPosterDialog">
<div @click.self="showPosterDialog = false" class="fixed inset-0 z-\[9999\] z-\[999\] z-50 bg-black/70 backdrop-blur-md z-50 flex items-center justify-center">
<div class="p-4 rounded-xl shadow-2xl max-w-[90vw] max-h-[85vh]" style="z-index:10000;" style="z-index:1000;" style="z-index:60;">
<button @click="showPosterDialog = false" class="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/10 border border-white/20 text-white text-sm">âœ•</button>
<img :src="modalNode.image" class="max-w-[75vw] max-h-[70vh] rounded-xl shadow-lg object-cover"/>
</div>
</div>
</template>
<!-- Poster -->
<div class="absolute left-1/2 top-full -translate-x-1/2 -translate-y-1/2 z-20"><div @click="showPosterDialog = true" class="cursor-pointer">
<div @click="showPosterDialog = true" class="cursor-pointer">
<div @click="showPosterDialog = true" class="cursor-pointer"><img :src="modalNode.image" alt=""
class="w-32 h-32 rounded-full object-cover drop-shadow-[0_0_20px_rgba(168,85,247,0.5)] ring-2 ring-purple-400/30"/></div></div>
</div>
</div>
</div>
<!-- Ä°Ã§erik alanÄ± -->
<div class="p-6 pt-20 space-y-6 overflow-hidden">
<h2 class="text-2xl font-bold text-center" x-text="modalNode.label">
</h2>
<div class="flex justify-center mt-2">
<button :class="isInWatchLater(modalNode?.id) ? 'bg-green-500 border-green-500 text-white' : 'bg-white/10 border-white/20 text-white hover:bg-white/20'" @click="toggleWatchLater(modalNode)" class="px-4 py-2 rounded border text-sm transition" x-text="isInWatchLater(modalNode?.id) ? 'âœ” Favorilere Eklendi' : 'Favorilere Ekle'">
</button>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
<div class="bg-white/5 p-4 rounded-lg border border-white/10 space-y-1"><div><strong>TÃ¼r:</strong> <span x-text="modalNode.tÃ¼r || '-'"></span></div>
<div><strong>YÃ¶netmen:</strong> <span x-text="modalNode.yÃ¶netmen || '-'"></span></div>
<div><strong>Oyuncular:</strong> <span x-text="modalNode.oyuncular || '-'"></span></div>
</div>
<div class="bg-white/5 p-4 rounded-lg border border-white/10 space-y-1">
<div><strong>Evren:</strong> <span x-text="formatUniverseName(modalNode.universe)"></span></div>
<template x-if="Array.isArray(modalNode.sources) ? modalNode.sources.length : Object.keys(modalNode.sources || {}).length">


<!-- Kaynaklar -->
<div
  class="mt-4"
  x-data="{ groups: [] }"
  x-effect="
    (() => {
      const raw =
        modalNode?.sources
        || modalNode?.source
        || modalNode?.links
        || null;

      const normalized = normalizeSources(raw);
      const order = ['Kaynaklar','GÃ¶rsel','Platform'];

      groups = order
        .map(cat => ({ cat, items: (normalized?.[cat] || []) }))
        .filter(g => g.items.length);
    })()
  "
  x-show="groups.length"
>


  <template x-for="g in groups" :key="g.cat">
    <div class="mb-3">
      <h4 class="text-sm font-medium mb-1 inline-flex items-center gap-1">
        <span x-text="getSourceIcon(g.cat)"></span>
        <span x-text="g.cat"></span>
      </h4>
      <ul class="list-disc list-inside text-sm space-y-0.5">
        <template x-for="src in g.items" :key="src.url || src.name">
          <li>
            <a href="#"
               @click.prevent="confirmExternal(src.url)"
               class="text-emerald-400 hover:underline"
               x-text="src.name || src.url"></a>
          </li>
        </template>
      </ul>
    </div>
  </template>
</div>

<!-- HiÃ§ kaynak yoksa nazik mesaj -->
<div class="mt-4 text-sm text-white/70" x-show="!groups?.length">
  Bu yapÄ±m iÃ§in kayÄ±tlÄ± bir kaynak bulunamadÄ±.
</div>




</template>
</div>
</div>
<!-- Ã–zet -->
<div>
<h3 @click="summaryOpen = !summaryOpen" id="content-summary" class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center border-b border-white/10 pb-1 mb-4">Ä°Ã§erik Ã–zeti
<svg class="w-4 h-4 inline-block ml-2" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x-show="!summaryOpen"></path>
<path d="M5 15l7-7 7 7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x-show="summaryOpen"></path>
</svg>
</h3>
<div class="bg-white/5 p-4 rounded-lg border border-white/10" x-show="summaryOpen" x-text="modalNode.description || '-'"></div>
</div>
<!-- GÃ¶ndermeler -->
<template x-if="modalNode.refers_to">
  <div>
    <h3 @click="refersOpen = !refersOpen" id="gÃ¶ndermeler"
        class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center border-b border-white/10 pb-1 mb-4">
      GÃ¶ndermeler
      <svg class="w-4 h-4 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
           xmlns="http://www.w3.org/2000/svg">
        <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              x-show="!refersOpen"></path>
        <path d="M5 15l7-7 7 7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              x-show="refersOpen"></path>
      </svg>
    </h3>

    <div class="text-sm text-red-400 italic mb-2" x-show="refersOpen">
      âš  Bu alan spoiler iÃ§erebilir.
    </div>

    <div class="bg-white/5 p-4 rounded-lg border border-white/10 italic text-sm"
         x-show="refersOpen"
         x-html="(() => {
           const t = modalNode.refers_to == null ? '' : String(modalNode.refers_to);

           // GÃ¼venlik: HTML escape
           const esc = t
             .replace(/&/g,'&amp;')
             .replace(/</g,'&lt;')
             .replace(/>/g,'&gt;');

           // **KalÄ±n** -> renkli span
           let out = esc.replace(/\*\*(.+?)\*\*/g,
             '<span class=&quot;text-sky-300 font-semibold underline decoration-dotted&quot;>$1</span>'
           );
           return out;
         })()">
    </div>
  </div>
</template>



<!-- BaÄŸlantÄ±lÄ± YapÄ±mlar -->


<h3 @click="linkedOpen = !linkedOpen" id="related-works" class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center border-b border-white/10 pb-1 mb-4">BaÄŸlantÄ±lÄ± YapÄ±mlar
<svg class="w-4 h-4 inline-block ml-2" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x-show="!linkedOpen"></path>
<path d="M5 15l7-7 7 7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x-show="linkedOpen"></path>
</svg>
</h3>
<div x-show="linkedOpen" class="bg-white/5 p-4 rounded-lg border border-white/10">

<template x-if="edgeList.length">
<div class="flex flex-wrap gap-2" x-show="linkedOpen">
<template :key="e.otherNodeId" x-for="e in edgeList">
<div :class="{
  'bg-blue-900/40 border-blue-500/30': e.type === 'Devam',
  'bg-emerald-900/30 border-emerald-500/20': e.type === 'TakÄ±m Kurulumu',
  'bg-slate-900/30 border-slate-500/20': e.type === 'Karakter GeÃ§iÅŸi',
  'bg-purple-900/30 border-purple-500/20': e.type === 'Gizli BaÄŸlantÄ±',
  'bg-red-900/30 border-red-500/20': e.type === 'Psikolojik Etki',
  'bg-violet-900/30 border-violet-500/20': e.type === 'Karakter BaÄŸlantÄ±sÄ±',
  'bg-rose-900/30 border-rose-500/20': e.type === 'Yeni Tehdit',
  'bg-amber-900/30 border-amber-400/20': e.type === 'Sonsuzluk TaÅŸÄ±',
  'bg-orange-900/30 border-orange-500/20': e.type === 'Siyasi Ã‡Ã¶zÃ¼lme',
  'bg-teal-900/30 border-teal-500/20': e.type === 'Kozmik KatÄ±lÄ±m',
  'bg-pink-900/30 border-pink-500/20': e.type === 'Anahtar Karakter',
  'bg-orange-800/30 border-orange-400/20': e.type === 'Ã–nemli Olay',
  'bg-yellow-900/30 border-yellow-500/20': e.type === 'Mekan BaÄŸlantÄ±sÄ±',
  'bg-gray-800/30 border-gray-500/20': e.type === 'Paralel Olay',
  'bg-amber-800/30 border-amber-500/20': e.type === 'Anahtar Olay',
  'bg-violet-800/30 border-violet-400/20': e.type === 'SonrasÄ± Etki',
  'bg-teal-800/30 border-teal-400/20': e.type === 'Kozmik GeniÅŸleme',
  'bg-cyan-900/30 border-cyan-500/20': e.type === 'Ã‡oklu Evren',
  'bg-red-800/30 border-red-400/20': e.type === 'Evrensel GeliÅŸme',
  
  // Eklenen eksik typeâ€™lar:
  'bg-indigo-900/30 border-indigo-500/20': e.type === 'Ana Hikaye BaÄŸlantÄ±sÄ±',
  'bg-red-950/30 border-red-600/20': e.type === 'Ana Tehdit',
  'bg-sky-900/30 border-sky-500/20': e.type === 'DoÄŸrudan Devam',
  'bg-emerald-950/30 border-emerald-600/20': e.type === 'Evrensel BaÄŸlantÄ±',
  'bg-stone-900/30 border-stone-500/20': e.type === 'GeÃ§miÅŸ Hikayesi',
  'bg-green-900/30 border-green-500/20': e.type === 'Hikaye DevamÄ±',
  'bg-cyan-800/30 border-cyan-400/20': e.type === 'Hikaye Ã–ncesi',
  'bg-slate-800/30 border-slate-400/20': e.type === 'Karakter DevamÄ±',
  'bg-orange-700/30 border-orange-300/20': e.type === 'Siyasi Etki',
  'bg-fuchsia-900/30 border-fuchsia-500/20': e.type === 'Crossover',
  'bg-gray-700/30 border-gray-400/20': e.type === 'Tarihsel BaÄŸlantÄ±',
  'bg-purple-800/30 border-purple-300/20': e.type === 'TÃ¼rsel BaÄŸlantÄ±',

  'bg-white/10 border-white/20': !e.type
         }" @click="__openNode(e.otherNodeId)" class="rounded-xl p-3 text-sm cursor-pointer transition relative border space-y-1">
<div class="font-semibold" x-text="nodes.get(e.otherNodeId)?.label || e.otherNodeId">
</div>
<div class="text-xs text-white/70 italic" x-text="e.type"></div>
<template x-if="e.notes">
<div class="border-l-4 border-blue-500 pl-2 ml-1 text-[12px] text-white/80 italic mt-1">
<span class="text-blue-300">Not:</span>
<span x-text="e.notes"></span>
</div>
</template>
</div>
</template>
</div>
</template>
<template x-if="!edgeList.length">
<p class="text-sm opacity-70">BaÄŸlantÄ± bulunamadÄ±.</p>
</template>
</div>
<!-- Notlar -->
<div class="bg-white/5 p-4 rounded-lg border border-white/10">
<h3 class="text-lg font-semibold mb-2">Notlar</h3>
<template x-if="!notes[modalNode.id] || !notes[modalNode.id].length">
<p class="text-sm opacity-70">HenÃ¼z not eklenmemiÅŸ.</p>
</template>

<template :key="i" x-for="(c, i) in (notes[modalNode.id] || [])">
  <div class="bg-white/10 p-2 rounded mb-2">
    <div class="text-xs opacity-70 mb-1">
      <span x-text="new Date(c.ts).toLocaleDateString()"></span>
    </div>
    <template x-if="editingNoteIndex === i">
      <div class="flex flex-col gap-2">
        <textarea x-model="editedNoteText" class="w-full p-2 rounded bg-black/20 text-sm text-white border border-white/20"></textarea>
        <div class="flex justify-end gap-2 text-xs">
          <button @click="saveEditedNote(modalNode.id, i)" class="px-2 py-1 rounded bg-green-600 hover:bg-green-700 text-white">Kaydet</button>
          <button @click="cancelEditNote()" class="px-2 py-1 rounded bg-white/20 text-white">VazgeÃ§</button>
        </div>
      </div>
    </template>
    <template x-if="editingNoteIndex !== i">
      <div>
        <div class="whitespace-pre-wrap text-sm" x-text="c.text"></div>
        <div class="flex justify-end gap-2 mt-1 text-xs opacity-80">
          <button @click="startEditNote(i, c.text)">âœï¸</button>
          <button @click="deleteNote(modalNode.id, i)">ğŸ—‘ï¸</button>
        </div>
      </div>
    </template>
  </div>
</template>

<div class="flex gap-2 mt-2">
<input class="w-full px-3 py-2 rounded bg-white/10 text-white" placeholder="Not ekle... #etiket" x-model="newNote"/>
<button @click="addNote(modalNode.id)" class="px-3 py-2 text-sm border border-white/20 rounded hover:bg-white/20">Ekle</button>
</div>
</div>
</div>
</div>
</div>
</div>

<div x-show="selectedUniverse">
</div>


</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const input = document.querySelector('input[placeholder="Not ekle... #etiket"]');
    if (input) {
      input.addEventListener('focus', () => {
        setTimeout(() => {
          input.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
      });
    }
  });
</script>


    <script>
      function app() {
        return {
          panel: null,
          startTour() {
            const dropdown = document.querySelector(".dropdown-btn");
            dropdown?.classList.add("pointer-events-none", "opacity-50");
            dropdown?.setAttribute("disabled", "true");
            // Shepherd rehberi: BaÅŸtan sona adÄ±mlar

            const tour = new Shepherd.Tour({
              defaultStepOptions: {
                scrollTo: true,
                cancelIcon: { enabled: true },
              },
            });

            // 1. HoÅŸ Geldin
            tour.addStep({
              title: "HoÅŸ Geldin ğŸ¬",
              text: "Film Evreni AÄŸÄ±â€™na hoÅŸ geldin!",
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 2. Evren SeÃ§
            tour.addStep({
              title: "Evren SeÃ§ ğŸŒŒ",
              text: "Buradan bir evren seÃ§ebilirsin.",
              attachTo: { element: ".dropdown-btn", on: "bottom" },
              buttons: [
                {
                  text: "Ä°leri",
                  action: function () {
                    const dropdown = document.querySelector(".dropdown-btn");
                    dropdown?.classList.remove("pointer-events-none", "opacity-50");
                    dropdown?.removeAttribute("disabled");
                    tour.next();
                  },
                },
              ],
            });

            // 3. Åimdi Evren SeÃ§
            const isMobile = window.innerWidth < 640;

            tour.addStep({
              title: "ğŸŒŒ Evren SeÃ§",
              text: "LÃ¼tfen bir evren seÃ§.",
              attachTo: {
                element: ".dropdown-btn",
                on: isMobile ? "top" : "left",
              },
              scrollTo: true,
              buttons: [],
              when: {
                show() {
                  const geÃ§erliMi = (val) => val && val !== "" && val !== "all";

                  const kontrolEt = () => {
                    try {
                      const selected =
                        Alpine.store("selectedUniverse") ||
                        Alpine.raw(Alpine.$data(document.querySelector("[x-data]")))
                          .selectedUniverse;

                      if (geÃ§erliMi(selected)) {
                        clearInterval(interval);
                        tour.next();
                      }
                    } catch (e) {
                      // Alpine hazÄ±r deÄŸilse sessizce bekle
                    }
                  };

                  kontrolEt();
                  const interval = setInterval(kontrolEt, 400);
                },
              },
            });

            // 4. Arama
            tour.addStep({
              title: "Film Ara ğŸ”",
              text: "Film veya dizi aramak iÃ§in burayÄ± kullan.",
              attachTo: { element: "input[type=search]", on: "bottom" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 5. YapÄ±m GrafiÄŸi
            tour.addStep({
              title: "YapÄ±m GrafiÄŸi ğŸ“Š",
              text: "SeÃ§ilen evrene ait yapÄ±mlar bu aÄŸ grafiÄŸinde gÃ¶sterilir. <br><br> Bir yapÄ±ma tÄ±klayarak yapÄ±m bilgi panelini aÃ§.",
              attachTo: { element: "#network", on: "top" },
              scrollTo: false,
              buttons: [], // Buton gÃ¶stermiyoruz
              when: {
                show() {
                  const checkModalOpen = () => {
                    const modal = document.querySelector(".modal-content");
                    const h2 = modal?.querySelector("h2");
                    const isVisible = modal && getComputedStyle(modal).display !== "none";
                    const hasTitle = h2 && h2.textContent.trim().length > 0;
                    return isVisible && hasTitle;
                  };

                  if (checkModalOpen()) {
                    tour.next(); // Zaten aÃ§Ä±k ve iÃ§erik varsa direkt geÃ§
                    return;
                  }

                  // AralÄ±kla kontrol et
                  const interval = setInterval(() => {
                    if (checkModalOpen()) {
                      clearInterval(interval);
                      tour.next();
                    }
                  }, 400);
                },
              },
            });

            // 8. PaylaÅŸÄ±m
            tour.addStep({
              title: "PaylaÅŸÄ±m ğŸš€",
              text: "Bu butonla yapÄ±m baÄŸlantÄ±sÄ±nÄ± kopyalayabilir veya sosyal medyada paylaÅŸabilirsin.",
              attachTo: { element: 'button[title="Kopyala"]', on: "bottom" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 9. Vizyon Tarihi
            tour.addStep({
              title: "ğŸ¬ Vizyon Tarihi",
              text: "Burada yapÄ±mÄ±n vizyon tarihini gÃ¶rebilirsin.",
              attachTo: { element: ".modal-content [x-text*=toTRDate]", on: "bottom" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 10. TÃ¼r ve IMDB
            tour.addStep({
              title: "â­ TÃ¼r ve IMDB",
              text: "YapÄ±mÄ±n tÃ¼rÃ¼ ve IMDB puanÄ± burada.",
              attachTo: { element: ".modal-content .text-xs.flex", on: "bottom" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 6. Favorilere Ekle
            tour.addStep({
              title: "Favorilere Ekle â­",
              text: "Bir yapÄ±mÄ± favorilerine eklemek iÃ§in bu butonu kullan.",
              attachTo: { element: "[x-text*=Favorilere]", on: "bottom" },
              buttons: [
                {
                  text: "Ä°leri",
                  action: function () {
                    const btn = document.querySelector("[x-text*=Favorilere]");
                    if (btn && btn.textContent.includes("âœ” Favorilere Eklendi")) {
                      return tour.next();
                    } else {
                      alert("LÃ¼tfen Ã¶nce favorilere ekle.");
                    }
                  },
                },
              ],
            });

            // 11. TÃ¼r / YÃ¶netmen / Oyuncular
            tour.addStep({
              title: "ğŸ­ TÃ¼r, YÃ¶netmen, Oyuncular",
              text: "Bu bÃ¶lÃ¼mde temel bilgiler yer alÄ±r.",
              attachTo: { element: ".modal-content .grid > div:nth-child(1)", on: "bottom" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 12. Evren ve Kaynaklar
            tour.addStep({
              title: "ğŸŒŒ Evren ve Kaynaklar",
              text: "YapÄ±mÄ±n ait olduÄŸu evreni ve kaynaklarÄ± burada gÃ¶rebilirsin.",
              attachTo: { element: ".modal-content .grid > div:nth-child(2)", on: "bottom" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 13. Ä°Ã§erik Ã–zeti
            tour.addStep({
              title: "ğŸ“ Ä°Ã§erik Ã–zeti",
              text: "Burada filmin kÄ±sa Ã¶zeti yer alÄ±r.",
              attachTo: {
                element: "#content-summary",
                on: "bottom",
              },
              scrollTo: true,
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 14. GÃ¶ndermeler
            tour.addStep({
              title: "ğŸ¯ GÃ¶ndermeler",
              text: "Filmde yapÄ±lan diÄŸer yapÄ±mlara gÃ¶ndermeleri burada gÃ¶rebilirsiniz.",
              attachTo: {
                element: "#gÃ¶ndermeler",
                on: "bottom",
              },
              scrollTo: true,
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 15. BaÄŸlantÄ±lÄ± YapÄ±mlar
            tour.addStep({
              title: "ğŸ”— BaÄŸlantÄ±lÄ± YapÄ±mlar",
              text: "Ä°lgili evrende geÃ§en diÄŸer yapÄ±mlar bu bÃ¶lÃ¼mde gÃ¶sterilir.",
              attachTo: {
                element: "#related-works",
                on: "bottom",
              },
              scrollTo: true,
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 7. Not Ekle
            tour.addStep({
              title: "Not Ekle ğŸ“",
              text: "Buraya kiÅŸisel notlarÄ±nÄ± yazabilir, #etiket ekleyebilirsin.",
              attachTo: {
                element: 'input[placeholder="Not ekle... #etiket"]',
                on: "bottom",
              },
              scrollTo: true,
              buttons: [
                {
                  text: "Ä°leri",
                  action: () => tour.next(),
                },
              ],
            });

            // 16. YapÄ±m Panelini Kapat
            tour.addStep({
              title: "ğŸ“• YapÄ±m Panelini Kapat",
              text: "Bu paneli kapatarak bir sonraki adÄ±ma geÃ§ebilirsin.",
              attachTo: { element: "#modal-close", on: "top" },
              scrollTo: true,
              buttons: [],
              when: {
                show() {
                  let modal;

                  const interval = setInterval(() => {
                    modal = document.querySelector("#modal_container");

                    // Modal DOM'da bile deÄŸilse â†’ kapandÄ± demektir
                    if (!modal) {
                      clearInterval(interval);
                      tour.next();
                      return;
                    }

                    // Modal DOM'da ama gÃ¶rÃ¼nmÃ¼yorsa
                    const style = window.getComputedStyle(modal);
                    const isHidden =
                      style.display === "none" ||
                      style.visibility === "hidden" ||
                      style.opacity === "0" ||
                      modal.classList.contains("hidden") ||
                      modal.offsetWidth === 0 ||
                      modal.offsetHeight === 0;

                    if (isHidden) {
                      clearInterval(interval);
                      tour.next();
                    }
                  }, 300);
                },
              },
            });

            // 17. Oklar (Ä°liÅŸkiler)
            tour.addStep({
              title: "Oklar Neyi GÃ¶sterir? ğŸ”",
              text: "Grafikteki oklar yapÄ±mlar arasÄ±ndaki iliÅŸkiyi gÃ¶sterir.",
              attachTo: { element: "#network canvas", on: "top" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 18. Legend AlanÄ±
            tour.addStep({
              title: "ğŸ“˜ BaÄŸlantÄ±lar AÃ§Ä±klamasÄ±",
              text: "BaÄŸlantÄ±lar alanÄ± evren renklerini ve tÃ¼rlerini aÃ§Ä±klar.",
              attachTo: { element: "#legend_bar", on: "top" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // YardÄ±mcÄ±: ekranda gÃ¶rÃ¼nen filtre butonunu bul
            function getVisibleFilterBtn() {
              const btns = document.querySelectorAll('button[title="Filtreler"]');
              for (const el of btns) {
                const r = el.getBoundingClientRect();
                const st = getComputedStyle(el);
                const visible =
                  r.width > 0 &&
                  r.height > 0 &&
                  st.visibility !== "hidden" &&
                  st.display !== "none";
                if (visible) return el;
              }
              return null;
            }

            // (startTour() iÃ§indeki mevcut "Filtreler" adÄ±mÄ±nÄ± bununla deÄŸiÅŸtir)
            tour.addStep({
              title: "ğŸ¯ Filtreler",
              text: "YapÄ±mlarÄ± tÃ¼r, yÄ±l, IMDb ve tipine gÃ¶re daraltabilirsin.",
              // Ä°lk baÄŸlama denemesi; show()â€™da kesinleÅŸtireceÄŸiz
              attachTo: { element: "#filter_btn", on: "bottom" },
              buttons: [
                {
                  text: "Ä°leri",
                  action: function () {
                    const btn = getVisibleFilterBtn();
                    tour.next();
                  },
                },
              ],
              when: {
                show() {
                  // GÃ¶rÃ¼nÃ¼r butonu bul ve adÄ±mÄ± ona yeniden baÄŸla
                  const btn = getVisibleFilterBtn();
                  if (btn) {
                    const step = tour.currentStep;
                    step.updateStepOptions({
                      attachTo: { element: btn, on: "bottom" },
                    });
                  }
                },
              },
            });

            // Timeline
            tour.addStep({
              title: "ğŸ“… Zaman Ã‡izelgesi",
              text: "SeÃ§ili evrendeki yapÄ±mlarÄ± Ã§Ä±kÄ±ÅŸ yÄ±llarÄ±na gÃ¶re sÄ±rayla burada gÃ¶rebilirsin.",
              attachTo: { element: "#timeline_bar", on: "top" },
              buttons: [
                {
                  text: "Ä°leri",
                  action: function () {
                    const btn = document.querySelector("#timeline_bar");
                    if (!btn) return tour.next();

                    tour.next();
                  },
                },
              ],
            });

            // 19. Favori ve Not Paneli
            tour.addStep({
              title: "ğŸ“‚ SaÄŸ Alt Panel",
              text: "SaÄŸ altta favori ve notlarÄ± gÃ¶rmek iÃ§in bu alanÄ± kullanabilirsin.",
              attachTo: { element: "#panel_bar", on: "top" },
              scrollTo: false,
              buttons: [
                {
                  text: "Ä°leri",
                  action: function () {
                    // Panel iÃ§eriÄŸi DOM'da gÃ¶rÃ¼nÃ¼r mÃ¼ kontrol et
                    const panel = document.querySelector('[x-show="panelOpen"]');

                    const isVisible = panel && window.getComputedStyle(panel).display !== "none";

                    if (isVisible) {
                      tour.next();
                      return;
                    }

                    alert("LÃ¼tfen Ã¶nce paneli aÃ§malÄ±sÄ±n.");

                    // Panel aÃ§Ä±ldÄ±ÄŸÄ±nda bekle ve sonra ilerle
                    const interval = setInterval(() => {
                      const nowVisible = panel && window.getComputedStyle(panel).display !== "none";
                      if (nowVisible) {
                        clearInterval(interval);
                        tour.next();
                      }
                    }, 400); // her 0.4 sn'de bir kontrol et
                  },
                },
              ],
            });

            // 20. Favori YÃ¶netimi
            tour.addStep({
              title: "â­ Favorileri GÃ¶r ve Sil",
              text: "Bu alanda favori yapÄ±mlarÄ± gÃ¶rebilir ve silebilirsin.",
              attachTo: { element: "#fav_bar", on: "left" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 21. Not YÃ¶netimi
            tour.addStep({
              title: "ğŸ“ NotlarÄ± GÃ¶r, DÃ¼zenle, Sil",
              text: "NotlarÄ±nÄ± bu alanda gÃ¶rÃ¼ntÃ¼leyebilir, dÃ¼zenleyebilir ya da silebilirsin.",
              attachTo: { element: "#notlar_bar", on: "left" },
              buttons: [{ text: "Ä°leri", action: tour.next }],
            });

            // 22. Tur Bitti ğŸ‰
            tour.addStep({
              title: "Tebrikler! ğŸ‰",
              text: "Film Evreni AÄŸÄ± rehberini baÅŸarÄ±yla tamamladÄ±n. KeÅŸfetmeye hazÄ±rsÄ±n!",
              buttons: [{ text: "Kapat", action: tour.complete }],
            });
            tour.start();

            document.addEventListener("keydown", function (e) {
              if (e.key === "Enter") {
                // EÄŸer aktif bir step varsa ve ileri butonu varsa ilerlet
                const step = tour.currentStep;
                if (step) {
                  // EÄŸer adÄ±mda butonlar varsa ilk "next" action'Ä±nÄ± Ã§alÄ±ÅŸtÄ±r
                  const nextBtn = step.options.buttons?.find((b) => b.action === tour.next);
                  if (nextBtn) {
                    tour.next();
                  } else {
                    // EÄŸer Ã¶zel action varsa onu Ã§alÄ±ÅŸtÄ±r
                    const btnWithAction = step.options.buttons?.[0];
                    btnWithAction?.action?.();
                  }
                }
              }
            });
          },



    editingNoteIndex: null,
    editedNoteText: '',
    startEditNote(i, text) {
      this.editingNoteIndex = i;
      this.editedNoteText = text;
    },
    cancelEditNote() {
      this.editingNoteIndex = null;
      this.editedNoteText = '';
    },
    saveEditedNote(nodeId, i) {
      if (this.notes[nodeId] && this.notes[nodeId][i]) {
        this.notes[nodeId][i].text = this.editedNoteText;
        this.notes[nodeId][i].ts = Date.now();
        this.cancelEditNote();
        if (this.saveNotesToStorage) this.saveNotesToStorage();
      }
    },
    openTimelineNode(id) {
      try {
        if (typeof this.__openNode === 'function') {
          this.__openNode(id);
        } else if (this.nodes && typeof this.nodes.get === 'function') {
          const it = this.nodes.get(id);
          if (it) { this.modalNode = it; this.modalOpen = true; this.$nextTick(()=>{ try{ this.pushPrettyUrl && this.pushPrettyUrl(this.modalNode); }catch(e){} }); }
        } else if (Array.isArray(this.allNodes)) {
          const it = this.allNodes.find(x => x && x.id === id);
          if (it) { this.modalNode = it; this.modalOpen = true; }
        }
      } catch (e) {
        // no-op: fail silently
      } finally {
        this.timelineOpen = false;
      }
    },

    
        linkedOpen: window.innerWidth > 640,
        showFavAdded: false,
        showFavMsg: false,

        summaryOpen: window.innerWidth > 640,
        refersOpen: false,
        showPosterDialog: false,
    
        network: null, allNodes: [], allEdges: [], nodes: null, edges: null,
        filteredNodes: [], filteredEdges: [],
        search: '', selectedUniverse: '', modalOpen: false, modalNode: null,
        timelineOpen: false,
        universeList: [], fitTimeout: null, showLegend: true,
        suggestions: [], acOpen: false,
        watchLater: [], watchLaterOpen: false, panelOpen: false, activeTab: 'watch', showGraph: false,
        notes: {}, newNote: '', notesOpen: false, notesUniverseFilter: '', notesTagFilter: '', editingNoteIndex: null, editedNoteText: '',
        bgUrl: 'assets/images/bg.jpg',
        bgMap: {
          "": "assets/images/bg.jpg",
          "avatar": "assets/images/pandora.jpg",
          "dc": "assets/images/dc.jpg",
          "harrypotter": "assets/images/harrypotter.jpg",
          "marvel": "assets/images/marvel.jpg",
          "matrix": "assets/images/matrix.jpg",
          "middleearth": "assets/images/middleearth.jpg",
          "pixar": "assets/images/pixar.jpg",
          "starwars": "assets/images/starwars.jpg"
        },
        get edgeList(){
          if (!this.modalNode || !this.allEdges) return [];
          return this.allEdges
            .filter(e => e.from === this.modalNode.id || e.to === this.modalNode.id)
            .map(e => ({ ...e, otherNodeId: e.from === this.modalNode.id ? e.to : e.from }));
        },
edgeColors: {
  "Ana Hikaye BaÄŸlantÄ±sÄ±": "#2c3e50", // Koyu mavi-gri - ana hikaye baÄŸÄ±
  "Ana Tehdit": "#ff0000",            // KÄ±rmÄ±zÄ± - ana dÃ¼ÅŸman
  "Anahtar Karakter": "#e84393",      // Pembe - hikayede kilit kiÅŸi
  "Anahtar Olay": "#f39c12",          // AltÄ±n sarÄ±sÄ± - Ã¶nemli dÃ¶nÃ¼m
  "Crossover": "#8e44ad",             // Mor - dizi/film geÃ§iÅŸi
  "Devam": "#2980b9",                 // Mavi - ana hikaye devamÄ±
  "DoÄŸrudan Devam": "#3498db",        // AÃ§Ä±k mavi - direkt devam
  "Evrensel BaÄŸlantÄ±": "#16a085",     // Turkuaz - evrensel baÄŸ
  "Evrensel GeliÅŸme": "#c0392b",      // KÄ±rmÄ±zÄ± - bÃ¼yÃ¼k Ã§aplÄ± geliÅŸme
  "GeÃ§miÅŸ Hikayesi": "#6e4b25",       // Kahverengi - geÃ§miÅŸ olay
  "Gizli BaÄŸlantÄ±": "#8e44ad",        // Mor - gizli/arka plan baÄŸlantÄ±
  "Hikaye DevamÄ±": "#27ae60",         // YeÅŸil - hikaye devamÄ±
  "Hikaye Ã–ncesi": "#1abc9c",         // Turkuaz-yeÅŸil - Ã¶n hikaye
  "Karakter BaÄŸlantÄ±sÄ±": "#9b59b6",   // AÃ§Ä±k mor - karakter iliÅŸkisi
  "Karakter DevamÄ±": "#34495e",       // Koyu gri - karakter hikaye devamÄ±
  "Karakter GeÃ§iÅŸi": "#34495e",       // Koyu gri - karakter odaklÄ± geÃ§iÅŸ
  "Kozmik GeniÅŸleme": "#1abc9c",      // Turkuaz-yeÅŸil - evrenin geniÅŸlemesi
  "Kozmik KatÄ±lÄ±m": "#16a085",        // Turkuaz - kozmik olaylar
  "Mekan BaÄŸlantÄ±sÄ±": "#6e4b25",      // Kahverengi - yer odaklÄ± baÄŸ
  "Paralel Olay": "#7f8c8d",          // Gri - eÅŸ zamanlÄ± olaylar
  "Psikolojik Etki": "#e74c3c",       // KÄ±rmÄ±zÄ± - duygusal/mental etki
  "Siyasi Etki": "#d35400",           // Turuncu - siyasi etki
  "Siyasi Ã‡Ã¶zÃ¼lme": "#d35400",        // Turuncu - siyasi Ã§atÄ±ÅŸma
  "SonrasÄ± Etki": "#9b59b6",          // Mor - olay sonrasÄ± etki
  "Sonsuzluk TaÅŸÄ±": "#f1c40f",        // AltÄ±n - Infinity Stones
  "TakÄ±m Kurulumu": "#27ae60",        // YeÅŸil - birlik ve oluÅŸum
  "Tarihsel BaÄŸlantÄ±": "#95a5a6",     // AÃ§Ä±k gri - tarihsel baÄŸ
  "TÃ¼rsel BaÄŸlantÄ±": "#8e44ad",       // Mor - tÃ¼rsel benzerlik
  "Yeni Tehdit": "#c0392b",           // Koyu kÄ±rmÄ±zÄ± - tehdit
  "Ã‡oklu Evren": "#00bcd4",           // AÃ§Ä±k mavi - multiverse
  "Ã–nemli Olay": "#e67e22"            // Turuncu - kritik olay
},

edgeStyles: {
  "Ana Hikaye BaÄŸlantÄ±sÄ±": { width: 3, dashes: false },
  "Ana Tehdit": { width: 3, dashes: [6,4] },
  "Anahtar Karakter": { width: 2.3, dashes: [8,4] },
  "Anahtar Olay": { width: 2.6, dashes: [2,4] },
  "Crossover": { width: 2.5, dashes: [4,8] },
  "Devam": { width: 3, dashes: false },
  "DoÄŸrudan Devam": { width: 3, dashes: [2,6] },
  "Evrensel BaÄŸlantÄ±": { width: 2.3, dashes: [5,5] },
  "Evrensel GeliÅŸme": { width: 2.5, dashes: [4,4] },
  "GeÃ§miÅŸ Hikayesi": { width: 2.2, dashes: [6,6] },
  "Gizli BaÄŸlantÄ±": { width: 2.2, dashes: [3,7] },
  "Hikaye DevamÄ±": { width: 2.8, dashes: false },
  "Hikaye Ã–ncesi": { width: 2.5, dashes: [4,6] },
  "Karakter BaÄŸlantÄ±sÄ±": { width: 2.2, dashes: [6,4] },
  "Karakter DevamÄ±": { width: 3, dashes: [6,4] },
  "Karakter GeÃ§iÅŸi": { width: 3, dashes: [10,4] },
  "Kozmik GeniÅŸleme": { width: 2.5, dashes: [4,6] },
  "Kozmik KatÄ±lÄ±m": { width: 2.3, dashes: [5,5] },
  "Mekan BaÄŸlantÄ±sÄ±": { width: 2, dashes: [8,6] },
  "Paralel Olay": { width: 2, dashes: [12,6] },
  "Psikolojik Etki": { width: 2.5, dashes: [2,6] },
  "Siyasi Etki": { width: 2.4, dashes: [6,8] },
  "Siyasi Ã‡Ã¶zÃ¼lme": { width: 2.8, dashes: [6,6] },
  "SonrasÄ± Etki": { width: 2.4, dashes: [6,8] },
  "Sonsuzluk TaÅŸÄ±": { width: 2.5, dashes: [2,6] },
  "TakÄ±m Kurulumu": { width: 2.8, dashes: false },
  "Tarihsel BaÄŸlantÄ±": { width: 2.3, dashes: [5,7] },
  "TÃ¼rsel BaÄŸlantÄ±": { width: 2.5, dashes: [4,6] },
  "Yeni Tehdit": { width: 2.5, dashes: [4,4] },
  "Ã‡oklu Evren": { width: 2.8, dashes: [6,3] },
  "Ã–nemli Olay": { width: 3, dashes: [2,6] }
},

// ---- yardÄ±mcÄ±lar (return {...} iÃ§ine) ----
normUrl(u) { try { return new URL(u).href; } catch { return u || ''; } },
hostName(u) { try { return new URL(u).hostname.replace(/^www\./,''); } catch { return u || ''; } },
normalizeItem(it) {
  if (!it) return null;
  if (typeof it === 'string') {
    const url = this.normUrl(it);
    return url ? { name: this.hostName(url) || url, url } : null;
  }
  if (typeof it === 'object') {
    const url = this.normUrl(it.url || '');
    const name = it.name || this.hostName(url) || url;
    return (url || name) ? { name, url } : null;
  }
  return null;
},
mapCategory(key) {
  const k = (key || '').toLowerCase();
  if (k.includes('gÃ¶rsel') || k.includes('gorsel') || k.includes('image') || k.includes('poster')) return 'GÃ¶rsel';
  if (k.includes('platform') || k.includes('watch') || k.includes('stream')) return 'Platform';
  // default
  return 'Kaynaklar';
},
normalizeSources(src) {
  // Her durumda ÅŸu yapÄ±yÄ± dÃ¶ndÃ¼r: { Kaynaklar:[], GÃ¶rsel:[], Platform:[] }
  const out = { Kaynaklar: [], GÃ¶rsel: [], Platform: [] };

  const push = (cat, item) => {
    const n = this.normalizeItem(item);
    if (n) out[cat].push(n);
  };

  if (!src) return out;

  // Obje: { "Kaynaklar": [...], "GÃ¶rsel": [...], "Platform": [...] , ... }
  if (typeof src === 'object' && !Array.isArray(src)) {
    for (const [k, v] of Object.entries(src)) {
      const cat = this.mapCategory(k);
      const arr = Array.isArray(v) ? v : [v];
      arr.forEach(it => push(cat, it));
    }
    return out;
  }

  // Dizi:
  // - DÃ¼z link listesi: [{name,url}] ya da ["https://..."] -> Kaynaklar
  // - Gruplu: [{category:'...', items:[...]}]
  if (Array.isArray(src)) {
    if (!src.length || typeof src[0] !== 'object' || ('url' in src[0]) || ('name' in src[0])) {
      src.forEach(it => push('Kaynaklar', it));
    } else {
      src.forEach(g => {
        const cat = this.mapCategory(g?.category);
        const items = Array.isArray(g?.items) ? g.items : (g?.items ? [g.items] : []);
        items.forEach(it => push(cat, it));
      });
    }
    return out;
  }

  // String / tek obje vs:
  push('Kaynaklar', src);
  return out;
},

getSourceIcon(cat) {
  if (cat === 'GÃ¶rsel') return 'ğŸ–¼ï¸';
  if (cat === 'Platform') return 'ğŸ¬';
  return 'ğŸ“š'; // Kaynaklar
},
confirmExternal(url) {
  const msg = 'Bu baÄŸlantÄ± sizi harici bir siteye yÃ¶nlendirecek. Devam etmek istiyor musunuz?';
  if (url && confirm(msg)) window.open(url, '_blank', 'noopener');
},


norm(s) {
  if (!s) return '';
  // TR kÃ¼Ã§Ã¼ltme + Ä±â†’i dÃ¼zeltmesi + aksan temizleme
  return s
    .toLocaleLowerCase('tr')   // Ä°â†’i, Iâ†’Ä±
    .replace(/Ä±/g, 'i')        // 'Ä±'larÄ± da 'i' yap
    .normalize('NFD')          // aksanlarÄ± ayÄ±r
    .replace(/[\u0300-\u036f]/g, ''); // aksanlarÄ± sil
},


        get timelineSortedNodes(){
          const u = this.selectedUniverse;
          return [...this.allNodes]
            .filter(n => n.release_date && (!u || n.universe === u))
            .sort((a, b) => new Date(a.release_date) - new Date(b.release_date));
        },
        get groupTimelineByYear(){
          const groups = new Map();
          for (const n of this.timelineSortedNodes) {
            const y = new Date(n.release_date).getFullYear();
            if (!groups.has(y)) groups.set(y, []);
            groups.get(y).push(n);
          }
          for (const [y, arr] of groups.entries()) { arr.sort((a,b)=> new Date(a.release_date) - new Date(b.release_date)); }
          return Array.from(groups.entries()).sort((a,b)=> b[0]-a[0]);
        },
        
get legendEntries() {
  const usedTypes = new Set(this.filteredEdges.map(e => e.type));
  return Object.entries(this.edgeColors).filter(([t]) =>
    usedTypes.has(t) || this.filteredEdges.length === 0
  );
}
,

openFilterPanel: false,

filters: {
  genres: [],     // ["Aksiyon","Bilim Kurgu"] gibi
  yearMin: null,  // 2008
  yearMax: null,  // 2025
  imdbMin: null,  // 7.0
  type: 'all',    // 'all' | 'film' | 'dizi'
},

get activeFilterCount() {
  let c = 0;
  if (this.filters.genres?.length) c++;
  if (this.filters.yearMin != null || this.filters.yearMax != null) c++;
  if (this.filters.imdbMin != null) c++;
  if (this.filters.type && this.filters.type !== 'all') c++;
  return c;
},

resetFilters() {
  this.filters = { genres: [], yearMin: null, yearMax: null, imdbMin: null, type: 'all' };
  this.applyFilters();
  this.openFilterPanel = false;
},

get availableGenres() {
  const s = new Set();
  for (const n of this.allNodes) {
    const raw = (n.tÃ¼r || n.genre || n.genres || '').toString();
    raw.split(/[,\|/]/).map(x => x.trim()).filter(Boolean).forEach(g => s.add(g));
  }
  return s.size ? Array.from(s).sort() : [
    "Aksiyon","Macera","Bilim Kurgu","Dram","Fantastik","Animasyon","Komedi","Gerilim"
  ];
},

        get notesSummary(){
          const groups = new Map();
          for (const [nodeId, arr] of Object.entries(this.notes)){
            if (!arr || !arr.length) continue;
            const node = this.nodes?.get(nodeId) || this.allNodes.find(n => String(n.id)===String(nodeId));
            const g = groups.get(nodeId) || { count: 0, tags: new Set(), label: node?.label || nodeId, universe: node?.universe || '' };
            g.count += arr.length;
            for (const n of arr) (n.tags||[]).forEach(t => g.tags.add(t));
            groups.set(nodeId, g);
          }
          const u = this.notesUniverseFilter;
          const tagQ = (this.notesTagFilter || '').trim().replace(/^#/, '').toLowerCase();
          return Array.from(groups.entries()).map(([nodeId, g]) => ({ nodeId, label: g.label, universe: g.universe, count: g.count, tags: Array.from(g.tags) }))
            .filter(x => (!u || x.universe === u) && (!tagQ || x.tags.some(t => t.includes(tagQ))))
            .sort((a,b)=> b.count - a.count || a.label.localeCompare(b.label));
        },
        getAllEdgesWithNotes(nodeId) {
          if (!nodeId) return [];
          return this.allEdges
            .filter(e => e.from === nodeId || e.to === nodeId)
            .map(e => {
              const otherNodeId = e.from === nodeId ? e.to : e.from;
              const otherNode = this.allNodes.find(n => String(n.id) === String(otherNodeId));
              return {
    panel: null,
        linkedOpen: window.innerWidth > 640,
        showFavAdded: false,
        showFavMsg: false,

        summaryOpen: window.innerWidth > 640,
        refersOpen: false,
        showPosterDialog: false,
     id: e.id || (e.from + "_" + e.to + "_" + (e.type || "")), otherNodeId, otherNodeLabel: otherNode?.label || otherNodeId, type: e.type, edgeHasNotes: !!e.notes, edgeNoteText: e.notes || "", nodeHasNotes: !!(this.notes && this.notes[otherNodeId] && this.notes[otherNodeId].length) };
            });
        },
        formatEdgeType(type) { if (!type) return ''; return type.charAt(0).toUpperCase() + type.slice(1); },
        get topTags(){
          const counts = new Map();
          const u = this.notesUniverseFilter;
          for (const [nodeId, arr] of Object.entries(this.notes)){
            if (!arr || !arr.length) continue;
            const node = this.allNodes.find(n => String(n.id) === String(nodeId));
            if (u && node?.universe !== u) continue;
            for (const n of arr) for (const t of (n.tags || [])) counts.set(t, (counts.get(t) || 0) + 1);
          }
          return Array.from(counts.entries()).sort((a,b) => b[1] - a[1]).slice(0, 10).map(([t]) => t);
        },
        init() {
          
this.resetFilters();


this.$watch && this.$watch('filters', (v) => {
  localStorage.setItem('filters', JSON.stringify(v));
});

  if (window.innerWidth < 640) {
    this.showLegend = false;
  } else {
    this.showLegend = true;
  }
          try { const old = localStorage.getItem('comments'); if (old && !localStorage.getItem('notes')) { localStorage.setItem('notes', old); localStorage.removeItem('comments'); } } catch {}
          this.loadWatchLater(); this.loadNotes(); this.network = null;
          this.setBackgroundFor(this.selectedUniverse); this.warmBackgrounds();
          this.loadData();

this.setupNetwork();
this.applyFilters();



          let debounceTimeout = null;
this.$watch('search', (val) => {
  clearTimeout(debounceTimeout);
  debounceTimeout = setTimeout(() => {
    this.applyFilters();
    if (val) {
      const q = this.norm(val);
      const starts = [], contains = [], seen = new Set();
      for (const n of this.allNodes) {
        const lbl = n.label || '';
        const l = this.norm(lbl);
        if (l.startsWith(q)) {
          if (!seen.has(lbl)) { starts.push(lbl); seen.add(lbl); }
        } else if (l.includes(q)) {
          if (!seen.has(lbl)) { contains.push(lbl); seen.add(lbl); }
        }
        if (starts.length + contains.length >= 10) break;
      }
      this.suggestions = [...starts, ...contains];
    } else {
      this.suggestions = [];
    }
  }, 220);
});

this.$watch('modalOpen', (isOpen) => {
  try {
    if (isOpen && this.modalNode) {
      this.pushPrettyUrl && this.pushPrettyUrl(this.modalNode);
    } else {
      this.resetPrettyUrl && this.resetPrettyUrl();
    }
  } catch(e) { console.warn('modalOpen watch', e); }
});



          
this.$watch('selectedUniverse', (val) => {
  if (val) {
    this.setBackgroundFor(val);
    if (!this.network) this.setupNetwork();
    this.applyFilters();
  }
  this.notesUniverseFilter = val;

  try { this.setParams({ u: val || '', clearNode: true }); } catch {}
});

        },
        async setBackgroundFor(universe){
          const primary = this.bgMap[universe || ""] || this.bgMap[""];
          const fallbacks = ["assets/images/bg.jpg", "assets/images/bg.jpg"];
          const tried = new Set();
          const tryLoad = (url) => new Promise((resolve,reject)=>{ if(!url || tried.has(url)) return reject(); tried.add(url); const img = new Image(); img.onload = () => resolve(url); img.onerror = () => reject(); img.decoding = 'async'; img.referrerPolicy = 'no-referrer'; img.src = url; });
          for (const url of [primary, ...fallbacks]) { try { const ok = await tryLoad(url); this.bgUrl = ok; return; } catch {} }
        },
        warmBackgrounds(){ [...new Set(Object.values(this.bgMap))].forEach(u => { const i = new Image(); i.decoding='async'; i.src = u; }); },
        loadWatchLater(){ try { this.watchLater = JSON.parse(localStorage.getItem('watchLater') || '[]'); } catch { this.watchLater = []; } },
        saveWatchLater(){ localStorage.setItem('watchLater', JSON.stringify(this.watchLater)); },
        isInWatchLater(id){ return !!this.watchLater.find(x => String(x.id) === String(id)); },
        toggleWatchLater(node){ if (!node?.id) return; if (this.isInWatchLater(node.id)) this.watchLater = this.watchLater.filter(x => String(x.id) !== String(node.id)); else this.watchLater.unshift({ id: node.id, label: node.label || String(node.id) }); this.saveWatchLater(); },
        removeWatchLater(id){ this.watchLater = this.watchLater.filter(x => String(x.id) !== String(id)); this.saveWatchLater(); },
        loadNotes(){ try { this.notes = JSON.parse(localStorage.getItem('notes')||'{}'); } catch { this.notes = {}; } },
        saveNotes(){ localStorage.setItem('notes', JSON.stringify(this.notes)); },
        extractTags(t){ return Array.from(t.matchAll(/#([\p{L}\d_-]+)/gu)).map(m=>m[1].toLowerCase()); },
        addNote(nodeId){ const t = (this.newNote || '').trim(); if (!nodeId || !t) return; const item = { text: t, tags: this.extractTags(t), pin: false, ts: Date.now(), editedTs: null }; (this.notes[nodeId] ||= []).unshift(item); this.newNote = ''; this.saveNotes(); },
        togglePin(nodeId, idx){ const n = this.notes[nodeId]?.[idx]; if (!n) return; n.pin = !n.pin; this.saveNotes(); },
        deleteNote(nodeId, idx){ this.notes[nodeId].splice(idx, 1); this.saveNotes(); },
        startEditNote(index, text) {
          this.editingNoteIndex = index;
          this.editedNoteText = text;
        },
        cancelEditNote() {
          this.editingNoteIndex = null;
          this.editedNoteText = '';
        },
        saveEditedNote(nodeId, index) {
          if (!this.notes[nodeId] || !this.notes[nodeId][index]) return;
          const updatedText = (this.editedNoteText || '').trim();
          if (!updatedText) return;
          this.notes[nodeId][index].text = updatedText;
          this.notes[nodeId][index].tags = this.extractTags(updatedText);
          this.notes[nodeId][index].editedTs = Date.now();
          this.saveNotes();
          this.cancelEditNote();
        },

        
makeSlug(str) {
  return (str || '')
    .toLocaleLowerCase('tr')
    .normalize('NFD').replace(/[Ì€-\u036f]/g, '')
    .replace(/Ä±/g,'i').replace(/Ä°/g,'i').replace(/ÅŸ/g,'s')
    .replace(/Ã§/g,'c').replace(/ÄŸ/g,'g').replace(/Ã¶/g,'o').replace(/Ã¼/g,'u')
    .replace(/[^a-z0-9]+/g,'-')
    .replace(/(^-|-$)/g,'');
},
nodeYear(n) {
  const y = (n?.release_date || n?.date || '').toString();
  const m = y.match(/\d{4}/);
  return m ? m[0] : '';
},
prettyNodePath(node) {
  const name = node?.label || node?.title || node?.name || '';
  const raw = this.makeSlug(name);
  const m = raw.match(/-(\d{4})$/);
  const slugNoYear = m ? raw.slice(0, -5) : raw;
  const yrFromSlug = m ? m[1] : null;
  const yr = yrFromSlug || this.nodeYear(node);
  const finalSlug = yr ? `${slugNoYear}-${yr}` : slugNoYear;

  const parts = location.pathname.split('/').filter(Boolean);
  const base = parts.length ? `/${parts[0]}` : '/evren';
  return `${base}/${finalSlug}`;
},

pushPrettyUrl(node) {
  try {
    const u = node?.universe || '';
    const id = node?.id != null ? String(node.id) : '';
    const url = new URL(location.href);
    url.searchParams.set('u', u);
    url.searchParams.set('node', id);
    history.replaceState({}, '', url);
  } catch (e) {
    console.warn('pushPrettyUrl error', e);
  }
},


resetPrettyUrl() {
  try {
    const url = new URL(location.href);
    url.search = '';
    history.replaceState({}, '', url.origin + url.pathname);
  } catch (e) {
    console.warn('resetPrettyUrl error', e);
  }
}
,

buildNodeUrl(nodeId){ const node = this.nodes?.get(nodeId) || this.allNodes.find(n => String(n.id)===String(nodeId)); const u = node?.universe || ''; const base = location.origin + location.pathname; const params = new URLSearchParams({ u, node: String(nodeId) }); return `${base}?${params.toString()}`; },
        shareNode(node, platform){ if (!node?.id) return; const url = this.buildNodeUrl(node.id); const text = `${node.label || node.id} â€” ${this.formatUniverseName(node.universe)}\n${url}`; const enc = encodeURIComponent(text); const shareUrl = platform === 'whatsapp' ? `https://api.whatsapp.com/send?text=${enc}` : platform === 'x' ? `https://twitter.com/intent/tweet?text=${enc}` : ''; if (shareUrl) window.open(shareUrl, '_blank', 'noopener'); },
        

async loadData() {
  const evrenler = ["avatar","dc","harrypotter","marvel","matrix","middleearth","pixar","starwars"];
  try {
    const results = await Promise.all(
      evrenler.map(evren =>
        fetch('assets/data/' + evren + '.json', { cache: 'no-store' })
          .then(r => { if (!r.ok) throw new Error(evren + ' yÃ¼klenemedi'); return r.json().then(data => ({ evren, data })); })
      )
    );
    let nodesTemp = [], edgesTemp = [];
    for (const { evren, data } of results) {
      nodesTemp = nodesTemp.concat(data.nodes.map(n => ({ ...n, universe: evren })));
      edgesTemp = edgesTemp.concat(data.edges);
    }
    this.allNodes = nodesTemp;
    this.allEdges = edgesTemp;
    this.universeList = [...new Set(this.allNodes.map(n => n.universe))];

    // Parametreleri oku (hata gÃ¼venli)
    let qU = null, qNode = null;
    try {
      const params = new URLSearchParams(location.search);
      qU = params.get('u');
      qNode = params.get('node');
    } catch(_) {}

    if (qU && this.universeList.includes(qU)) {
      this.selectedUniverse = qU;
    }

    // Filtre uygula (network hazÄ±r deÄŸilse sorun yok)
    this.applyFilters?.();

    if (qNode) {
      const node = this.allNodes.find(n => String(n.id) === String(qNode));
      if (node) {
        this.$nextTick?.(() => {
          try {
            this.modalNode = node;
            this.modalOpen = true;
            if (this.network) {
              try { this.network.selectNodes([qNode]); } catch {}
              try { this.network.focus(qNode, { animation: true, scale: 1 }); } catch {}
            }
          } catch (e) {
            console.warn('Modal aÃ§ma sÄ±rasÄ±nda hata:', e);
          }
        });
      }
    }
  } catch (err) {
    console.error('loadData hata:', err);
    alert('Veri yÃ¼kleme hatasÄ±: ' + (err && err.message ? err.message : String(err)));
  }
},


        openNode(id) { const node = this.nodes?.get(id) || this.allNodes.find(n => String(n.id) === String(id)); if (node) { this.modalNode = node; this.modalOpen = true; window.__modalWasOpened = true; this.network?.selectNodes([id]); this.network?.focus(id, { animation: true, scale: 1 }); } },
        makeOptions() { return {
        linkedOpen: window.innerWidth > 640,
        showFavAdded: false,
        showFavMsg: false,

        summaryOpen: window.innerWidth > 640,
        refersOpen: false,
        showPosterDialog: false,
     nodes: { size: 25, font: { color: '#e5e7eb', size: 14 }, borderWidthSelected: 6, color: { border: '#ef4444' } }, edges: { arrows: { to: { enabled: true, scaleFactor: 0.5 } }, smooth: { enabled: true, type: 'dynamic' } }, interaction: { hover: true, tooltipDelay: 200, zoomView: true, dragView: true }, physics: { stabilization: true, barnesHut: { gravitationalConstant: -4000 } }, layout: { improvedLayout: true } }; },
        setupNetwork() { this.nodes = new vis.DataSet(); this.edges = new vis.DataSet(); const container = document.getElementById('network'); this.network = new vis.Network(container, { nodes: this.nodes, edges: this.edges }, this.makeOptions()); this.network.on('click', params => { if (params.nodes.length > 0) { const node = this.nodes.get(params.nodes[0]); requestAnimationFrame(() => { this.modalNode = node; this.modalOpen = true; }); } }); },
        applyFilters() {
  if (!this.nodes || !this.edges) return;

const searchTerm = this.norm(this.search);

  const universe = this.selectedUniverse;

  const f = this.filters || {};
  const yearMin = f.yearMin != null ? Number(f.yearMin) : null;
  const yearMax = f.yearMax != null ? Number(f.yearMax) : null;
  const imdbMin = f.imdbMin != null ? Number(f.imdbMin) : null;
  const chosenGenres = new Set(((f.genres || [])).map(g => (g||'').toLowerCase()));
  const wantedType = (f.type || 'all');

  this.filteredNodes = (this.allNodes || []).filter(n => {
    // Evren + arama
    if (universe && n.universe !== universe) return false;
  if (searchTerm) {
  const lbl = this.norm(n.label);
  if (!lbl.includes(searchTerm)) return false;
}

    // YÄ±l
    if (yearMin != null || yearMax != null) {
      const y = n.release_date ? new Date(n.release_date).getFullYear() : null;
      if (yearMin != null && (y == null || y < yearMin)) return false;
      if (yearMax != null && (y == null || y > yearMax)) return false;
    }

    // IMDb
    if (imdbMin != null) {
      const r = n.imdb_rating != null ? Number(n.imdb_rating) : null;
      if (r == null || r < imdbMin) return false;
    }

    // TÃ¼r (genre)
    if (chosenGenres.size) {
      const raw = (n.tÃ¼r || n.genre || n.genres || '').toString().toLowerCase();
      const nodeGenres = raw.split(/[,\|/]/).map(x => x.trim()).filter(Boolean);
      const hasAny = nodeGenres.some(g => chosenGenres.has(g));
      if (!hasAny) return false;
    }

    // YapÄ±m tipi (film/dizi)
    if (wantedType !== 'all') {
      const nodeType = (n.type || n.tip || '').toString().trim().toLowerCase();
      const mapped = nodeType == 'movie' ? 'film'
                   : nodeType == 'series' ? 'dizi'
                   : nodeType;
      if (mapped !== wantedType) return false;
    }

    return true;
  });

  const nodeIds = new Set(this.filteredNodes.map(n => n.id));
  this.filteredEdges = (this.allEdges || []).filter(e => nodeIds.has(e.from) && nodeIds.has(e.to));

  this.updateNetwork && this.updateNetwork();
  if (this.network) {
    if (this.fitTimeout) clearTimeout(this.fitTimeout);
    this.fitTimeout = setTimeout(() => this.network.fit({ animation: true }), 220);
  }
},
        updateNetwork() {

            // Ã‡Ä±kÄ±ÅŸ yÄ±lÄ±na gÃ¶re renk skalasÄ± (mavi -> kÄ±rmÄ±zÄ±)
            const getColorByYear = (year) => {
              if (!year) return '#888';
              const minYear = 1980;
              const maxYear = new Date().getFullYear();
              const ratio = Math.max(0, Math.min(1, (year - minYear) / (maxYear - minYear)));
              const r = Math.round(255 * ratio);
              const b = Math.round(255 * (1 - ratio));
              return `rgb(${r},50,${b})`;
            };

          this.nodes.clear(); this.edges.clear();
          this.nodes.add(this.filteredNodes.map(n => { const hasImage = !!n.image; const noteCount = (this.notes[n.id]?.length || 0); return {
        linkedOpen: window.innerWidth > 640,
        showFavAdded: false,
        showFavMsg: false,

        summaryOpen: window.innerWidth > 640,
        refersOpen: false,
        showPosterDialog: false,
     ...n, label: noteCount ? `${n.label}\nğŸ“ ${noteCount}` : n.label, font: { color: '#e5e7eb', size: 14, multi: true, vadjust: 4 }, shape: hasImage ? 'circularImage' : 'dot', borderWidth: 2, borderWidthSelected: 6, color: hasImage ? { border: getColorByYear(n.release_date ? new Date(n.release_date).getFullYear() : null) } : { background: getColorByYear(n.release_date ? new Date(n.release_date).getFullYear() : null), border: getColorByYear(n.release_date ? new Date(n.release_date).getFullYear() : null) } }; }));
          this.edges.add(this.filteredEdges.map(e => { const color = this.edgeColors[e.type] || '#9ca3af'; const s = this.edgeStyles[e.type] || { width: 1.5, dashes: false }; return {
        linkedOpen: window.innerWidth > 640,
        showFavAdded: false,
        showFavMsg: false,

        summaryOpen: window.innerWidth > 640,
        refersOpen: false,
        showPosterDialog: false,
     ...e, arrows: 'to', color: { color }, width: s.width, dashes: s.dashes }; }));
        },
        neighborChips(nodeId) { if (!nodeId || !this.network) return ''; const neighbors = this.network.getConnectedNodes(nodeId).map(id => this.nodes.get(id)).filter(Boolean); if (!neighbors.length) return '<span class="text-sm opacity-70">BaÄŸlantÄ± bulunamadÄ±.</span>'; return neighbors.map(n => `<button class="chip hover:brightness-110" onclick="window.__openNode('${String(n.id).replace(/'/g,'&#39;')}')">${n.label ? n.label.replace(/</g,'&lt;') : 'ID ' + n.id}</button>`).join(''); },
        formatUniverseName(name) { const map = { "avatar": "Avatar", "dc": "DC", "marvel": "Marvel", "harrypotter": "Harry Potter", "matrix": "Matrix", "middleearth": "Orta DÃ¼nya", "pixar": "Pixar", "starwars": "Star Wars" }; return map[name] || name; }
      }
    }
    window.openNode = function(id) { const scope = document.querySelector('html')?.__x?.$data; if (!scope?.openNode) return; scope.openNode(id); };
    window.__openNode = function(id) { let scope = document.querySelector('html')?.__x?.$data; if (!scope?.nodes) { for (const el of document.querySelectorAll('[x-data]')) { if (el.__x && el.__x.$data?.nodes) { scope = el.__x.$data; break; } } } if (!scope?.nodes) return; const node = scope.nodes.get(id); if (node) { requestAnimationFrame(() => { scope.modalNode = node; scope.modalOpen = true; scope.network.selectNodes([id]); scope.network.focus(id, { animation: true, scale: 1 }); }); } };
  </script>
<script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('SW registered', reg.scope))
          .catch(err => console.warn('SW register failed', err));
      });
    }
  </script>
<script>
    const SHARE_PHRASES = { more: 'DevamÄ± iÃ§in ziyaret et:', farewell: 'Sinemayla kalÄ±n.', dash: ' â€” ' };
    const EMOJI = { title: 'ğŸ¬', date: 'ğŸ“…', summary: 'ğŸ“', more: 'ğŸ‘‰', link: 'ğŸ”—', bye: 'ğŸ¿' };
    function preferredUrl(node){
  try {
    const url = new URL(location.href);
    url.searchParams.set('u', node?.universe || '');
    url.searchParams.set('node', String(node?.id ?? ''));
    return url.origin + url.pathname + '?' + url.searchParams.toString();
  } catch (_) {
    // Eski tarayÄ±cÄ±lar iÃ§in basit fallback
    var u = (node && node.universe) ? node.universe : '';
    var i = (node && node.id != null) ? String(node.id) : '';
    return location.pathname + '?u=' + encodeURIComponent(u) + '&node=' + encodeURIComponent(i);
  }
};
  const slugNoYear = m ? raw.slice(0, -5) : raw;
  const yrFromSlug = m ? m[1] : null;
  const yr = yrFromSlug || (window.app?.nodeYear ? window.app.nodeYear(node) : '');
  const finalSlug = yr ? `${slugNoYear}-${yr}` : slugNoYear;

  const parts = location.pathname.split('/').filter(Boolean);
  const base = parts.length ? `/${parts[0]}` : '/evren';
  return location.origin + `${base}/${finalSlug}`;

    function composeShareText(node) {
      const filmAdi  = node?.label || node?.title || node?.name || 'Bu yapÄ±m';
      const line1 = `${EMOJI.title} ${filmAdi}`;
      const takvimTR = toTRDate(node?.release_date || node?.date);
      const line2 = takvimTR ? `${EMOJI.date} ${takvimTR}` : '';
      const aciklamaFull = (node?.description || '').trim();
      const gondermelerFull = (node?.refers_to || '').trim();
      const aciklama = aciklamaFull.length > 120 ? aciklamaFull.slice(0,117).trimEnd() + '...' : aciklamaFull;
      const gondermeler = gondermelerFull.length > 100 ? gondermelerFull.slice(0,97).trimEnd() + '...' : gondermelerFull;
      let line3 = '';
      if (aciklama && gondermeler) line3 = `${EMOJI.summary} Film Ã–zeti: ${aciklama}${SHARE_PHRASES.dash}GÃ¶ndermeler: ${gondermeler}`;
      else if (aciklama) line3 = `${EMOJI.summary} Film Ã–zeti: ${aciklama}`;
      else if (gondermeler) line3 = `${EMOJI.summary} GÃ¶ndermeler: ${gondermeler}`;
      if (line3 && !/[.!?â€¦]$/.test(line3.trim())) line3 = line3.trim() + '.';
      const url = preferredUrl(node);
      const line4 = `${SHARE_PHRASES.more} ${EMOJI.more}`;
      const line5 = `${EMOJI.link} ${url}`;
      const line6 = `${SHARE_PHRASES.farewell} ${EMOJI.bye}`;
      return [line1, line2, line3, line4, line5, line6].filter(Boolean).join('\n');
    }
    function composeShareTextForX(node, max = 240) { const url = preferredUrl(node); const single = composeShareText(node).replace(/\n+/g, ' | '); const withoutUrl = single.replace(url, '').replace(/\s*\|\s*\|\s*/g, ' | ').trim(); return withoutUrl.length <= max ? withoutUrl : (withoutUrl.slice(0, max - 1) + 'â€¦'); }
    window.shareToX = function(node) { const url = preferredUrl(node); const text = composeShareTextForX(node); window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`,'_blank','noopener,noreferrer'); };
    window.shareToWhatsApp = function(node) { const text = composeShareText(node); window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank','noopener,noreferrer'); };
    window.shareToLinkedIn = function(node) { const url  = preferredUrl(node); const name = node?.label || node?.title || node?.name || 'Bu yapÄ±m'; const sum  = composeShareText(node); window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}&title=${encodeURIComponent(name)}&summary=${encodeURIComponent(sum)}`,'_blank','noopener,noreferrer'); };
    window.copyShare = async function(node) { const full = composeShareText(node) + '\n'; try { await navigator.clipboard.writeText(full); alert('PaylaÅŸÄ±m metni ve link kopyalandÄ±.'); } catch { const ta = document.createElement('textarea'); ta.value = full; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); alert('PaylaÅŸÄ±m metni ve link kopyalandÄ±.'); } };
  </script>
<script>
    window.toTRDate = function(value) { if (!value) return ''; const s = String(value).trim(); const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(s); if (m) return `${m[3]}/${m[2]}/${m[1]}`; const d = new Date(s); if (isNaN(d)) return s; const dd = String(d.getDate()).padStart(2, '0'); const mm = String(d.getMonth() + 1).padStart(2, '0'); const yyyy = d.getFullYear(); return `${dd}/${mm}/${yyyy}`; };
  </script>

</div>
<div id="legendWrap" x-show="selectedUniverse">
<button id="legend_bar" @click="showLegend = !showLegend" class="glass px-3 py-1.5 rounded-lg text-sm hover:bg-white/10 transition" id="legendToggle">BaÄŸlantÄ±lar <span x-text="showLegend ? '(Gizle)' : '(GÃ¶ster)'"></span></button>
<div id="legend" x-show="showLegend" x-transition="">
<h3 class="font-bold mb-2">BaÄŸlantÄ±lar</h3>
<ul>
<template :key="type" x-for="[type, color] in legendEntries">
<li class="flex items-center mb-1"><svg class="mr-2" height="8" width="36"><line :stroke="color" :stroke-dasharray="(edgeStyles[type]?.dashes ? edgeStyles[type].dashes.join(',') : '0')" stroke-width="3" x1="2" x2="34" y1="4" y2="4"></line></svg><span x-text="type"></span></li>
</template>
</ul>
</div>






<!-- Timeline button above Notes & Favorites -->
<button
  id="timeline_bar"
  @click="timelineOpen = !timelineOpen"
  class="fixed right-4 bottom-[8rem] z-[50] glass rounded-full w-12 h-12 grid place-items-center hover:bg-white/10 pointer-events-auto"
  title="Zaman Ã‡izelgesi"
>
  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v3H2V6a2 2 0 0 1 2-2h1V3a1 1 0 1 1 2 0v1z"/>
    <path d="M2 10h20v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8zm6 3a1 1 0 1 0 0 2h5a1 1 0 1 0 0-2H8z"/>
  </svg>
</button>

<!-- Yeni panel aÃ§ma butonu -->
<button @click="panelOpen = !panelOpen" id="panel_bar" class="fixed right-4 bottom-[4.5rem] z-50 glass rounded-full w-12 h-12 grid place-items-center hover:bg-white/10" title="Notlar ve Favoriler">ğŸ“</button>


<!-- Notlar & Favoriler Paneli -->
<div class="fixed right-4 bottom-[9rem] z-[60] glass rounded-xl p-4 w-[22rem] max-h-[45vh] overflow-y-auto text-white text-sm space-y-4"
     x-show="panelOpen" x-transition>

  <!-- Sekmeler -->
  <div class="flex gap-2 mb-1">
    <button id="fav_bar" @click="activeTab = 'watch'" :class="activeTab === 'watch' ? 'bg-white/20 px-3 py-1 rounded' : 'px-3 py-1 rounded hover:bg-white/10'">â­ Favoriler</button>
    <button id="notlar_bar" @click="activeTab = 'notes'" :class="activeTab === 'notes' ? 'bg-white/20 px-3 py-1 rounded' : 'px-3 py-1 rounded hover:bg-white/10'">ğŸ“ Notlar</button>
  </div>

  <!-- Favoriler Sekmesi -->
  <div x-show="activeTab === 'watch'" class="space-y-3">
    <template x-if="!watchLater.length">
      <p class="text-sm opacity-70">HenÃ¼z favori yok.</p>
    </template>

    <template x-for="item in watchLater" :key="item.id">
      <div class="border border-white/10 rounded-lg overflow-hidden">
        <div class="flex justify-between items-center px-3 py-2 bg-white/10">
          <span class="font-semibold truncate" x-text="item.label || item.id"></span>
          <button @click="removeWatchLater(item.id)" class="text-red-400 hover:text-red-600 text-xs">Sil</button>
        </div>
      </div>
    </template>
  </div>

  <!-- Notlar Sekmesi -->
  <div x-show="activeTab === 'notes'" class="space-y-3">
    <template x-if="!Object.keys(notes).some(k => notes[k]?.length)">
      <p class="text-sm opacity-70">Not bulunamadÄ±.</p>
    </template>

    <template x-for="(entries, nodeId) in Object.fromEntries(Object.entries(notes).filter(([k, arr]) => arr.length))" :key="nodeId">
      <div class="border border-white/10 rounded-lg overflow-hidden">
        <button @click="notesOpen = notesOpen === nodeId ? null : nodeId" class="w-full text-left px-3 py-2 bg-white/10 hover:bg-white/20 font-semibold">
          <span x-text="nodes.get(nodeId)?.label || nodeId"></span>
        </button>

        <div x-show="notesOpen === nodeId" x-transition class="p-3 space-y-2 max-h-[45vh] overflow-y-auto">
          <template x-for="(n, i) in entries" :key="i">
            <div class="bg-white/10 p-2 rounded">
              <div class="text-xs opacity-70 mb-1" x-text="new Date(n.ts).toLocaleDateString()"></div>

              <template x-if="editingNoteIndex === `${nodeId}_${i}`">
                <div class="flex flex-col gap-2">
                  <textarea x-model="editedNoteText" class="w-full p-2 rounded bg-black/20 text-sm text-white border border-white/20"></textarea>
                  <div class="flex justify-end gap-2 text-xs">
                    <button @click="saveEditedNote(nodeId, i)" class="px-2 py-1 rounded bg-green-600 hover:bg-green-700 text-white">Kaydet</button>
                    <button @click="cancelEditNote()" class="px-2 py-1 rounded bg-white/20 text-white">VazgeÃ§</button>
                  </div>
                </div>
              </template>

              <template x-if="editingNoteIndex !== `${nodeId}_${i}`">
                <div>
                  <div class="whitespace-pre-wrap text-sm mb-1" x-text="n.text"></div>
                  <div class="flex justify-end gap-2 text-xs opacity-80">
                    <button @click="startEditNote(`${nodeId}_${i}`, n.text)">âœï¸</button>
                    <button @click="deleteNote(nodeId, i)">ğŸ—‘ï¸</button>
                  </div>
                </div>
              </template>
            </div>
          </template>
        </div>
      </div>
    </template>
  </div>
</div>
        </template>
      </div>
    </template>
  </div>
</div>

<!-- Bilgi Panelleri -->
<div x-show="panel === 'hakkimizda'" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-2xl backdrop-blur-md space-y-4">
    <h2 class="text-2xl font-bold text-center">â„¹ï¸ HakkÄ±mÄ±zda</h2>
<div class="text-base text-white/80 space-y-3 text-left">
  <p><strong>Film Evreni AÄŸÄ±</strong>, sinema ve dizi evrenlerini etkileÅŸimli ve gÃ¶rsel bir biÃ§imde keÅŸfetmek isteyenler iÃ§in tasarlanmÄ±ÅŸ bir bilgi platformudur.</p>
  <p>AmacÄ±mÄ±z, sinema tutkunlarÄ±nÄ±n evrenler arasÄ± iliÅŸkileri kolayca anlamasÄ±nÄ± saÄŸlamak ve her yapÄ±mÄ±n birbirine nasÄ±l baÄŸlandÄ±ÄŸÄ±nÄ± sezgisel olarak sunmaktÄ±r.</p>
  <ul class="list-disc list-inside space-y-1">
    <li>FarklÄ± sinematik evrenleri merkezden uca, zaman Ã§izgisi ya da karakter baÄŸlantÄ±larÄ±yla gÃ¶rselleÅŸtirir.</li>
    <li>KullanÄ±cÄ±lara kiÅŸisel notlar alma, favori yapÄ±mlarÄ±nÄ± iÅŸaretleme imkanÄ± tanÄ±r.</li>
    <li>YapÄ±m bilgileri, karakter iliÅŸkileri ve gÃ¶ndermeler gibi iÃ§erikleri zenginleÅŸtirir.</li>
    <li>KullanÄ±cÄ±larÄ±n yorum yazmasÄ±na deÄŸil, bilgiye odaklanmasÄ±na olanak saÄŸlar.</li>
    <li>Hafif, reklamsÄ±z ve Ã¼yelik gerektirmeyen bir deneyim sunar.</li>
  </ul>
  <p>Film Evreni AÄŸÄ± baÄŸÄ±msÄ±z bir giriÅŸimdir ve herhangi bir stÃ¼dyo veya yayÄ±ncÄ±yla baÄŸlantÄ±sÄ± yoktur.</p>
</div>
    <div class="text-center">
      <button @click="panel = null" class="mt-4 px-5 py-2 bg-white/10 border border-white/20 text-white text-sm rounded-lg hover:bg-white/20 transition">Geri DÃ¶n</button>
    </div>
  </div>
</div>

<div x-show="panel === 'gizlilik'" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-2xl backdrop-blur-md space-y-4">
    <h2 class="text-2xl font-bold text-center">ğŸ” Gizlilik PolitikasÄ±</h2>
<div class="text-base text-white/80 space-y-3 text-left">
  <p>Film Evreni AÄŸÄ± olarak gizliliÄŸinizi ciddiye alÄ±yoruz. Platformumuz, anonim kullanÄ±cÄ± deneyimi sunar ve size ait verileri ifÅŸa etmez.</p>

  <h3 class="font-semibold mt-4 mb-1">Toplanan Bilgiler</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>KullanÄ±cÄ±dan aktif olarak <strong>hiÃ§bir kiÅŸisel bilgi</strong> talep edilmez.</li>
    <li>Ad, e-posta, Ã¼yelik, ÅŸifre vb. sistemde <strong>tutulmaz</strong>.</li>
    <li>Favoriler ve notlar yalnÄ±zca tarayÄ±cÄ± (localStorage) Ã¼zerinde saklanÄ±r.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">Veri KullanÄ±mÄ±</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Veriler yalnÄ±zca size gÃ¶rÃ¼nÃ¼r ÅŸekilde cihazÄ±nÄ±zda tutulur.</li>
    <li>KullanÄ±cÄ± davranÄ±ÅŸÄ± izlenmez, analiz yapÄ±lmaz.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">3. Taraflar ve Ä°zleme</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Google Analytics, Facebook Pixel gibi izleme araÃ§larÄ± <strong>kullanÄ±lmaz</strong>.</li>
    <li>Reklam, takip veya sponsor sistemleri entegre edilmemiÅŸtir.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">Veri PaylaÅŸÄ±mÄ±</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>HiÃ§bir veri 3. ÅŸahÄ±slarla <strong>paylaÅŸÄ±lmaz</strong>.</li>
    <li>Yasal bir zorunluluk olmadÄ±kÃ§a veri kaydÄ± yoktur.</li>
  </ul>

 <div class="text-center mt-4">
  <button @click="panel = 'iletisim'" class="px-4 py-2 bg-white/10 border border-white/20 text-white text-sm rounded hover:bg-white/20">
    Ä°letiÅŸim Formunu AÃ§
  </button>
</div>
</div>
    <div class="text-center">
      <button @click="panel = null" class="mt-4 px-5 py-2 bg-white/10 border border-white/20 text-white text-sm rounded-lg hover:bg-white/20 transition">Geri DÃ¶n</button>
    </div>
  </div>
</div>

<div x-show="panel === 'cerez'" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-2xl backdrop-blur-md space-y-4">
    <h2 class="text-2xl font-bold text-center">ğŸª Ã‡erez PolitikasÄ±</h2>
<div class="text-base text-white/80 space-y-3 text-left">
  <p>Web sitemiz yalnÄ±zca <strong>zorunlu ve deneyimi iyileÅŸtiren Ã§erezler</strong> kullanÄ±r.</p>

  <h3 class="font-semibold mt-4 mb-1">KullandÄ±ÄŸÄ±mÄ±z Ã‡erez TÃ¼rleri</h3>
  <ul class="list-disc list-inside space-y-1">
    <li><strong>Oturum Ã‡erezleri:</strong> GeÃ§ici olarak tutulur, oturum kapandÄ±ÄŸÄ±nda silinir.</li>
    <li><strong>Tercih Ã‡erezleri:</strong> Tema ayarlarÄ±, notlar, favoriler gibi verileri saklar.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">KullanÄ±m AmaÃ§larÄ±</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>KaranlÄ±k/aydÄ±nlÄ±k tema tercihini hatÄ±rlama</li>
    <li>Son seÃ§ilen evreni veya yapÄ±mÄ± hatÄ±rlama</li>
    <li>KiÅŸisel not ve favori listesini koruma</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">ToplamadÄ±ÄŸÄ±mÄ±z Veriler</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>DavranÄ±ÅŸ analizi, IP adresi, konum, geÃ§miÅŸ gibi veriler toplanmaz.</li>
    <li>Reklam Ã§erezi veya sosyal medya takibi <strong>yoktur</strong>.</li>
  </ul>

  <p class="mt-4">Ã‡erezleri tarayÄ±cÄ±nÄ±zdan temizleyebilir veya engelleyebilirsiniz. Bu durumda bazÄ± Ã¶zellikler Ã§alÄ±ÅŸmayabilir.</p>
</div>
    <div class="text-center">
      <button @click="panel = null" class="mt-4 px-5 py-2 bg-white/10 border border-white/20 text-white text-sm rounded-lg hover:bg-white/20 transition">Geri DÃ¶n</button>
    </div>
  </div>
</div>

<div x-show="panel === 'kullanim'" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-2xl backdrop-blur-md space-y-4">
    <h2 class="text-2xl font-bold text-center">ğŸ“œ KullanÄ±m KoÅŸullarÄ±</h2>
<div class="text-base text-white/80 space-y-3 text-left">
  <p>Platformu kullanarak aÅŸaÄŸÄ±daki koÅŸullarÄ± kabul etmiÅŸ sayÄ±lÄ±rsÄ±nÄ±z:</p>

  <h3 class="font-semibold mt-4 mb-1">KullanÄ±m AmacÄ±</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>YalnÄ±zca <strong>kiÅŸisel ve eÄŸitsel</strong> kullanÄ±m iÃ§indir.</li>
    <li>Herhangi bir ticari faaliyet amacÄ±yla kullanÄ±lamaz.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">Ä°Ã§erik ve Sorumluluk</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Bilgiler kamuya aÃ§Ä±k kaynaklardan derlenmiÅŸtir.</li>
    <li>Ä°Ã§erik doÄŸruluÄŸu garanti edilmez; referans amaÃ§lÄ±dÄ±r.</li>
    <li>Telifli materyallerin sahibi yapÄ±m ÅŸirketleridir.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">KÄ±sÄ±tlamalar</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Ä°Ã§erik izinsiz kopyalanamaz, daÄŸÄ±tÄ±lamaz, satÄ±lamaz.</li>
    <li>Kod yapÄ±sÄ± ve veri yapÄ±larÄ± izinsiz Ã§oÄŸaltÄ±lamaz.</li>
  </ul>

  <p class="mt-4">KurallarÄ± ihlal eden kullanÄ±cÄ±larÄ±n eriÅŸimi engellenebilir.</p>
</div>
    <div class="text-center">
      <button @click="panel = null" class="mt-4 px-5 py-2 bg-white/10 border border-white/20 text-white text-sm rounded-lg hover:bg-white/20 transition">Geri DÃ¶n</button>
    </div>
  </div>
</div>

<div x-show="panel === 'dmca'" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-2xl backdrop-blur-md space-y-4">
    <h2 class="text-2xl font-bold text-center">âš–ï¸ DMCA Bildirimi</h2>
<div class="text-base text-white/80 space-y-3 text-left">
  <p>Film Evreni AÄŸÄ± telif hakkÄ± sahiplerine saygÄ± duyar ve ihlal bildirimlerini ciddiyetle ele alÄ±r.</p>

  <h3 class="font-semibold mt-4 mb-1">Bildiriminizde BulunmasÄ± Gerekenler</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Hak sahibinin adÄ± ve iletiÅŸim bilgileri</li>
    <li>Ä°hlal ettiÄŸi dÃ¼ÅŸÃ¼nÃ¼len iÃ§eriÄŸin tam baÄŸlantÄ±sÄ± (URL)</li>
    <li>Telif hakkÄ± sahibi olduÄŸunuza dair aÃ§Ä±k beyan</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">SÃ¼reÃ§</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Bildirimin ardÄ±ndan en geÃ§ 48 saat iÃ§inde yanÄ±t verilir.</li>
    <li>Uygun gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ takdirde iÃ§erik yayÄ±ndan kaldÄ±rÄ±lÄ±r.</li>
  </ul>

  <h3 class="font-semibold mt-4 mb-1">Yasal UyarÄ±</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>YanlÄ±ÅŸ beyanla gÃ¶nderilen bildirimler yasal sorumluluk doÄŸurur.</li>
  </ul>

  <div class="text-center mt-4">
  <button @click="panel = 'iletisim'" class="px-4 py-2 bg-white/10 border border-white/20 text-white text-sm rounded hover:bg-white/20">
    Ä°letiÅŸim Formunu AÃ§
  </button>
</div>
</div>

    <div class="text-center">
      <button @click="panel = null" class="mt-4 px-5 py-2 bg-white/10 border border-white/20 text-white text-sm rounded-lg hover:bg-white/20 transition">Geri DÃ¶n</button>
    </div>
  </div>
</div>

<div x-show="panel === 'iletisim'" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="mobile-centered bg-black/85 text-white border border-white/10 rounded-2xl shadow-2xl p-6 text-sm w-[90%] max-w-xl backdrop-blur-md space-y-4">
    <h2 class="text-2xl font-bold text-center">ğŸ“¬ Ä°letiÅŸim Formu</h2>

    <form id="iletisimForm" class="space-y-4">
      <div>
        <label class="block mb-1">AdÄ±nÄ±z</label>
        <input type="text" name="name" class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" required>
      </div>
      <div>
        <label class="block mb-1">E-posta Adresiniz</label>
        <input type="email" name="email" class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" required>
      </div>
      <div>
        <label class="block mb-1">Konu</label>
        <select name="subject" required class="w-full px-3 py-2 rounded bg-white/10 border border-white/20">
          <option disabled selected>SeÃ§in</option>
          <option>Ä°stek-Ã–neri</option>
          <option>DMCA</option>
          <option>Ä°letiÅŸim</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">MesajÄ±nÄ±z</label>
        <textarea name="message" rows="5" class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" required></textarea>
      </div>
      <div class="text-center">
        <button type="submit" class="px-4 py-2 bg-white/10 border border-white/20 text-white text-sm rounded hover:bg-white/20">GÃ¶nder</button>
      </div>
    </form>

    <div class="text-center">
      <button @click="panel = null" class="mt-2 px-4 py-1 text-sm text-white border border-white/20 rounded hover:bg-white/20">Ä°ptal</button>
    </div>
  </div>

  <!-- EmailJS entegrasyonu -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function () {
      emailjs.init("7UKhuE7htA-_Kgs1q"); // public key
    })();

    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("iletisimForm");
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        emailjs.sendForm("service_7klkor6", "template_7shk4yl", form)
          .then(() => {
            alert("MesajÄ±nÄ±z baÅŸarÄ±yla gÃ¶nderildi. TeÅŸekkÃ¼r ederiz!");
            form.reset();
            panel = null;
          })
          .catch((error) => {
            alert("Bir hata oluÅŸtu: " + JSON.stringify(error));
          });
      });
    });
  </script>
</div>



<footer class="bg-black/70 text-white/70 text-xs text-center py-4 border-t border-white/10 mt-auto relative z-50">
  <div class="space-y-2">
    <div>Â© 2025 Film Evreni AÄŸÄ±</div>
    <div class="flex flex-wrap justify-center gap-x-4 gap-y-1 text-xs">
      <a href="#" @click.prevent="panel='hakkimizda'" class="underline hover:text-white block">HakkÄ±mÄ±zda</a>
      <a href="#" @click.prevent="panel='gizlilik'" class="underline hover:text-white block">Gizlilik</a>
      <a href="#" @click.prevent="panel='cerez'" class="underline hover:text-white block">Ã‡erez PolitikasÄ±</a>
      <a href="#" @click.prevent="panel='kullanim'" class="underline hover:text-white block">KullanÄ±m KoÅŸullarÄ±</a>
      <a href="#" @click.prevent="panel='dmca'" class="underline hover:text-white block">DMCA</a>
    </div>
  </div>
</footer>

<script>
// SaÄŸ tÄ±k kapatma
document.addEventListener('contextmenu', e => e.preventDefault(), {passive:false});

// SeÃ§imi ve kopyayÄ± zorlaÅŸtÄ±r (tam gÃ¼venlik saÄŸlamaz)
document.addEventListener('copy', e => e.preventDefault());
document.addEventListener('cut',  e => e.preventDefault());

// YaygÄ±n kÄ±sayollarÄ± engelle (F12, Ctrl+Shift+I, Ctrl+U, Ctrl+S vs.)
document.addEventListener('keydown', function(e){
  const k = e.key.toLowerCase();
  const ctrl = e.ctrlKey || e.metaKey;
  if (
    k === 'f12' ||
    (ctrl && k === 'u') ||              // Ctrl+U: View Source
    (ctrl && k === 's') ||              // Ctrl+S: Save
    (ctrl && k === 'p') ||              // Ctrl+P: Print
    (ctrl && e.shiftKey && k === 'i') ||// DevTools
    (ctrl && e.shiftKey && k === 'j') ||// DevTools console
    (ctrl && e.shiftKey && k === 'c')   // Open element picker (bazÄ± eklentiler)
  ){
    e.preventDefault();
    e.stopPropagation();
  }
}, {capture:true});
</script> 

<script>
(function(){
  let warned = false;
  function devtoolsLikelyOpen(){
    // pencere Ã§erÃ§evesi kalÄ±nlÄ±k farkÄ± yÃ¶ntemi (yanlÄ±ÅŸ pozitif olabilir)
    const threshold = 160;
    const wDiff = Math.abs(window.outerWidth - window.innerWidth);
    const hDiff = Math.abs(window.outerHeight - window.innerHeight);
    return (wDiff > threshold || hDiff > threshold);
  }
  function check(){
    if (!warned && devtoolsLikelyOpen()){
      warned = true;
      // Basit bir kilit/Ã¶rtÃ¼
      const div = document.createElement('div');
      div.style.cssText = `
        position:fixed;inset:0;background:#000c;color:#fff;z-index:99999;
        display:grid;place-items:center;font:600 16px/1.4 system-ui`;
      div.textContent = 'GÃ¼venlik nedeniyle sayfa geÃ§ici olarak kilitlendi.';
      document.body.appendChild(div);
      // Ä°stersen buraya yÃ¶nlendirme koy: location.href = '/';
    }
  }
  setInterval(check, 800);
})();
</script>

<!-- Hidden admin redirect snippet: begin -->
<script>
(function(){
  var target = "./src/admin.html";
  function go(){ try { window.location.href = target; } catch(e){} }

  // 1) Hotkey: Ctrl/Cmd + Alt + A
  window.addEventListener("keydown", function(e){
    var isA = (e.key || "").toLowerCase() === "a";
    if (isA && e.altKey && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      go();
    }
  }, { passive: false });

  // 2) Hash trigger: #admin
  if ((location.hash || "").toLowerCase() === "#admin") {
    go();
  }

  // 3) Type sequence: "admin" within 1.5s anywhere
  var buffer = "";
  var timer = null;
  window.addEventListener("keydown", function(e){
    var k = (e.key || "");
    if (k.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
      buffer += k.toLowerCase();
      if (timer) clearTimeout(timer);
      timer = setTimeout(function(){ buffer = ""; }, 1500);
      if (buffer.endsWith("admin")) {
        go();
      }
    }
  });
})();
</script>
<!-- Hidden admin redirect snippet: end -->
<script>
(function(){
  var logo = document.getElementById('secretAdminTap');
  var tapCount = 0;
  var tapTimer;

  if(logo){
    logo.addEventListener('click', function(){
      tapCount++;
      clearTimeout(tapTimer);
      tapTimer = setTimeout(function(){ tapCount = 0; }, 1000); // 1 sn iÃ§inde tÄ±klama sayÄ±lÄ±r

      if(tapCount >= 5){
        window.location.href = "./src/admin.html";
      }
    });
  }
})();
</script>





<!-- Timeline Overlay -->
<div x-show="timelineOpen" @click="timelineOpen=false" class="tl-overlay" x-transition.opacity></div>

<!-- Timeline Panel -->
<section x-show="timelineOpen"
         @keydown.escape.window="timelineOpen=false"
         class="tl-panel glass rounded-t-2xl p-4 no-scrollbar overflow-y-auto"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="translate-y-full"
         x-transition:enter-end="translate-y-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="translate-y-0"
         x-transition:leave-end="translate-y-full">

  <div class="flex items-center justify-between mb-3">
    <h3 class="text-lg font-semibold">ğŸ“… Zaman Ã‡izelgesi</h3>
    <button @click="timelineOpen=false" class="w-8 h-8 rounded-full bg-white/10 border border-white/20">âœ•</button>
  </div>

  <div x-ref="tlScroll"
     x-data="{ isDown:false, startX:0, scrollLeft:0 }"
     @mousedown="isDown=true; startX=$event.pageX - $refs.tlScroll.getBoundingClientRect().left; scrollLeft=$refs.tlScroll.scrollLeft"
     @mouseleave="isDown=false"
     @mouseup="isDown=false"
     @mousemove="if(isDown){ $event.preventDefault(); const x=$event.pageX - $refs.tlScroll.getBoundingClientRect().left; $refs.tlScroll.scrollLeft = scrollLeft - (x - startX) }"
     class="tl-scroll overflow-x-auto overflow-y-hidden no-scrollbar whitespace-nowrap cursor-grab"
     :class="isDown ? 'cursor-grabbing' : 'cursor-grab'"
     @wheel.passive="if ($event.deltaY) { $refs.tlScroll.scrollLeft += $event.deltaY }"
     style="touch-action: pan-x;">
    <div class="flex gap-4 pr-4">
      <template x-for="pair in Array.from(groupTimelineByYear)" :key="pair[0]">
        <div class="tl-col">
          <div class="sticky top-0 backdrop-blur-sm bg-black/20 border-b border-white/10 py-1 mb-2">
            <div class="tl-year text-emerald-300 text-xl" x-text="pair[0]"></div>
          </div>
          <div class="space-y-2">
            <template x-for="n in pair[1]" :key="n.id">
              <div class="tl-card" @click="openTimelineNode(n.id)">
                <div class="flex gap-3">
                  <img class="tl-poster" :src="n.image" alt="">
                  <div class="flex-1 min-w-0">
                    <div class="font-semibold truncate" x-text="n.label"></div>
                    <div class="text-xs opacity-80">
                      <span x-text="toTRDate(n.release_date)"></span>
                      <span class="mx-1">â€¢</span>
                      <span x-text="n.type || '-'"></span>
                    </div>
                    <div class="mt-1 flex flex-wrap gap-1">
                      <span class="tl-badge" x-text="formatUniverseName(n.universe)"></span>
                      <template x-if="n.imdb_rating">
                        <span class="tl-badge">IMDb <span x-text="n.imdb_rating"></span></span>
                      </template>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </template>
    </div>
  </div>
</section>
<script>
!function(){
  const payload = {
    ts: Date.now(),
    path: location.pathname + location.search,
    ref: document.referrer || 'direct',
    ua: navigator.userAgent || '',
    lang: navigator.language || '',
    w: screen.width, h: screen.height
  };
  fetch('https://evren-analytics.no-reply-bf4.workers.dev/api/analytics/collect', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload),
    keepalive: true
  }).catch(()=>{});
}();
</script>



<script>
  function setParams(patch = {}) {
    const url = new URL(location.href);
    const qs = url.searchParams;
    Object.entries(patch).forEach(([k, v]) => {
      if (v === undefined || v === null || v === '') qs.delete(k);
      else qs.set(k, String(v));
    });
    if (patch.clearNode) qs.delete('node');
    url.search = qs.toString();
    history.replaceState({}, '', url);
  }
  window.pushPrettyUrl = function pushPrettyUrl(node) {
    try {
      const u = node?.universe || '';
      const id = node?.id != null ? String(node.id) : '';
      setParams({ u, node: id });
    } catch(e) { console.warn('pushPrettyUrl', e); }
  };
  window.resetPrettyUrl = function resetPrettyUrl() {
    try { setParams({ clearNode: true }); } catch(e) { console.warn('resetPrettyUrl', e); }
  };
  window.buildNodeUrl = function buildNodeUrl(nodeId){
    const url = new URL(location.href);
    const u = (window.app?.selectedUniverse) || '';
    url.searchParams.set('u', u || '');
    url.searchParams.set('node', String(nodeId));
    return url.origin + url.pathname + '?' + url.searchParams.toString();
  };
  window.preferredUrl = function preferredUrl(node){
  try {
    const url = new URL(location.href);
    url.searchParams.set('u', node?.universe || '');
    url.searchParams.set('node', String(node?.id ?? ''));
    return url.origin + url.pathname + '?' + url.searchParams.toString();
  } catch (_) {
    // Eski tarayÄ±cÄ±lar iÃ§in basit fallback
    var u = (node && node.universe) ? node.universe : '';
    var i = (node && node.id != null) ? String(node.id) : '';
    return location.pathname + '?u=' + encodeURIComponent(u) + '&node=' + encodeURIComponent(i);
  }
};
</script>

</body>


</html>
